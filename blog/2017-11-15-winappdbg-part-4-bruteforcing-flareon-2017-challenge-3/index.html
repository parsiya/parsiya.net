<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>WinAppDbg - Part 4 - Bruteforcing FlareOn 2017 - Challenge 3</title><link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://parsiya.net/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Parsia Hakimian Parsiya infosec information security]"><meta name=author content="Parsia"><meta name=generator content="Hugo 0.115.1"><meta name=twitter:card content="summary"><meta name=twitter:title content="WinAppDbg - Part 4 - Bruteforcing FlareOn 2017 - Challenge 3"><meta name=twitter:description content="Previous parts:

Part 1 - Basics
Part 2 - Function Hooking and Others
Part 3 - Manipulating Function Calls

We have learned some good stuff. In this part I am going to talk about the original problem that led me to learning WinAppDbg. This is my writeup for challenge 3 &#34;Greek to me&#34; of FlareOn 2017. This is a bruteforce challenge and is rather easy but instead of bruteforcing it the conventional (and straightforward way), I will show how I traversed arbitrary Assembly blobs using WinAppDbg.
I will (hopefully) mostly talk about solving the challenge and not a lot of recon or other places I was stuck at.
Code is in my clone:

https://github.com/parsiya/Parsia-Code/tree/master/winappdbg
"><meta name=twitter:domain content="parsiya.net"><meta name=twitter:creator content="@CryptoGangsta"></head><body><header role=banner><hgroup><h1><a href=https://parsiya.net/>Hackerman's Hacking Tutorials</a></h1><h2>The knowledge of anything, since all things have causes, is not acquired or
complete unless it is known by its causes. - Avicenna</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://parsiya.net/about/>» About Me!</option><option value=https://parsiya.net/cheatsheet/>» Cheat Sheet</option><option value=https://parsiya.io/>» My Clone</option><option value=https://github.com/parsiya/parsiya.net>» Source Repo</option><option value="https://queue.acm.org/detail.cfm?id=3197520">» Manual Work is a Bug</option><option value="https://www.google.com/search?q=andrew+ridgeley">» The Other Guy from Wham!</option></select></fieldset><ul class=main-navigation><li><a href=https://parsiya.net/about/ title="About Me!" target=_blank rel="noopener noreferrer">About Me!</a></li><li><a href=https://parsiya.net/cheatsheet/ title="Cheat Sheet" target=_blank rel="noopener noreferrer">Cheat Sheet</a></li><li><a href=https://parsiya.io/ title="My Clone" target=_blank rel="noopener noreferrer">My Clone</a></li><li><a href=https://github.com/parsiya/parsiya.net title="Source Repo" target=_blank rel="noopener noreferrer">Source Repo</a></li><li><a href="https://queue.acm.org/detail.cfm?id=3197520" title="Manual Work is a Bug" target=_blank rel="noopener noreferrer">Manual Work is a Bug</a></li><li><a href="https://www.google.com/search?q=andrew+ridgeley" title="The Other Guy from Wham!" target=_blank rel="noopener noreferrer">The Other Guy from Wham!</a></li></ul><ul class=subscription><a href=https://parsiya.net/index.xml target=_blank type=application/rss+xml title=RSS rel="noopener noreferrer"><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://parsiya.net/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>Nov 15, 2017
- 9 minute read
- <a href=https://parsiya.net/blog/2017-11-15-winappdbg-part-4-bruteforcing-flareon-2017-challenge-3/#disqus_thread>Comments</a>
- <a class=label href=https://parsiya.net/categories/winappdbg/>winappdbg </a><a class=label href=https://parsiya.net/categories/reverse-engineering/>reverse engineering </a><a class=label href=https://parsiya.net/categories/writeup/>Writeup</a></p><h1 class=entry-title>WinAppDbg - Part 4 - Bruteforcing FlareOn 2017 - Challenge 3</h1></header><div class=entry-content><nav id=TableOfContents><ul><li><a href=#setup>Setup</a></li><li><a href=#recon>Recon</a></li><li><a href=#short-analysis>Short Analysis</a></li><li><a href=#bruteforcing-with-winappdbg>Bruteforcing with WinAppDbg</a><ul><li><a href=#breakpoints-in-winappdbg>Breakpoints in WinAppDbg</a></li><li><a href=#getting-and-setting-memory>Getting and Setting Memory</a></li><li><a href=#getting-and-setting-context>Getting and Setting Context</a></li><li><a href=#battle-plan>Battle Plan</a></li><li><a href=#bruteforcing-in-action>Bruteforcing in Action</a></li><li><a href=#flag>Flag</a></li></ul></li><li><a href=#some-more-analysis---optional-read>Some More Analysis - Optional Read</a><ul><li><a href=#sub_401121>sub_401121</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav><p>Previous parts:</p><ul><li><a href=https://parsiya.net/blog/2017-11-09-winappdbg-part-1-basics/ title="WinAppDbg - Part 1 - Basics">Part 1 - Basics</a></li><li><a href=https://parsiya.net/blog/2017-11-11-winappdbg-part-2-function-hooking-and-others/ title="WinAppDbg - Part 2 - Function Hooking and Others">Part 2 - Function Hooking and Others</a></li><li><a href=https://parsiya.net/blog/2017-11-11-winappdbg-part-2-function-hooking-and-others/ title="WinAppDbg - Part 3 - Manipulating Function Calls">Part 3 - Manipulating Function Calls</a></li></ul><p>We have learned some good stuff. In this part I am going to talk about the original problem that led me to learning WinAppDbg. This is my writeup for challenge 3 "Greek to me" of <a href=https://www.fireeye.com/blog/threat-research/2017/10/2017-flare-on-challenge-solutions.html target=_blank rel="noreferrer noopener">FlareOn 2017</a>. This is a bruteforce challenge and is rather easy but instead of bruteforcing it the conventional (and straightforward way), I will show how I traversed arbitrary Assembly blobs using WinAppDbg.</p><p>I will (hopefully) mostly talk about solving the challenge and not a lot of recon or other places I was stuck at.</p><p>Code is in my clone:</p><ul><li><a href=https://github.com/parsiya/Parsia-Code/tree/master/winappdbg title="WinAppDbg code in Parsia-Code" target=_blank rel="noreferrer noopener">https://github.com/parsiya/Parsia-Code/tree/master/winappdbg</a></li></ul><h1 id=setup>Setup
<a class=header-link href=#setup><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><ul><li>Same Windows 7 32-bit VM from other parts.</li><li>Get the binaries from this URL:<ul><li><a href=http://flare-on.com/files/Flare-On4_Challenges.zip target=_blank rel="noreferrer noopener">http://flare-on.com/files/Flare-On4_Challenges.zip</a></li><li>Password is <code>flare</code>.</li></ul></li><li>Solutions:<ul><li><a href=https://www.fireeye.com/blog/threat-research/2017/10/2017-flare-on-challenge-solutions.html target=_blank rel="noreferrer noopener">https://www.fireeye.com/blog/threat-research/2017/10/2017-flare-on-challenge-solutions.html</a></li></ul></li></ul><h1 id=recon>Recon
<a class=header-link href=#recon><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>Run <code>strings</code> on the binary. On Windows I have two favorites:</p><ul><li>strings from <a href=https://www.cygwin.com/ target=_blank rel="noreferrer noopener">Cygwin</a>'s binutils package.</li><li><a href=https://docs.microsoft.com/en-us/sysinternals/downloads/strings target=_blank rel="noreferrer noopener">strings</a> from Sysinternals.</li></ul><p>Running strings (from Sysinternals) we get:</p><ul><li><code>-nobanner</code>: do not display banner.</li><li><code>-o</code>: print the offset of the string (useful in case we want to use find the string in the file).</li></ul><pre tabindex=0><code>PS &gt; .\SysinternalsSuite\strings.exe -o -nobanner .\3-GreektoMe\greek_to_me.exe
0077:!This program cannot be run in DOS mode.
0176:Rich
0432:.text
0472:.rdata
...
1584:Nope, that&#39;s not it.
1608:Congratulations! But wait, where&#39;s my flag?
1652:127.0.0.1
1752:WS2_32.dll
</code></pre><p><code>WS2_32.dll</code> is the Windows socket library. So network connectivity.</p><p>Here's some interesting but unrelated info that I found when searching for the DLL:</p><ul><li><a href=https://nakedsecurity.sophos.com/2009/10/12/windows-ws232dll-file-safe/ target=_blank rel="noreferrer noopener">https://nakedsecurity.sophos.com/2009/10/12/windows-ws232dll-file-safe/</a></li></ul><p><code>127.0.0.1</code> means the application has network connectivity. It's either trying to connect to a port on localhost or listening on some port.</p><p>To discover, run procmon or Wireshark:</p><ul><li>Procmon filters:<ul><li><code>process name is greek_to_me.exe</code>.</li><li><code>Operation is TCP/UDP Connect</code>.</li></ul></li><li>Wireshark:<ul><li>Capture Windows loopback traffic with <code>npcap</code>.</li><li><a href=https://wiki.wireshark.org/CaptureSetup/Loopback target=_blank rel="noreferrer noopener">https://wiki.wireshark.org/CaptureSetup/Loopback</a></li></ul></li></ul><p>Nothing. So it's listening on localhost.</p><p>Run the app and use <code>netstat -anb</code> in an Admin command prompt (needed for the <code>b</code> switch).</p><pre tabindex=0><code> TCP    127.0.0.1:2222         0.0.0.0:0              LISTENING       5816
[greek_to_me.exe]
</code></pre><p>Application is listening on port <code>2222</code>.</p><h1 id=short-analysis>Short Analysis
<a class=header-link href=#short-analysis><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>The application is listening on port <code>2222</code>. When it receives data, it uses the first byte (and only the first byte) of our input as we see here:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>.text:00401029 loc_401029:      <span style=color:#586e75>; CODE XREF: sub_401008+1A
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>.text:00401029          <span style=color:#268bd2>mov</span>     <span style=color:#cb4b16>ecx</span>, <span style=color:#cb4b16>offset</span> <span style=color:#cb4b16>loc_40107C</span>
</span></span><span style=display:flex><span>.text:0040102<span style=color:#268bd2>E</span>          <span style=color:#cb4b16>add</span>     <span style=color:#cb4b16>ecx</span>, <span style=color:#2aa198>79</span><span style=color:#cb4b16>h</span>
</span></span><span style=display:flex><span>.text:00401031          <span style=color:#268bd2>mov</span>     <span style=color:#cb4b16>eax</span>, <span style=color:#cb4b16>offset</span> <span style=color:#cb4b16>loc_40107C</span>
</span></span><span style=display:flex><span>.text:00401036          <span style=color:#268bd2>mov</span>     <span style=color:#cb4b16>dl</span>, [<span style=color:#cb4b16>ebp</span>+<span style=color:#cb4b16>buf</span>]   <span style=color:#586e75>; first byte of input moved to dl
</span></span></span></code></pre></div><p>Now dl points to the first byte that we sent to the socket.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>.text:00401039 loc_401039:      <span style=color:#586e75>; CODE XREF: sub_401008+3D
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>.text:00401039          <span style=color:#268bd2>mov</span>     <span style=color:#cb4b16>bl</span>, [<span style=color:#cb4b16>eax</span>]   <span style=color:#586e75>; bl = grab a byte from blob
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>.text:0040103<span style=color:#268bd2>B</span>          <span style=color:#cb4b16>xor</span>     <span style=color:#cb4b16>bl</span>, <span style=color:#cb4b16>dl</span>      <span style=color:#586e75>; bl = blob_byte xor our_first_byte
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>.text:0040103<span style=color:#268bd2>D</span>          <span style=color:#cb4b16>add</span>     <span style=color:#cb4b16>bl</span>, <span style=color:#2aa198>22</span><span style=color:#cb4b16>h</span>     <span style=color:#586e75>; bl += 0x22
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>.text:00401040          <span style=color:#268bd2>mov</span>     [<span style=color:#cb4b16>eax</span>], <span style=color:#cb4b16>bl</span>   <span style=color:#586e75>; *eax = bl
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>.text:00401042          <span style=color:#268bd2>inc</span>     <span style=color:#cb4b16>eax</span>         <span style=color:#586e75>; eax++ (next char)
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>.text:00401043          <span style=color:#268bd2>cmp</span>     <span style=color:#cb4b16>eax</span>, <span style=color:#cb4b16>ecx</span>    <span style=color:#586e75>; ecx is the address of the second section
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>.text:00401045          <span style=color:#268bd2>jl</span>      <span style=color:#cb4b16>short</span> <span style=color:#cb4b16>loc_401039</span> <span style=color:#586e75>; check if we have reached the next section
</span></span></span></code></pre></div><p>It grabs some data (<code>0x79</code> or 121 bytes to be exact) from <code>0x40107C</code>, XOR-es them with our first byte and then add <code>0x22</code>.</p><p>The data is some blob at <code>offset loc_40107C</code>.</p><pre><code>33 E1 C4 99 11 06 81 16 F0 32 9F C4 91 17 06 81
14 F0 06 81 15 F1 C4 91 1A 06 81 1B E2 06 81 18
F2 06 81 19 F1 06 81 1E F0 C4 99 1F C4 91 1C 06
81 1D E6 06 81 62 EF 06 81 63 F2 06 81 60 E3 C4
99 61 06 81 66 BC 06 81 67 E6 06 81 64 E8 06 81
65 9D 06 81 6A F2 C4 99 6B 06 81 68 A9 06 81 69
EF 06 81 6E EE 06 81 6F AE 06 81 6C E3 06 81 6D
EF 06 81 72 E9 06 81 73 7C
</code></pre><span class=caption-wrapper><img class=caption src=/images/2017/winappdbg-4/01-crypto.png title="XOR and ADD instructions" alt="XOR and ADD instructions">
<span class=caption-text>XOR and ADD instructions</span></span><p>Then this modified blob (after XOR and add) is passed to <code>sub_4011E6</code> and processed:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nasm data-lang=nasm><span style=display:flex><span>.text:00401047          <span style=color:#268bd2>mov</span>     <span style=color:#b58900>eax</span>, <span style=color:#268bd2>offset</span> <span style=color:#268bd2>loc_40107C</span>  <span style=color:#586e75>; eax = *modified_blob</span>
</span></span><span style=display:flex><span>.text:0040104<span style=color:#268bd2>C</span>          <span style=color:#268bd2>mov</span>     [<span style=color:#b58900>ebp</span><span style=color:#719e07>+</span><span style=color:#268bd2>var_C</span>], <span style=color:#b58900>eax</span>        <span style=color:#586e75>; varC = eax</span>
</span></span><span style=display:flex><span>.text:0040104<span style=color:#268bd2>F</span>          <span style=color:#268bd2>push</span>    <span style=color:#2aa198>79h</span>                     <span style=color:#586e75>; length of modified_blob</span>
</span></span><span style=display:flex><span>.text:00401051          <span style=color:#268bd2>push</span>    [<span style=color:#b58900>ebp</span><span style=color:#719e07>+</span><span style=color:#268bd2>var_C</span>]
</span></span><span style=display:flex><span>.text:00401054          <span style=color:#268bd2>call</span>    <span style=color:#268bd2>sub_4011E6</span>              <span style=color:#586e75>; sub_4011E6(*modified_blob, 0x79)</span>
</span></span><span style=display:flex><span>.text:00401059          <span style=color:#268bd2>pop</span>     <span style=color:#b58900>ecx</span>
</span></span><span style=display:flex><span>.text:0040105<span style=color:#268bd2>A</span>          <span style=color:#268bd2>pop</span>     <span style=color:#b58900>ecx</span>
</span></span><span style=display:flex><span>.text:0040105<span style=color:#268bd2>B</span>          <span style=color:#268bd2>movzx</span>   <span style=color:#b58900>eax</span>, <span style=color:#b58900>ax</span>
</span></span><span style=display:flex><span>.text:0040105<span style=color:#268bd2>E</span>          <span style=color:#268bd2>cmp</span>     <span style=color:#b58900>eax</span>, <span style=color:#2aa198>0FB5Eh</span> <span style=color:#586e75>; compare return value with 0xFB5E</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.text:00401063          <span style=color:#268bd2>jz</span>      <span style=color:#268bd2>short</span> <span style=color:#268bd2>loc_40107C</span>
</span></span><span style=display:flex><span>.text:00401065          <span style=color:#268bd2>push</span>    <span style=color:#2aa198>0</span>               <span style=color:#586e75>; flags</span>
</span></span><span style=display:flex><span>.text:00401067          <span style=color:#268bd2>push</span>    <span style=color:#2aa198>14h</span>             <span style=color:#586e75>; len</span>
</span></span><span style=display:flex><span>.text:00401069          <span style=color:#268bd2>push</span>    <span style=color:#268bd2>offset</span> <span style=color:#268bd2>buf</span>      <span style=color:#586e75>; &#34;Nope, that&#39;s not it.&#34;</span>
</span></span><span style=display:flex><span>.text:0040106<span style=color:#268bd2>E</span>          <span style=color:#268bd2>push</span>    [<span style=color:#b58900>ebp</span><span style=color:#719e07>+</span><span style=color:#268bd2>s</span>]         <span style=color:#586e75>; s</span>
</span></span><span style=display:flex><span>.text:00401071          <span style=color:#268bd2>call</span>    <span style=color:#b58900>ds</span>:<span style=color:#268bd2>send</span>
</span></span><span style=display:flex><span>.text:00401077          <span style=color:#268bd2>jmp</span>     <span style=color:#268bd2>loc_401107</span>
</span></span></code></pre></div><p>Return value of the <code>sub_4011E6</code> is compared with <code>0xFB5E</code>. If they do not match, <code>jz</code> will not be taken and execution will continue. Application will send back <code>Nope, that's not it.</code>.</p><span class=caption-wrapper><img class=caption src=/images/2017/winappdbg-4/02-result-comparison.png title="Result comparison" alt="Result comparison">
<span class=caption-text>Result comparison</span></span><p>Now here it gets interesting. If the results match, it will jump to the section which houses the blob we just modified and attempts to execute it as code. If the application does not crash and reaches the end, it will send back <code>Congratulations!</code></p><p>In other words, our first byte is supposed to transform that blob into valid assembly opcodes.</p><p>Now we could solve this is in different ways. I think everyone solved it by opening a socket, sending 256 possible bytes and looking at the response. I think it's the way the challenge was meant to be solved.</p><h1 id=bruteforcing-with-winappdbg>Bruteforcing with WinAppDbg
<a class=header-link href=#bruteforcing-with-winappdbg><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>I solved it a different way. Originally I went down the rabbit hole and tried to RE <code>sub_4011E6</code>. That was a shit-show. Then I realized I can use WinAppDbg to bruteforce the "crypto" in-memory. We need to learn a bit more about WinAppDbg to reproduce it.</p><h2 id=breakpoints-in-winappdbg>Breakpoints in WinAppDbg
<a class=header-link href=#breakpoints-in-winappdbg><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>WinAppDbg allows us to set breakpoints at arbitrary addresses:</p><figure class=code><figcaption><span>Setting a breakpoint</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>debug<span style=color:#719e07>.</span>break_at(pid, address, action_callback)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>def</span> <span style=color:#268bd2>action_callback</span>(event):
</span></span><span style=display:flex><span>    <span style=color:#586e75># do something</span></span></span></code></pre></td></tr></table></div></div></div></figure><p>When the breakpoint is hit, the <code>action_callback</code> function is called. We have not seen this before but all of our hooking has been performed internally with these instructions.</p><p>More info:</p><ul><li><a href="https://winappdbg.readthedocs.io/en/latest/Debugging.html?highlight=break_at#example-11-setting-a-breakpoint" target=_blank rel="noreferrer noopener">Documentation - Example #11: setting a breakpoint</a></li><li><a href=https://github.com/MarioVilas/winappdbg/blob/master/winappdbg/breakpoint.py#L3905 target=_blank rel="noreferrer noopener">breakpoint.py source code</a></li></ul><h2 id=getting-and-setting-memory>Getting and Setting Memory
<a class=header-link href=#getting-and-setting-memory><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>WinAppDbg allows us to save/restore memory and context.</p><ul><li>Get memory: <code>memory = process.take_memory_snapshot()</code><ul><li><a href=https://github.com/MarioVilas/winappdbg/blob/master/winappdbg/process.py#L3261 target=_blank rel="noreferrer noopener">take_memory_snapshot source</a></li></ul></li><li>Set memory: <code>process.restore_memory_snapshot(memory, bSkipMappedFiles=True)</code><ul><li><a href=https://github.com/MarioVilas/winappdbg/blob/master/winappdbg/process.py#L3301 target=_blank rel="noreferrer noopener">restore_memory_snapshot source</a></li><li>In general, keep the <code>bSkipMappedFiles</code> to <code>True</code>. Otherwise you will get memory address violations.<ul><li><a href=https://github.com/MarioVilas/winappdbg/blob/master/winappdbg/process.py#L3317 target=_blank rel="noreferrer noopener">Explanation of bSkipMappedFiles in source</a></li></ul></li></ul></li></ul><h2 id=getting-and-setting-context>Getting and Setting Context
<a class=header-link href=#getting-and-setting-context><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Context contains register and flag values. It's per thread (instead of per process like memory).</p><ul><li>Get context: <code>context = thread.get_context()</code><ul><li><a href=https://github.com/MarioVilas/winappdbg/blob/master/winappdbg/thread.py#L469 target=_blank rel="noreferrer noopener">get_context source</a></li><li>Manipulate registers in context:<ul><li><code>context["Edx"] = 0x1234</code></li></ul></li></ul></li><li>Set context: <code>thread.set_context(context)</code><ul><li><a href=https://github.com/MarioVilas/winappdbg/blob/master/winappdbg/thread.py#L570 target=_blank rel="noreferrer noopener">set_context source</a></li></ul></li></ul><p>Note: After setting the context, we need to manually change the program counter to start execution at a specific location. For example if we grab the context, change <code>Eip</code> to an address and set it, the program counter will not change. After setting the context, manually change the program counter to your desired address with <code>thread.set_pc(address)</code>.</p><p>For both memory and context operations, make sure to suspend the process/thread first and resume it after the operation is done.</p><h2 id=battle-plan>Battle Plan
<a class=header-link href=#battle-plan><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Now that we have the building blocks, we need to device a battle plan. It's very straightforward.</p><ol><li>Run the application.</li><li>Set breakpoints at <code>0x401036</code> and <code>0x40105B</code>.</li><li>Open a socket and send any random byte.</li><li>At breakpoint <code>0x401036</code>:<ul><li>If it's first_time:<ul><li>Save memory, context and blob at <code>0x40107C</code>.</li></ul></li><li><code>context["Edx"] = key</code> - swap the key.</li><li>key++.</li><li>Bypass the key assignment instruction and manually jump to <code>0x401039</code> with:<ul><li><code>thread.set_pc(0x401039)</code></li></ul></li></ul></li><li>At breakpoint <code>0x40105B</code>:<ul><li>If function return value is <code>0xFB5E</code>, print key.</li><li>Else:<ul><li>Restore memory, context and blob at <code>0x40107C</code> (blob has been modified so it needs to be restored to the original bytes).</li><li>Go back to <code>0x401036</code> with <code>thread.set_pc(0x401036)</code></li></ul></li></ul></li></ol><span class=caption-wrapper><img class=caption src=/images/2017/winappdbg-4/03-bruteforcer-1.png title="Bruteforcing plan" alt="Bruteforcing plan">
<span class=caption-text>Bruteforcing plan</span></span><p>It would have been easier to change the first byte of <code>buf</code> instead of <code>edx</code> and avoiding the jump labeled 2 in the picture.</p><h2 id=bruteforcing-in-action>Bruteforcing in Action
<a class=header-link href=#bruteforcing-in-action><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Code is in the repo and named <code>19-GreekToMe.py</code>. You need to place <code>greek_to_me.exe</code> in the same directory. It's not in the repo so you need to download it from the website.</p><p>That was pretty fast because our address space was only one byte (0x00 to 0xFF).</p><pre tabindex=0><code>$ python 19-GreekToMe.py
[21:23:48.0743] Starting simple_debugger
[21:23:48.0753] Started simple_debugger. Sleeping for 2 seconds.
[21:23:50.0756] Starting send_me.
[21:23:50.0875] Socket connected
[21:23:50.0875] Sent 0
[21:23:53.0490]
-------------------------------------------------------------------------------
Key: 0xa2
Eax: 0000FB5E
[21:23:54.0901] Reached 0x100
</code></pre><h2 id=flag>Flag
<a class=header-link href=#flag><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Run the application in a debugger, set a breakpoint at the "Congratulations!" instruction and send <code>0xA2</code>. The blob results in the correct instructions and we get the flag.</p><p><strong>flag: <a href=mailto:et_tu_brute_force@flare-on.com>et_tu_brute_force@flare-on.com</a></strong></p><h1 id=some-more-analysis---optional-read>Some More Analysis - Optional Read
<a class=header-link href=#some-more-analysis---optional-read><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>This part is optional but I had already written them during the challenge.</p><p>Start of the app:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nasm data-lang=nasm><span style=display:flex><span><span style=color:#268bd2>public</span> <span style=color:#268bd2>start</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>start</span> <span style=color:#268bd2>proc</span> <span style=color:#268bd2>near</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>call</span>    <span style=color:#268bd2>sub_401008</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>xor</span>     <span style=color:#b58900>eax</span>, <span style=color:#b58900>eax</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>retn</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>start</span> <span style=color:#268bd2>endp</span>
</span></span></code></pre></div><p><code>sub_401008</code> is called, then app returns 0 and exits.</p><p>Inside <code>sub_401008</code> we see another subroutine <code>sub_401121</code>. Before that a <code>*buf</code> is pushed (as an argument) and is empty.</p><h2 id=sub_401121>sub_401121
<a class=header-link href=#sub_401121><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>We can see the socket being constructed with <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms742213%28v=vs.85%29.aspx" target=_blank rel="noreferrer noopener">WSAStartup</a>:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nasm data-lang=nasm><span style=display:flex><span><span style=color:#268bd2>lea</span>     <span style=color:#b58900>eax</span>, [<span style=color:#b58900>ebp</span><span style=color:#719e07>+</span><span style=color:#268bd2>WSAData</span>]
</span></span><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#b58900>eax</span>             <span style=color:#586e75>; lpWSAData</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#2aa198>202h</span>            <span style=color:#586e75>; wVersionRequested</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>call</span>    <span style=color:#b58900>ds</span>:<span style=color:#268bd2>WSAStartup</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>test</span>    <span style=color:#b58900>eax</span>, <span style=color:#b58900>eax</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>jz</span>      <span style=color:#268bd2>short</span> <span style=color:#268bd2>loc_401147</span>
</span></span></code></pre></div><p>Then if <code>WSAStartup</code> was successful we can see the port and other parameters being passed to <code>socket</code>. IDA highlights a lot of them for us.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nasm data-lang=nasm><span style=display:flex><span>loc_401147:
</span></span><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#b58900>esi</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#b58900>edi</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#2aa198>6</span>               <span style=color:#586e75>; protocol</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#2aa198>1</span>               <span style=color:#586e75>; type</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#2aa198>2</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>pop</span>     <span style=color:#b58900>edi</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#b58900>edi</span>             <span style=color:#586e75>; af</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>call</span>    <span style=color:#b58900>ds</span>:<span style=color:#268bd2>socket</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>mov</span>     <span style=color:#b58900>esi</span>, <span style=color:#b58900>eax</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>cmp</span>     <span style=color:#b58900>esi</span>, <span style=color:#2aa198>0FFFFFFFFh</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>jz</span>      <span style=color:#268bd2>short</span> <span style=color:#268bd2>loc_4011D8</span>
</span></span></code></pre></div><p>We can see <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms740506%28v=vs.85%29.aspx" target=_blank rel="noreferrer noopener">socket</a> here. And of course the arguments are pushed to the stack from right to left.</p><ul><li>af = 2 = AF_INET = IPv4</li><li>type = 1 = SOCK_STREAM = TCP socket</li><li>protocol = 6 = IPPROTO_TCP = TCP</li></ul><p>The string <code>127.0.0.1</code> is being converted to an inet address with <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms738563%28v=vs.85%29.aspx" target=_blank rel="noreferrer noopener">inet_addr</a>.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nasm data-lang=nasm><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#268bd2>offset</span> <span style=color:#268bd2>cp</span>       <span style=color:#586e75>; &#34;127.0.0.1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>mov</span>     [<span style=color:#b58900>ebp</span><span style=color:#719e07>+</span><span style=color:#268bd2>name.sa_family</span>], <span style=color:#b58900>di</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>call</span>    <span style=color:#b58900>ds</span>:<span style=color:#268bd2>inet_addr</span>
</span></span></code></pre></div><p>Then port with <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms738557%28v=vs.85%29.aspx" target=_blank rel="noreferrer noopener">htons</a>.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nasm data-lang=nasm><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#2aa198>8AEh</span>            <span style=color:#586e75>; hostshort</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>mov</span>     <span style=color:#dc322f>dword</span> <span style=color:#268bd2>ptr</span> [<span style=color:#b58900>ebp</span><span style=color:#719e07>+</span><span style=color:#268bd2>name.sa_data</span><span style=color:#719e07>+</span><span style=color:#2aa198>2</span>], <span style=color:#b58900>eax</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>call</span>    <span style=color:#b58900>ds</span>:<span style=color:#268bd2>htons</span>
</span></span></code></pre></div><p>"The htons function converts a u_short from host to TCP/IP network byte order (which is big-endian)."</p><p>Port number <code>0x8AE</code> is <code>2222</code> decimal.</p><p>Then <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms737550%28v=vs.85%29.aspx" target=_blank rel="noreferrer noopener">bind</a>:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nasm data-lang=nasm><span style=display:flex><span><span style=color:#268bd2>mov</span>     <span style=color:#dc322f>word</span> <span style=color:#268bd2>ptr</span> [<span style=color:#b58900>ebp</span><span style=color:#719e07>+</span><span style=color:#268bd2>name.sa_data</span>], <span style=color:#b58900>ax</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>lea</span>     <span style=color:#b58900>eax</span>, [<span style=color:#b58900>ebp</span><span style=color:#719e07>+</span><span style=color:#268bd2>name</span>]
</span></span><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#2aa198>10h</span>             <span style=color:#586e75>; namelen</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#b58900>eax</span>             <span style=color:#586e75>; name</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#b58900>esi</span>             <span style=color:#586e75>; s</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>call</span>    <span style=color:#b58900>ds</span>:<span style=color:#268bd2>bind</span>
</span></span></code></pre></div><p>"The bind function associates a local address with a socket."</p><p>After there is <code>listen</code>, <code>accept</code> and <code>recv</code> but we already know what they do.</p><p>Finally we are listening on <code>127.0.0.1:2222</code>.</p><p>Let's take a closer look at <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms740121%28v=vs.85%29.aspx" target=_blank rel="noreferrer noopener">recv</a>.</p><p>"The recv function receives data from a connected socket or a bound connectionless socket."</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nasm data-lang=nasm><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#2aa198>0</span>               <span style=color:#586e75>; flags</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#2aa198>4</span>               <span style=color:#586e75>; len</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>push</span>    [<span style=color:#b58900>ebp</span><span style=color:#719e07>+</span><span style=color:#268bd2>buf</span>]       <span style=color:#586e75>; buf</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>push</span>    <span style=color:#b58900>edi</span>             <span style=color:#586e75>; s</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>call</span>    <span style=color:#b58900>ds</span>:<span style=color:#268bd2>recv</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>test</span>    <span style=color:#b58900>eax</span>, <span style=color:#b58900>eax</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>jle</span>     <span style=color:#268bd2>short</span> <span style=color:#268bd2>loc_4011CA</span>
</span></span></code></pre></div><p><code>Buf</code> from the parameter is going to be the pointer to the data received. <code>recv</code> returns the number of bytes received (which going to be in eax).</p><p>If nothing was received, the <code>jle</code> is successful and socket is closed.</p><p>Otherwise the function returns the number of received bytes.</p><p>The rest is explained above.</p><h1 id=conclusion>Conclusion
<a class=header-link href=#conclusion><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>I think I am going to stop writing back-to-back blogs for a few days. I have had 0 off-time. But I am glad I learned WinAppDbg, it will help me a lot in my day job.</p><p>As usual if you have any suggestions or catch any errors, feel free to contact me.</p></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>Parsia</span></span>
<time>Nov 15, 2017</time>
<span class=categories>Tags:
<a class=category href=https://parsiya.net/tags/python>python</a> <a class=category href=https://parsiya.net/tags/flareon>FlareOn</a></span></p><p class=meta><a class="basic-alignment left" href=https://parsiya.net/blog/2017-11-15-winappdbg-part-3-manipulating-function-calls/ title="WinAppDbg - Part 3 - Manipulating Function Calls">WinAppDbg - Part 3 - Manipulating Function Calls</a>
<a class="basic-alignment right" href=https://parsiya.net/blog/2017-11-27-cmd-startup-commands/ title="cmd Startup Commands">cmd Startup Commands</a></p><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//parsiya.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h1>Who am I?</h1><p><p>I am Parsia, an application security engineer.</p><p>I write about application security, cryptography, static analysis, and
(of course) videogames.</p><p>Click on <a href=/about/>About Me!</a> to know more.</p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank rel="me noopener noreferrer" href=https://infosec.exchange/@parsiya title=https://infosec.exchange/@parsiya><i class="fa fa-mastodon fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://github.com/parsiya/ title=https://github.com/parsiya/><i class="fa fa-github fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://twitter.com/cryptogangsta/ title=https://twitter.com/cryptogangsta/><i class="fa fa-twitter fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/in/parsiya title=https://www.linkedin.com/in/parsiya><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><h1>Collections</h1><li><a href=https://parsiya.net/categories/thick-client-proxying/ title="Thick Client Proxying">Thick Client Proxying</a></li><li><a href=https://parsiya.net/categories/writeup/ title=CTFs/Writeups>CTFs/Writeups</a></li><li><a href=https://parsiya.net/categories/attack-surface-analysis/ title="Attack Surface Analysis">Attack Surface Analysis</a></li><li><a href=https://parsiya.net/categories/semgrep/ title=Semgrep>Semgrep</a></li><li><a href=https://parsiya.net/categories/bug-bounty/ title="Bug Bounty">Bug Bounty</a></li><li><a href=https://parsiya.net/categories/blockchain/ title="Blockchain (lol)">Blockchain (lol)</a></li><li><a href=https://parsiya.net/categories/crypto/ title=Crypto(graphy)>Crypto(graphy)</a></li><li><a href=https://parsiya.net/categories/burp-extension/ title="Burp Extension Development">Burp Extension Development</a></li><li><a href=https://parsiya.net/categories/automation/ title=Automation>Automation</a></li><li><a href=https://parsiya.net/categories/reverse-engineering/ title="Reverse Engineering">Reverse Engineering</a></li><li><a href=https://parsiya.net/categories/winappdbg/ title="WinAppDbg (use Frida instead)">WinAppDbg (use Frida instead)</a></li><li><a href=https://awsome.pw title='AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability'>AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability</a></li></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2023 Parsia - <a href=https://parsiya.net/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>