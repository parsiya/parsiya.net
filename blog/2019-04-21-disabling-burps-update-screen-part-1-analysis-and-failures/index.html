<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>Disabling Burp's Update Screen - Part 1 - Analysis and Failures</title><link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://parsiya.net/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Parsia Hakimian Parsiya infosec information security]"><meta name=author content="Parsia"><meta name=generator content="Hugo 0.115.1"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image:src content="https://parsiya.net/blog/2019-04-21-disabling-burps-update-screen-part-1-analysis-and-failures/01.png"><meta name=twitter:title content="Disabling Burp's Update Screen - Part 1 - Analysis and Failures"><meta name=twitter:description content="I tried to disable Burp's update nag screen and failed. This blog post describes
the analysis and my effort to date.
Hacky Workaround: Block outgoing requests to 54.246.133.196 but this will
also, block installing extensions from the Burp app store.
Part two (if there is one) will discuss more things that I tried and did not
work and/or what worked and how you can disable it."><meta name=twitter:domain content="parsiya.net"><meta name=twitter:creator content="@CryptoGangsta"></head><body><header role=banner><hgroup><h1><a href=https://parsiya.net/>Hackerman's Hacking Tutorials</a></h1><h2>The knowledge of anything, since all things have causes, is not acquired or
complete unless it is known by its causes. - Avicenna</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://parsiya.net/about/>» About Me!</option><option value=https://parsiya.net/cheatsheet/>» Cheat Sheet</option><option value=https://parsiya.io/>» My Clone</option><option value=https://github.com/parsiya/parsiya.net>» Source Repo</option><option value="https://queue.acm.org/detail.cfm?id=3197520">» Manual Work is a Bug</option><option value="https://www.google.com/search?q=andrew+ridgeley">» The Other Guy from Wham!</option></select></fieldset><ul class=main-navigation><li><a href=https://parsiya.net/about/ title="About Me!" target=_blank rel="noopener noreferrer">About Me!</a></li><li><a href=https://parsiya.net/cheatsheet/ title="Cheat Sheet" target=_blank rel="noopener noreferrer">Cheat Sheet</a></li><li><a href=https://parsiya.io/ title="My Clone" target=_blank rel="noopener noreferrer">My Clone</a></li><li><a href=https://github.com/parsiya/parsiya.net title="Source Repo" target=_blank rel="noopener noreferrer">Source Repo</a></li><li><a href="https://queue.acm.org/detail.cfm?id=3197520" title="Manual Work is a Bug" target=_blank rel="noopener noreferrer">Manual Work is a Bug</a></li><li><a href="https://www.google.com/search?q=andrew+ridgeley" title="The Other Guy from Wham!" target=_blank rel="noopener noreferrer">The Other Guy from Wham!</a></li></ul><ul class=subscription><a href=https://parsiya.net/index.xml target=_blank type=application/rss+xml title=RSS rel="noopener noreferrer"><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://parsiya.net/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>Apr 21, 2019
- 8 minute read
- <a href=https://parsiya.net/blog/2019-04-21-disabling-burps-update-screen-part-1-analysis-and-failures/#disqus_thread>Comments</a>
- <a class=label href=https://parsiya.net/categories/burp/>burp </a><a class=label href=https://parsiya.net/categories/reverse-engineering/>reverse engineering </a><a class=label href=https://parsiya.net/categories/thick-client-proxying/>thick client proxying</a></p><h1 class=entry-title>Disabling Burp's Update Screen - Part 1 - Analysis and Failures</h1></header><div class=entry-content><nav id=TableOfContents><ul><li><a href=#problem>Problem</a></li><li><a href=#analysis>Analysis</a><ul><li><a href=#installation-options>Installation Options</a></li><li><a href=#hypothetical-update-process>Hypothetical Update Process</a></li><li><a href=#setup>Setup</a></li><li><a href=#network-activity>Network Activity</a><ul><li><a href=#redirecting-by-outgoing-ip-on-windows>Redirecting by Outgoing IP on Windows</a></li></ul></li><li><a href=#what-is-54246133196>What is 54.246.133.196?</a></li></ul></li><li><a href=#whats-inside-the-request>What's Inside the Request</a><ul><li><a href=#proxying-burp-with-burp>Proxying Burp with Burp</a><ul><li><a href=#jar-proxy-settings>Jar Proxy Settings</a></li><li><a href=#jvm-proxy-settings>JVM Proxy Settings</a></li><li><a href=#javanetusesystemproxies>java.net.useSystemProxies</a></li></ul></li></ul></li><li><a href=#hooking>Hooking</a><ul><li><a href=#javasnoop>Javasnoop</a></li><li><a href=#jackplay>Jackplay</a></li><li><a href=#decompiling>Decompiling</a></li></ul></li><li><a href=#whats-next>What's Next?</a></li></ul></nav><p>I tried to disable Burp's update nag screen and failed. This blog post describes
the analysis and my effort to date.</p><p>Hacky Workaround: Block outgoing requests to <code>54.246.133.196</code> but this will
also, block installing extensions from the Burp app store.</p><p>Part two (if there is one) will discuss more things that I tried and did not
work and/or what worked and how you can disable it.</p><p><strong>Disclaimer</strong>: This is not a Burp pro crack/hack.</p><h1 id=problem>Problem
<a class=header-link href=#problem><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>If you still use Burp 1 (which I do at the time of writing in April 2019) you
have seen this annoying update screen every time you start Burp.</p><span class=caption-wrapper><img class=caption src=01.png title="Mindlessly press Close" alt="Mindlessly press Close">
<span class=caption-text>Mindlessly press Close</span></span><p>God knows how much time has been wasted clicking <code>Close</code> collectively. Burp 1 is
under a feature freeze <a href=https://support.portswigger.net/customer/portal/questions/17389565-disable-notification-to-upgrade-to-burp-2- target=_blank rel="noreferrer noopener">so the option will not be added</a>.</p><p>I want to disable this screen. Should be easy enough right?</p><h1 id=analysis>Analysis
<a class=header-link href=#analysis><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>This section talks about my analysis</p><h2 id=installation-options>Installation Options
<a class=header-link href=#installation-options><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>When installing Burp on a Windows machine, you can either install a standalone
jar file or an executable using <code>install4j</code>.</p><p>It does not really make a difference in our analysis. The executable most likely
(I don't know this for sure but I can make an educated guess) just runs the jar
file with the command-line arguments in <code>BurpSuitePro.vmoptions</code>.</p><h2 id=hypothetical-update-process>Hypothetical Update Process
<a class=header-link href=#hypothetical-update-process><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>We can assume the update process is as follows:</p><ol><li>The application detects the local version (or has it hardcoded).</li><li>The application checks the latest version against an online resource.<ol><li>Most likely a web service.</li></ol></li><li>If the current version is older than the latest version, we get the pop-up.</li></ol><h2 id=setup>Setup
<a class=header-link href=#setup><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Next, we need to observe the application to figure out if our hypothesis is
correct and/or how it's done.</p><p>To do so, I dropped Burp pro into one of my analysis Win 10 VM from
<a href=https://modern.ie target=_blank rel="noreferrer noopener">modern.ie</a> and looked at the process.</p><h2 id=network-activity>Network Activity
<a class=header-link href=#network-activity><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>I used <a href="https://www.microsoft.com/en-ca/download/details.aspx?id=4865" target=_blank rel="noreferrer noopener">Microsoft Network Monitor (Netmon)</a><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. Run Burp
and stop the capture after the update dialog is displayed. We do not need
anything after that.</p><p>After filtering by process (which is why I used Netmon) and <code>tls</code>, I saw the
following:</p><span class=caption-wrapper><img class=caption src=02.png title="Burp's startup traffic" alt="Burp's startup traffic">
<span class=caption-text>Burp's startup traffic</span></span><p>In Wireshark, we cannot filter by process but if we are only looking for TLS
connections (and it's a fair assumption that update check is not over HTTP),
we can use this filter to display only <code>ClientHello</code> packets:</p><ul><li><code>ssl.handshake.type == 1</code></li></ul><p>Inside the <code>ClientHello</code> we can see the Server Name Indication (SNI) field. To
learn more about it please read the first section of this Cloudflare blog:</p><ul><li><a href=https://blog.cloudflare.com/encrypted-sni/#snwhy target=_blank rel="noreferrer noopener">https://blog.cloudflare.com/encrypted-sni/#snwhy</a></li></ul><p>The SNI is very useful for proxying. I have been planning to write a blog post
about it for quite a few years now.</p><p>The SNI field for these requests has an IP address instead of a server name.
This means Burp is contacting these IPs by a static IP address and not by a
hostname. This makes our life much harder because it's not doing a DNS lookup.</p><span class=caption-wrapper><img class=caption src=03.png title="SNI field containing an IP address" alt="SNI field containing an IP address">
<span class=caption-text>SNI field containing an IP address</span></span><h3 id=redirecting-by-outgoing-ip-on-windows>Redirecting by Outgoing IP on Windows
<a class=header-link href=#redirecting-by-outgoing-ip-on-windows><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>If the endpoint is contacted by server name and Burp does a DNS lookup, we can
sinkhole/redirect the endpoint using an entry in the <code>hosts</code> file<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. We cannot do
it here which means we have to redirect by IP which is not possible as easily
on Windows without something like iptables. Related post:</p><ul><li><a href=/blog/2016-06-07-windows-netsh-interface-portproxy/ title="Windows Netsh Interface Portproxy">netsh interface portproxy is not iptables</a></li></ul><p>I am not going to talk about redirecting by IP address in this blog. Instead I
am going to discuss what other ways I tried.</p><h2 id=what-is-54246133196>What is 54.246.133.196?
<a class=header-link href=#what-is-54246133196><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>This appears to be a static IP assigned to portswigger's infra hosted at
AWS-eu-west-1 or <code>ec2-54-246-133-196.eu-west-1.compute.amazonaws.com</code>.
If you directly go to this IP in your browser, you are redirected to
<a href=https://portswigger.net/ target=_blank rel="noreferrer noopener">https://portswigger.net/</a>.</p><p>Note: While procmon might show Burp is connecting to the ec2 URL above,
redirecting it to localhost using the <code>hosts</code> file does nothing. It's just
procmon resolving the network address. Press <code>ctrl+N</code> to toggle this behavior.</p><span class=caption-wrapper><img class=caption src=05.png title="Resolved network addresses in procmon" alt="Resolved network addresses in procmon">
<span class=caption-text>Resolved network addresses in procmon</span></span><p><strong>Preliminary Solution 1</strong> \
Blocking this IP will fix the problem. However, it will block access to the
portswigger website and you cannot install extensions from inside Burp anymore.</p><h1 id=whats-inside-the-request>What's Inside the Request
<a class=header-link href=#whats-inside-the-request><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>To proxy the request we have two main options:</p><ol><li>Redirect the traffic.</li><li>Hook the function.</li></ol><h2 id=proxying-burp-with-burp>Proxying Burp with Burp
<a class=header-link href=#proxying-burp-with-burp><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>To redirect the traffic, we could try modifying proxy settings or do manual
redirection.</p><p>The plan is to run one instance of Burp and listen on <code>127.0.0.1:8080</code> and run
a second instance of Burp to proxy the update requests.</p><p>This is not about using Burp in proxy chains. If you want to set that up, please
see <a href=/blog/2016-04-07-thick-client-proxying-part-4-burp-in-proxy-chains/ title="Thick Client Proxying - Part 4: Burp in Proxy Chains">Thick Client Proxying - Part 4: Burp in Proxy Chains</a>.</p><h3 id=jar-proxy-settings>Jar Proxy Settings
<a class=header-link href=#jar-proxy-settings><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Chances are Burp is not going to honor the system and JRE proxy settings but
it's worth a try.</p><p>If using the executable, add the following lines to <code>BurpSuitePro.vmoptions</code>:</p><pre tabindex=0><code>-Dhttp.proxyHost=127.0.0.1
-Dhttp.proxyPort=8080
-Dhttps.proxyHost=127.0.0.1
-Dhttps.proxyPort=8080
</code></pre><p>This is supposed to tell the jar file to use <code>127.0.0.1:8080</code> as a proxy. If
running the jar file manually, pass these as command-line options.</p><p>Running the executable/jar file shows that this has no effect. Burp does not
care about proxy settings when sending those requests.</p><p>On a similar note, using an upstream proxy is also useless. These requests do
not care about the project's upstream proxy.</p><h3 id=jvm-proxy-settings>JVM Proxy Settings
<a class=header-link href=#jvm-proxy-settings><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Another option is to modify <code>net.properties</code>. Note that if you installed
Burp, it is using its own bundled JRE. On Windows, we have to modify the file
inside:</p><ul><li><code>C:\Program Files\BurpSuitePro\jre\lib</code></li></ul><p>If you are running the jar file manually, modify the file in your system's
JRE/JDK.</p><p>We can set similar options (<code>-Dhttp.</code>) in that file and try again. The result is
the same and Burp does not care.</p><h3 id=javanetusesystemproxies>java.net.useSystemProxies
<a class=header-link href=#javanetusesystemproxies><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Another option is to use <code>java.net.useSystemProxies</code>. Setting it to <code>true</code> means
Java will look up the WinINET proxy settings (also called IE proxy settings)
and use them. Use this shortcut <code>control inetcpl.cpl,,4</code>.</p><p>This results in a very odd behavior on Burp's side. Burp tries to use the <code>8080</code>
endpoint as a socks proxy. After establishing a TCP connection, it sends the
following payload:</p><ul><li><code>05 02 00 02</code>.</li></ul><p>Seems like Burp just ignored HTTP proxies and goes directly for socks. Perhaps
for usage in an enterprise environment. This is not some other service, I
checked with procmon to see ports opened to send the request.</p><span class=caption-wrapper><img class=caption src=05.png title="SOCKS errors" alt="SOCKS errors">
<span class=caption-text>SOCKS errors</span></span><p><strong>Preliminary Solution 2</strong> \
Obviously, Burp cannot connect anywhere and the update screen goes away. But
we are also setting up a system-wide proxy setting and wrecking the machine.</p><h1 id=hooking>Hooking
<a class=header-link href=#hooking><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>It's possible to hook Java methods and they are somewhat more straightforward
than hooking native methods.</p><p>I tried a few hooking methods and had some success:</p><h2 id=javasnoop>Javasnoop
<a class=header-link href=#javasnoop><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p><a href=https://code.google.com/archive/p/javasnoop/downloads target=_blank rel="noreferrer noopener">Javasnoop</a> is fairly old but I had used it in the past to
hook Java apps with success. In our case, it did not work because you cannot
create hooks before executing the Burp jar. Meaning by the time I could setup
hooks, the update had already happened.</p><p>This can be useful later because Burp has a <code>Check for Updates</code> button inside
which can be used to redo the whole thing. It's the same method as the one
used at startup.</p><h2 id=jackplay>Jackplay
<a class=header-link href=#jackplay><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p><a href=https://github.com/alfredxiao/jackplay target=_blank rel="noreferrer noopener">Jackplay</a> is a profiling tool with a web interface. It can
be used to trace Java methods, look at their parameters and modify their
contents. I played with it a bit and it seemed to work somewhat. It's definitely
something I am going to use in the future.</p><h2 id=decompiling>Decompiling
<a class=header-link href=#decompiling><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>To hook, we need to figure out what is sending out the requests.
Most classes in Burp's jar are obfuscated<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>. I tried a few
decompilers on it.</p><p><a href=https://www.benf.org/other/cfr/ target=_blank rel="noreferrer noopener">CFR</a> got stuck on some parts inside classes. For example, <code>burp.StartBurp</code>
which contains <code>main</code>.</p><p><a href=https://bitbucket.org/mstrobel/procyon/wiki/Java%20Decompiler target=_blank rel="noreferrer noopener">Procyon</a> mostly worked but got stuck on some large class files. I
tried to decompile all files in the jar with:</p><ul><li><code>java -jar procyon.jar -jar burp.jar -o decompiled-procyon</code></li></ul><p>The workaround is to extract the jar file into a directory like <code>burp</code> and then
run the following command:</p><ul><li><code>java -jar procyon.jar -jar burp\*.class -o decompiled-procyon</code></li></ul><p>If Procyon gets stuck on a large file, stop the decompilation, remove the file,
remove the previous classes that were decompiled, and execute the command again.
Or just go and rename the extension of some large class files before running
the decompiler.</p><p>These class files gave me problems:</p><ul><li><code>caj</code></li><li><code>d5d</code></li><li><code>l0c</code></li><li><code>qhf</code></li><li><code>fp</code></li><li>and more.</li></ul><h1 id=whats-next>What's Next?
<a class=header-link href=#whats-next><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>I am going to stop for now. Future plans include but are not limited to:</p><ol><li>Setup Burp in a *nix VM and redirect traffic to another Burp instance in
another VM with iptables.</li><li>Look inside decompile code to figure out what methods are used to make the
requests. It's probably going to be some standard Java method. Then hook
those methods and look at the requests/responses.</li><li>Try something like EchoMirage. Use it in a VM and then nuke the VM.</li><li>Try hooking with Frida or WinAppDbg. It might not be needed if we can hook
with Java-specific tools mentioned above.</li></ol><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>After installing Netmon for the first time and before a logoff/restart, you need to run it as admin. Otherwise, it can not see any network interfaces.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>This adds an entry to the local Windows DNS cache. View it with <code>ipconfig /displaydns</code> or <code>Get-DnsClientCache</code>.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>I do not know enough about Java obfuscators to figure out what's used.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>Parsia</span></span>
<time>Apr 21, 2019</time>
<span class=categories>Tags:
<a class=category href=https://parsiya.net/tags/procmon>procmon</a></span></p><p class=meta><a class="basic-alignment left" href=https://parsiya.net/blog/2019-04-17-the-dark-side-of-manual-work-is-a-bug/ title='The Dark Side of "Manual Work is a Bug"'>The Dark Side of "Manual Work is a Bug"</a>
<a class="basic-alignment right" href=https://parsiya.net/blog/2019-04-28-thick-client-proxying-part-9-the-windows-dns-cache/ title="Thick Client Proxying - Part 9 - The Windows DNS Cache">Thick Client Proxying - Part 9 - The Windows DNS Cache</a></p><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//parsiya.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h1>Who am I?</h1><p><p>I am Parsia, an application security engineer.</p><p>I write about application security, cryptography, static analysis, and
(of course) videogames.</p><p>Click on <a href=/about/>About Me!</a> to know more.</p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank rel="me noopener noreferrer" href=https://infosec.exchange/@parsiya title=https://infosec.exchange/@parsiya><i class="fa fa-mastodon fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://github.com/parsiya/ title=https://github.com/parsiya/><i class="fa fa-github fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://twitter.com/cryptogangsta/ title=https://twitter.com/cryptogangsta/><i class="fa fa-twitter fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/in/parsiya title=https://www.linkedin.com/in/parsiya><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><h1>Collections</h1><li><a href=https://parsiya.net/categories/thick-client-proxying/ title="Thick Client Proxying">Thick Client Proxying</a></li><li><a href=https://parsiya.net/categories/writeup/ title=CTFs/Writeups>CTFs/Writeups</a></li><li><a href=https://parsiya.net/categories/attack-surface-analysis/ title="Attack Surface Analysis">Attack Surface Analysis</a></li><li><a href=https://parsiya.net/categories/semgrep/ title=Semgrep>Semgrep</a></li><li><a href=https://parsiya.net/categories/bug-bounty/ title="Bug Bounty">Bug Bounty</a></li><li><a href=https://parsiya.net/categories/blockchain/ title="Blockchain (lol)">Blockchain (lol)</a></li><li><a href=https://parsiya.net/categories/crypto/ title=Crypto(graphy)>Crypto(graphy)</a></li><li><a href=https://parsiya.net/categories/burp-extension/ title="Burp Extension Development">Burp Extension Development</a></li><li><a href=https://parsiya.net/categories/automation/ title=Automation>Automation</a></li><li><a href=https://parsiya.net/categories/reverse-engineering/ title="Reverse Engineering">Reverse Engineering</a></li><li><a href=https://parsiya.net/categories/winappdbg/ title="WinAppDbg (use Frida instead)">WinAppDbg (use Frida instead)</a></li><li><a href=https://awsome.pw title='AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability'>AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability</a></li></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2023 Parsia - <a href=https://parsiya.net/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>