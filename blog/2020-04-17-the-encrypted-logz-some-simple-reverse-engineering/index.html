<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>The Encrypted Logz - Some Simple Reverse Engineering</title>
<link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://parsiya.net/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Parsia Hakimian Parsiya infosec information security]"><meta name=author content="Parsia"><meta name=generator content="Hugo 0.121.2"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image:src content="https://parsiya.net/blog/2020-04-17-the-encrypted-logz-some-simple-reverse-engineering/19-generate.png"><meta name=twitter:title content="The Encrypted Logz - Some Simple Reverse Engineering"><meta name=twitter:description content="I was looking at an application (not related to my day job) and I decided to
reverse engineer how it creates logs. I cannot name the app (yet) but hopefully,
this is useful."><meta name=twitter:domain content="parsiya.net"><meta name=twitter:creator content="@CryptoGangsta"></head><body><header role=banner><hgroup><h1><a href=https://parsiya.net/>Hackerman's Hacking Tutorials</a></h1><h2>The knowledge of anything, since all things have causes, is not acquired or
complete unless it is known by its causes. - Avicenna</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://parsiya.net/about/>» About Me!</option><option value=https://parsiya.net/cheatsheet/>» Cheat Sheet</option><option value=https://parsiya.io/>» My Clone</option><option value=https://github.com/parsiya/parsiya.net>» Source Repo</option><option value="https://queue.acm.org/detail.cfm?id=3197520">» Manual Work is a Bug</option><option value="https://www.google.com/search?q=andrew+ridgeley">» The Other Guy from Wham!</option></select></fieldset><ul class=main-navigation><li><a href=https://parsiya.net/about/ title="About Me!" target=_blank rel="noopener noreferrer">About Me!</a></li><li><a href=https://parsiya.net/cheatsheet/ title="Cheat Sheet" target=_blank rel="noopener noreferrer">Cheat Sheet</a></li><li><a href=https://parsiya.io/ title="My Clone" target=_blank rel="noopener noreferrer">My Clone</a></li><li><a href=https://github.com/parsiya/parsiya.net title="Source Repo" target=_blank rel="noopener noreferrer">Source Repo</a></li><li><a href="https://queue.acm.org/detail.cfm?id=3197520" title="Manual Work is a Bug" target=_blank rel="noopener noreferrer">Manual Work is a Bug</a></li><li><a href="https://www.google.com/search?q=andrew+ridgeley" title="The Other Guy from Wham!" target=_blank rel="noopener noreferrer">The Other Guy from Wham!</a></li></ul><ul class=subscription><a href=https://parsiya.net/index.xml target=_blank type=application/rss+xml title=RSS rel="noopener noreferrer"><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://parsiya.net/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>Apr 17, 2020
- 19 minute read
- <a href=https://parsiya.net/blog/2020-04-17-the-encrypted-logz-some-simple-reverse-engineering/#disqus_thread>Comments</a>
- <a class=label href=https://parsiya.net/categories/reverse-engineering/>reverse engineering </a><a class=label href=https://parsiya.net/categories/crypto/>crypto</a></p><h1 class=entry-title>The Encrypted Logz - Some Simple Reverse Engineering</h1></header><div class=entry-content><nav id=TableOfContents><ul><li><a href=#what-does-it-look-like>What does it Look Like?</a></li><li><a href=#symbols>Symbols</a><ul><li><a href=#qt5-symbols>Qt5 Symbols</a><ul><li><a href=#ghidra-pdb-issues>Ghidra PDB Issues</a></li></ul></li><li><a href=#importing-from-ida-to-ghidra>Importing from IDA to Ghidra</a></li></ul></li><li><a href=#analysis>Analysis</a><ul><li><a href=#just-guess-until-you-find-something>Just Guess Until You Find Something</a><ul><li><a href=#the-encryption-algorithm>The Encryption Algorithm</a></li><li><a href=#min-and-max-values>Min and Max Values</a></li></ul></li><li><a href=#the-bad-route>The Bad Route</a><ul><li><a href=#debug-mode>Debug mode</a></li><li><a href=#back-to-hunting-for-encryption>Back to Hunting for Encryption</a></li><li><a href=#rage-quit>Rage Quit</a></li></ul></li></ul></li><li><a href=#decryptlog-code>DecryptLog Code</a></li><li><a href=#what-did-we-learn-here-today>What Did We Learn Here Today?</a></li></ul></nav><p>I was looking at an application (not related to my day job) and I decided to
reverse engineer how it creates logs. I cannot name the app (yet) but hopefully,
this is useful.</p><h1 id=what-does-it-look-like>What does it Look Like?
<a class=header-link href=#what-does-it-look-like><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>I executed the app and saw events in procmon creating logs in.</p><ul><li><code>C:\Users\Parsia\AppData\Local\[brand]\[app-suite-name]\Logs</code>.</li></ul><p>Opened a log file and it looked encrypted. Why encrypted? Look at all the jumble
of data with high entropy. These kinds of files usually either compressed files
or encrypted data.</p><p>How do we know it's encrypted? Compressed files usually have large headers. So
the start of the file does not have high entropy. This one has a tiny header and
we can see the word <code>LOGZ</code>.</p><span class=caption-wrapper><img class=caption src=01-encrypted-log.png title="Encrypted log" alt="Encrypted log">
<span class=caption-text>Encrypted log</span></span><p>How do we figure out who writes to it? Procmon.</p><ol><li>Run procmon.</li><li>Set filter.<code>Path</code> - <code>begins with</code> - <code>path/to/log/directory</code>.</li><li>Run the app.</li><li>See who edits the log.</li></ol><span class=caption-wrapper><img class=caption src=02-procmon-filter.png title="procmon filter" alt="procmon filter">
<span class=caption-text>procmon filter</span></span><p>We can see the file access events. It's the main <code>app.exe</code>.</p><span class=caption-wrapper><img class=caption src=03-procmon-events.png title="Log write events in procmon" alt="Log write events in procmon">
<span class=caption-text>Log write events in procmon</span></span><p>Double-click on an event and select the <code>Stack</code> tab. It's using <code>Qt5Core.dll 5.9.2.0</code>.</p><span class=caption-wrapper><img class=caption src=04-event-stack.png title="Log write stack" alt="Log write stack">
<span class=caption-text>Log write stack</span></span><h1 id=symbols>Symbols
<a class=header-link href=#symbols><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>Having symbols is nice. Qt5 is an open source project and we can download its
symbols.</p><h2 id=qt5-symbols>Qt5 Symbols
<a class=header-link href=#qt5-symbols><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>You can find the symbols for version <code>5.9.2.0</code> at:</p><ul><li><a href=https://download.qt.io/archive/qt/5.9/5.9.2/ target=_blank rel="noreferrer noopener">https://download.qt.io/archive/qt/5.9/5.9.2/</a></li></ul><p>Because we are running an x86 app (32-bit) and it's a desktop version (not UWP),
we are looking for this file
<code>qt-opensource-windows-x86-pdb-files-desktop-5.9.2.zip</code> on the page above.</p><p>Inside the archive, there are a bunch of Windows 8.1 and Windows 10 files. We do
not need the Windows 8.1 files.</p><p>Windows 10 files come in four flavors:</p><ul><li>x86 vs. x64: We will choose 32-bit.</li><li>MSVC 2015 vs. MSVC 2017: How do we figure this out?</li></ul><span class=caption-wrapper><img class=caption src=05-qt-pdb.png title="Qt PDBs" alt="Qt PDBs">
<span class=caption-text>Qt PDBs</span></span><p>Looking inside the app directory we can see all the Qt5 DLLs.</p><span class=caption-wrapper><img class=caption src=06-qt-dlls.png title="Qt DLLs" alt="Qt DLLs">
<span class=caption-text>Qt DLLs</span></span><p>We already know it's a 32-bit DLL. Scroll back up and look at the <code>Address</code>
column in the procmon event stack image. It has only 4 bytes or 32-bits.</p><p>To detect the MSVC version we must discover the linker info.</p><p><a href=https://github.com/horsicq/Detect-It-Easy target=_blank rel="noreferrer noopener">Detect It Easy</a> does the job and
tells us it's linker version 14 or MSVC 2015 <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><span class=caption-wrapper><img class=caption src=07-detect-it-ez.png title="'Detect It Easy' results" alt="'Detect It Easy' results">
<span class=caption-text>'Detect It Easy' results</span></span><p>We can discard the unneeded symbols. Let's put the correct PDBs inside
<code>C:\Symbols\@MySymbols</code>. The symbol lookup is alphabetical so you put all of
your symbols further up in the chain to make it faster (is this still a thing?).</p><h3 id=ghidra-pdb-issues>Ghidra PDB Issues
<a class=header-link href=#ghidra-pdb-issues><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>As an example, I dropped <code>Qt5Core.dll</code> in Ghidra and loaded the PDB via
<code>File (menu) > Load PDB File</code>. I got a bunch of errors</p><pre tabindex=0><code>PDB&gt; Unable to create stack variable buffer at offset -4 in ?createNativeFile@QTemporaryFile@@SAPAV1@AAVQFile@@@Z
PDB&gt; Unable to create stack variable dt at offset -4 in ?toDateTime@QLocale@@QBE?AVQDateTime@@ABVQString@@0@Z
PDB&gt; Unable to create stack variable indices at offset -4 in ?replace@QByteArray@@QAEAAV1@PBDH0H@Z
PDB&gt; Unable to create stack variable buf at offset -4 in ?processNameByPid@QLockFilePrivate@@SA?AVQString@@_J@Z
PDB&gt; Unable to create stack variable tzi at offset -4 in getRegistryTzi
</code></pre><p>Unfortunately, Ghidra's PDB import is not that great. To troubleshoot we can
also, generate the XML file via the <code>pdb.exe</code> command.</p><ul><li><code>ghidra_9.1.2_PUBLIC\Ghidra\Features\PDB\os\win64\pdb.exe c:\path\to\pdb -fulloutput > somefile.pdb.xml</code></li></ul><p>This resulting xml can be imported in Ghidra instead of the PDB file. This is not going
to help us here but it can show us where the issue is. It's also useful for
<a href=https://dannyquist.github.io/windows-symbols-ghidra/ target=_blank rel="noreferrer noopener">creating for Ghidra usage in non-Windows operating systems</a>.</p><p>The tool creates a 100MB file for <code>Qt5Core.dll</code>. Navigating to the file we can
see that it's cut-off somewhere.</p><span class=caption-wrapper><img class=caption src=08-symbol-xml.png title="PDB xml for Qt5Core.dll" alt="PDB xml for Qt5Core.dll">
<span class=caption-text>PDB xml for Qt5Core.dll</span></span><p>There were also issues with the <code>2000</code> character limit for symbols. This is a
<a href=https://github.com/NationalSecurityAgency/ghidra/issues/94#issuecomment-512855100 target=_blank rel="noreferrer noopener">known problem</a>.</p><h2 id=importing-from-ida-to-ghidra>Importing from IDA to Ghidra
<a class=header-link href=#importing-from-ida-to-ghidra><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>I also tried importing the PDB in IDA Freeware 7.0 and it worked perfectly.</p><span class=caption-wrapper><img class=caption src=09-ida-freeware.png title="PDB loaded in IDA Freeware 7.0" alt="PDB loaded in IDA Freeware 7.0">
<span class=caption-text>PDB loaded in IDA Freeware 7.0</span></span><p>In these situations, one option is to import the symbols in IDA and then use the
Ghidra plugin to export the project. You can import it in Ghidra. This needs
IDAPython which is not available in IDA Freeware.</p><p>At this point, I had enough to get started on decrypting the logs.</p><h1 id=analysis>Analysis
<a class=header-link href=#analysis><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>Now we can get into the main executable. Fortunately, (for me) the installer
includes the PDB files for the main executables. This is great news.</p><span class=caption-wrapper><img class=caption src=22-pdbs.png title="PDBs included with the installer" alt="PDBs included with the installer">
<span class=caption-text>PDBs included with the installer</span></span><p>Dropping the main <code>exe</code> into Ghidra and the PDB resulted in a lot of errors. Similar
to the errors above but it does not stop us. Then we can do <code>Auto Analysis</code> to
continue. The result is not as great as IDA but it's great for paying 0 dollars.</p><p>How do we proceed from here? We can:</p><ol><li>Randomly search for things.</li><li>Trace the writes to log files.</li></ol><h2 id=just-guess-until-you-find-something>Just Guess Until You Find Something
<a class=header-link href=#just-guess-until-you-find-something><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>When you encrypt a file, you have to be able to decrypt it too. Having symbols
means we can search for <code>decrypt</code> (or <code>encrypt</code>). Decrypt is probably easier to
trace because the log files are encrypted as the messages come but decryption
usually happens in one go so everything might be in one place.</p><p>I searched for <code>Decrypt</code> and found the function that decrypts a log file named,
well, <code>DecryptLogFile</code>.</p><span class=caption-wrapper><img class=caption src=21-decryptlogfile.png title="DecryptLogFile function" alt="DecryptLogFile function">
<span class=caption-text>DecryptLogFile function</span></span><p><code>DecryptLogFile</code> appears to be a wrapper for <code>FUN_008f6100</code>.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>string <span style=color:#268bd2>__cdecl</span> <span style=color:#268bd2>DecryptLogFile</span>(path <span style=color:#719e07>*</span>param_1, path <span style=color:#719e07>*</span>param_2)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  FUN_008f6100(param_1,param_2);
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> param_1;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The parameters are of type <code>boost::filesystem::path</code>. We can guess one of them
is the encrypted log file and the other is where the decrypted results will be
stored. Let's look at the assembly for <code>FUN_008f6100</code>. I have cleaned up the
decompiled code.</p><p>Notice the difference between the number of parameters above and in the
function? I am not sure where <code>param_1</code> comes from? Maybe it's a field and
<code>FUN_008f6100</code> is actually a method (i.e., <code>thiscall</code>)?</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#dc322f>void</span> <span style=color:#268bd2>FUN_008f6100</span>(std<span style=color:#719e07>::</span>string <span style=color:#719e07>*</span>param_1, path inputFile, path outputFile)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    QIODevice<span style=color:#719e07>::</span>QIODevice qioDevice [<span style=color:#2aa198>8</span>];
</span></span><span style=display:flex><span>    inputFileString <span style=color:#719e07>=</span> QString<span style=color:#719e07>::</span>fromStdWString((std<span style=color:#719e07>::</span>basic_string <span style=color:#719e07>*</span>)<span style=color:#719e07>&amp;</span>inputFile);
</span></span><span style=display:flex><span>    QFile<span style=color:#719e07>::</span>QFile(qioDevice, inputFileString));
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    isInputFileOpened <span style=color:#719e07>=</span> open(qioDevice,(QFlags<span style=color:#719e07>&lt;</span>enum_QIODevice<span style=color:#719e07>::</span>OpenModeFlag<span style=color:#719e07>&gt;</span>)<span style=color:#2aa198>0x1</span>);
</span></span><span style=display:flex><span>    <span style=color:#719e07>if</span> (isInputFileOpened <span style=color:#719e07>==</span> <span style=color:#b58900>false</span>) {
</span></span><span style=display:flex><span>       cout <span style=color:#719e07>&lt;&lt;</span> <span style=color:#2aa198>&#34;Can</span><span style=color:#cb4b16>\&#39;</span><span style=color:#2aa198>t open input file&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#719e07>else</span> {
</span></span><span style=display:flex><span>        inputSize <span style=color:#719e07>=</span> size(qioDevice);
</span></span><span style=display:flex><span>        <span style=color:#719e07>if</span> ( inputSize <span style=color:#719e07>&gt;</span> <span style=color:#719e07>-</span><span style=color:#2aa198>1</span>) {
</span></span><span style=display:flex><span>            inputDataStream <span style=color:#719e07>=</span> QDataStream<span style=color:#719e07>::</span>QDataStream(qioDevice);
</span></span><span style=display:flex><span>            fourCharString <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;    &#34;</span>;
</span></span><span style=display:flex><span>            fourCharStringPtr <span style=color:#719e07>=</span> <span style=color:#719e07>*</span>fourCharString;
</span></span><span style=display:flex><span>            QDataStream<span style=color:#719e07>::</span>readRawData(inputDataStream, fourCharStringPtr, <span style=color:#2aa198>4</span>);
</span></span><span style=display:flex><span>            <span style=color:#719e07>if</span> (fourCharStringPtr <span style=color:#719e07>==</span> c_header) <span style=color:#586e75>// c_header = LOGZ {
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>                <span style=color:#586e75>// Read four more bytes
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>                versionString <span style=color:#719e07>=</span> QDataStream(inputFileStream, <span style=color:#2aa198>4</span>);
</span></span><span style=display:flex><span>                <span style=color:#719e07>if</span> (versionString <span style=color:#719e07>==</span> <span style=color:#2aa198>0x2010ab01</span>) {
</span></span><span style=display:flex><span>                    outputFileString <span style=color:#719e07>=</span> QString<span style=color:#719e07>::</span>fromStdWString((std<span style=color:#719e07>::</span>basic_string <span style=color:#719e07>*</span>)<span style=color:#719e07>&amp;</span>outputFile);
</span></span><span style=display:flex><span>                    outputFile <span style=color:#719e07>=</span> QFile<span style=color:#719e07>::</span>QFile(outputFileString));
</span></span><span style=display:flex><span>                    isOutputFileOpened <span style=color:#719e07>=</span> QFile<span style=color:#719e07>::</span>open(outputFileStream,(QFlags<span style=color:#719e07>&lt;</span>enum_QIODevice<span style=color:#719e07>::</span>OpenModeFlag<span style=color:#719e07>&gt;</span>)<span style=color:#2aa198>0xa</span>);
</span></span><span style=display:flex><span>                    <span style=color:#719e07>if</span> (isOutputFileOpened <span style=color:#719e07>==</span> <span style=color:#b58900>false</span>) {
</span></span><span style=display:flex><span>                        cout <span style=color:#719e07>&lt;&lt;</span> <span style=color:#2aa198>&#34;Can</span><span style=color:#cb4b16>\&#39;</span><span style=color:#2aa198>t open output file&#34;</span>;
</span></span><span style=display:flex><span>                    } <span style=color:#719e07>else</span> {
</span></span><span style=display:flex><span>                        <span style=color:#586e75>// This is where decryption happens.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>                        FUN_008f6bd0(param_1, inputDataStream, outputFileStream);
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                <span style=color:#719e07>else</span> {
</span></span><span style=display:flex><span>                } <span style=color:#719e07>else</span> {
</span></span><span style=display:flex><span>                    cout <span style=color:#719e07>&lt;&lt;</span> <span style=color:#2aa198>&#34;Bad version&#34;</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            } <span style=color:#719e07>else</span> {
</span></span><span style=display:flex><span>                cout <span style=color:#719e07>&lt;&lt;</span> <span style=color:#2aa198>&#34;Bad header&#34;</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>    <span style=color:#719e07>return</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This function does some sanity checks.</p><ol><li>Checks if the input file exists and can be opened.</li><li>Reads the first four bytes and compares them with <code>LOGZ</code>. If not prints <code>Bad Header</code>.</li><li>Reads the second four bytes and compares them with <code>0x2010ab01</code>. If not prints <code>Bad Version</code>.</li><li>Creates the output file.</li></ol><p>We have already seen the header and version bytes in the encrypted log file
above. They appear at the start of every encrypted log file, too.</p><p>Our next destination is <code>FUN_008f6bd0(param_1, inputDataStream, outputFileStream)</code>
where the main decryption happens.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#dc322f>void</span> <span style=color:#268bd2>FUN_008f6bd0</span>(std<span style=color:#719e07>::</span>string param_1, QDataStream<span style=color:#719e07>::</span>QDataStream inputData, QDataStream<span style=color:#719e07>::</span>QDataStream outputData)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Initialize the PRNG.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    mersenne_twister_engine<span style=color:#719e07>&lt;</span>unsigned_int<span style=color:#719e07>&gt;</span> mtPRNG [<span style=color:#2aa198>2500</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#586e75>// See it with the default seed (0x1571). This is what the constructor does.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    seed(mtPRNG, <span style=color:#719e07>&amp;</span>default_seed);
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    appSeed <span style=color:#719e07>=</span> <span style=color:#2aa198>0x25082011</span>;
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Seed the PRNG with the correct seed.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    seed(mtPRNG,<span style=color:#719e07>&amp;</span>appSeed);
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Get a buffer of 20000 bytes.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#586e75>// Removed code creates an output buffer named outputBuffer. 
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    ByteArray((ByteArray <span style=color:#719e07>*</span>)<span style=color:#719e07>&amp;</span>bufferByteArray20000,<span style=color:#2aa198>0x20000</span>,<span style=color:#2aa198>&#39;\0&#39;</span>,<span style=color:#2aa198>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#719e07>while</span>( <span style=color:#b58900>true</span> ) {
</span></span><span style=display:flex><span>        <span style=color:#586e75>// Try and read 20000 bytes.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>        numberOfBytesRead <span style=color:#719e07>=</span> <span style=color:#719e07>*</span>(<span style=color:#dc322f>int</span> <span style=color:#719e07>*</span>)(bufferByteArray20000 <span style=color:#719e07>+</span> <span style=color:#2aa198>8</span>);
</span></span><span style=display:flex><span>        <span style=color:#586e75>// Get a wrapper with the input buffer
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>        inputBuffer <span style=color:#719e07>=</span> (<span style=color:#dc322f>char</span> <span style=color:#719e07>**</span>)Get((DataWrap <span style=color:#719e07>*</span>)<span style=color:#719e07>&amp;</span>bufferByteArray20000);
</span></span><span style=display:flex><span>        <span style=color:#586e75>// Read 20000 bytes.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>        numberOfBytesRead <span style=color:#719e07>=</span>
</span></span><span style=display:flex><span>                QDataStream<span style=color:#719e07>::</span>ReadRawData(inputData,<span style=color:#719e07>*</span>inputBuffer,numberOfBytesRead);
</span></span><span style=display:flex><span>        <span style=color:#586e75>// Pass them to `FUN_008f6370`.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>        FUN_008f6370(inputBuffer, outputBuffer, numberOfBytesRead);
</span></span><span style=display:flex><span>        <span style=color:#719e07>if</span> (numberOfBytesRead <span style=color:#719e07>&lt;</span> <span style=color:#2aa198>1</span>) <span style=color:#719e07>break</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#586e75>// removed
</span></span></span></code></pre></div><p><code>mersenne_twister_engine&lt;unsigned_int, ...</code> is a PRNG.</p><ul><li><a href=http://www.cplusplus.com/reference/random/mt19937/ target=_blank rel="noreferrer noopener">http://www.cplusplus.com/reference/random/mt19937/</a></li></ul><p>It's not cryptographically secure but we are encrypting some random local log
files. It's seeded twice. First one is the <code>default_seed</code> followed by
<code>0x25082011</code>. The default seed is <code>0x1571</code> and the constructor does it
automatically.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;random&gt;</span><span style=color:#719e07>
</span></span></span><span style=display:flex><span><span style=color:#719e07></span><span style=color:#586e75>// Constructor automatically seeds it with 0x1571 and then 0x25082011.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>mt19937 <span style=color:#268bd2>generator</span>(<span style=color:#2aa198>0x25082011</span>);
</span></span></code></pre></div><p>A 20000 byte buffer is read from input and passed to <code>FUN_008f6370</code>.
This function is a wrapper for <code>FUN_008f6370</code>:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>undefined4 <span style=color:#268bd2>FUN_008f6370</span>(ByteArray<span style=color:#719e07>*</span> inputBuffer, byte<span style=color:#719e07>*</span> outputBuffer, uint numberOfBytesRead)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  FUN_008f5d90(inputBuffer, outputBuffer, numberOfBytesRead);
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> param_1;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>FUN_008f5d90</code> is the most interesting function. We see our twister again.</p><span class=caption-wrapper><img class=caption src=17-local80.png title="Mersenne Twister Engine" alt="Mersenne Twister Engine">
<span class=caption-text>Mersenne Twister Engine</span></span><p>Further down we see references to
<code>..\\..\\..\\src\\RcLogV2\\Output\\LogEncFileOutputV2.cpp</code> and some classes that
look interesting thanks to <code>assert</code> statements.</p><span class=caption-wrapper><img class=caption src=18-assert.png title="Assert statements" alt="Assert statements">
<span class=caption-text>Assert statements</span></span><p>If we search for <code>local_80</code> in the decompiled code, we see this interesting
function <code>boost::random::mersenne_twister_engine::generate_uniform_int</code>.</p><span class=caption-wrapper><img class=caption src=19-generate.png title=generate_uniform_int alt=generate_uniform_int>
<span class=caption-text>generate_uniform_int</span></span><p>Surprisingly, I could not find it in the docs but managed to find it in the
<code>hpp</code> files.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>emplate<span style=color:#719e07>&lt;</span><span style=color:#719e07>class</span> <span style=color:#268bd2>Engine</span>, <span style=color:#719e07>class</span> <span style=color:#268bd2>T</span><span style=color:#719e07>&gt;</span>
</span></span><span style=display:flex><span>T generate_uniform_int(
</span></span><span style=display:flex><span>    Engine<span style=color:#719e07>&amp;</span> eng, T min_value, T max_value,
</span></span><span style=display:flex><span>    boost<span style=color:#719e07>::</span>mpl<span style=color:#719e07>::</span>true_ <span style=color:#586e75>/** is_integral&lt;Engine::result_type&gt; */</span>)
</span></span><span style=display:flex><span>{
</span></span></code></pre></div><p>It generates <code>uint32</code> values (because we are using the int32 version of the
Mersenne Twister) between min and max values. The function call in assembly is:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5fb3</span> <span style=color:#2aa198>8</span><span style=color:#cb4b16>b</span> <span style=color:#2aa198>5</span><span style=color:#cb4b16>d</span> <span style=color:#cb4b16>ec</span>        <span style=color:#cb4b16>MOV</span>        <span style=color:#cb4b16>EBX</span>,<span style=color:#cb4b16>dword</span> <span style=color:#cb4b16>ptr</span> [<span style=color:#cb4b16>EBP</span> + <span style=color:#cb4b16>local_84</span>] <span style=color:#586e75>; param_1
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>        <span style=color:#268bd2>LAB_008f5fb6</span>                                    <span style=color:#cb4b16>XREF</span>[<span style=color:#2aa198>1</span>]:     <span style=color:#2aa198>008</span><span style=color:#cb4b16>f5fe3</span>(<span style=color:#cb4b16>j</span>)  
</span></span><span style=display:flex><span><span style=color:#2aa198>008</span><span style=color:#cb4b16>f5fb6</span> <span style=color:#2aa198>8</span><span style=color:#cb4b16>b</span> <span style=color:#2aa198>45</span> <span style=color:#cb4b16>f0</span>        <span style=color:#cb4b16>MOV</span>        <span style=color:#cb4b16>EAX</span>,<span style=color:#cb4b16>dword</span> <span style=color:#cb4b16>ptr</span> [<span style=color:#cb4b16>EBP</span> + <span style=color:#cb4b16>local_80</span>] <span style=color:#586e75>; mtPRNG
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>008<span style=color:#268bd2>f5fb9</span> <span style=color:#2aa198>53</span>              <span style=color:#cb4b16>PUSH</span>       <span style=color:#cb4b16>EBX</span>
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5fba</span> <span style=color:#cb4b16>ff</span> <span style=color:#cb4b16>b0</span> <span style=color:#cb4b16>c8</span>        <span style=color:#cb4b16>PUSH</span>       <span style=color:#cb4b16>dword</span> <span style=color:#cb4b16>ptr</span> [<span style=color:#cb4b16>EAX</span> + <span style=color:#2aa198>0x9c8</span>] <span style=color:#586e75>; *mtPRNG+2054
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>            09 00 00
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5fc0</span> <span style=color:#cb4b16>ff</span> <span style=color:#cb4b16>b0</span> <span style=color:#cb4b16>c4</span>        <span style=color:#cb4b16>PUSH</span>       <span style=color:#cb4b16>dword</span> <span style=color:#cb4b16>ptr</span> [<span style=color:#cb4b16>EAX</span> + <span style=color:#2aa198>0x9c4</span>] <span style=color:#586e75>; *mtPRNG+2058
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>            09 00 00
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5fc6</span> <span style=color:#2aa198>50</span>              <span style=color:#cb4b16>PUSH</span>       <span style=color:#cb4b16>EAX</span> <span style=color:#586e75>; mtPRNG
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>008<span style=color:#268bd2>f5fc7</span> <span style=color:#cb4b16>e8</span> <span style=color:#2aa198>24</span> <span style=color:#cb4b16>f5</span>        <span style=color:#cb4b16>CALL</span>       <span style=color:#cb4b16>boost</span>::<span style=color:#cb4b16>random</span>::<span style=color:#cb4b16>detail</span>::<span style=color:#cb4b16>generate_uniform_int</span>
</span></span><span style=display:flex><span>            <span style=color:#268bd2>ff</span> <span style=color:#cb4b16>ff</span>
</span></span></code></pre></div><p>Which is <code>generate_uniform_int(mtPRNG, *mtPRNG+2054, *mtPRNG+2058, param_1);</code>.
After the function call we see:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>008<span style=color:#268bd2>f5fcc</span> <span style=color:#2aa198>8</span><span style=color:#cb4b16>b</span> <span style=color:#2aa198>55</span> <span style=color:#2aa198>78</span>        <span style=color:#cb4b16>MOV</span>        <span style=color:#cb4b16>EDX</span>,<span style=color:#cb4b16>dword</span> <span style=color:#cb4b16>ptr</span> [<span style=color:#cb4b16>EBP</span> + <span style=color:#cb4b16>param_2</span>]
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5fcf</span> <span style=color:#2aa198>8</span><span style=color:#cb4b16>d</span> <span style=color:#2aa198>7</span><span style=color:#cb4b16>f</span> <span style=color:#2aa198>01</span>        <span style=color:#cb4b16>LEA</span>        <span style=color:#cb4b16>EDI</span>,[<span style=color:#cb4b16>EDI</span> + <span style=color:#2aa198>0x1</span>]
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5fd2</span> <span style=color:#2aa198>83</span> <span style=color:#cb4b16>c4</span> <span style=color:#2aa198>10</span>        <span style=color:#cb4b16>ADD</span>        <span style=color:#cb4b16>ESP</span>,<span style=color:#2aa198>0x10</span>
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5fd5</span> <span style=color:#2aa198>8</span><span style=color:#cb4b16>a</span> <span style=color:#2aa198>0</span><span style=color:#cb4b16>a</span>           <span style=color:#cb4b16>MOV</span>        <span style=color:#cb4b16>CL</span>,<span style=color:#cb4b16>byte</span> <span style=color:#cb4b16>ptr</span> [<span style=color:#cb4b16>EDX</span>]
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5fd7</span> <span style=color:#2aa198>42</span>              <span style=color:#cb4b16>INC</span>        <span style=color:#cb4b16>EDX</span>
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5fd8</span> <span style=color:#2aa198>32</span> <span style=color:#cb4b16>c8</span>           <span style=color:#cb4b16>XOR</span>        <span style=color:#cb4b16>CL</span>,<span style=color:#cb4b16>AL</span>
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5fda</span> <span style=color:#2aa198>89</span> <span style=color:#2aa198>55</span> <span style=color:#2aa198>78</span>        <span style=color:#cb4b16>MOV</span>        <span style=color:#cb4b16>dword</span> <span style=color:#cb4b16>ptr</span> [<span style=color:#cb4b16>EBP</span> + <span style=color:#cb4b16>param_2</span>],<span style=color:#cb4b16>EDX</span>
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5fdd</span> <span style=color:#2aa198>88</span> <span style=color:#2aa198>4</span><span style=color:#cb4b16>f</span> <span style=color:#cb4b16>ff</span>        <span style=color:#cb4b16>MOV</span>        <span style=color:#cb4b16>byte</span> <span style=color:#cb4b16>ptr</span> [<span style=color:#cb4b16>EDI</span> + -<span style=color:#2aa198>0x1</span>],<span style=color:#cb4b16>CL</span>
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5fe0</span> <span style=color:#2aa198>83</span> <span style=color:#cb4b16>ee</span> <span style=color:#2aa198>01</span>        <span style=color:#cb4b16>SUB</span>        <span style=color:#cb4b16>ESI</span>,<span style=color:#2aa198>0x1</span>
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5fe3</span> <span style=color:#2aa198>75</span> <span style=color:#cb4b16>d1</span>           <span style=color:#cb4b16>JNZ</span>        <span style=color:#cb4b16>LAB_008f5fb6</span> <span style=color:#586e75>; go back up to call `generate_uniform_int`
</span></span></span></code></pre></div><p>This is a typical XOR. Counter is <code>esi</code> (note <code>SUB ESI,0x1</code> in the end). When
esi is not zero, <code>JNZ</code> sends the execution back up to the function call to get
another uint32. When esi reaches zero, the jump is not taken and we finish the loop.
By tracing the app we see that <code>edi</code> is actually <code>param_3</code>. <code>param_2</code> is
probably the plaintext, <code>param_3</code> is the size of ciphertext/plaintext.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#719e07>for</span> (<span style=color:#dc322f>int</span> i<span style=color:#719e07>=</span><span style=color:#2aa198>0</span>; i<span style=color:#719e07>&lt;</span>sizeOfPlaintext; i<span style=color:#719e07>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Get a uint32 from the mt19937 generator.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    key <span style=color:#719e07>=</span> generate_uniform_int(mtPRNG, <span style=color:#719e07>*</span>mtPRNG<span style=color:#719e07>+</span><span style=color:#2aa198>2054</span>, <span style=color:#719e07>*</span>mtPRNG<span style=color:#719e07>+</span><span style=color:#2aa198>2058</span>, param_1);
</span></span><span style=display:flex><span>    ciphertext[i] <span style=color:#719e07>=</span> plaintext[i] XOR (AL)key;
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Decompiled code here is `ciphertext[i] = plaintext[i] XOR (byte)key;` which is wrong
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>}
</span></span></code></pre></div><h3 id=the-encryption-algorithm>The Encryption Algorithm
<a class=header-link href=#the-encryption-algorithm><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>The XOR is tricky here. We are XOR-ing <code>AL</code> with the plaintext. The decompiled
code in Ghidra is <code>ciphertext[i] = plaintext[i] XOR (byte)key;</code> which is wrong.</p><p>If we go by decompiled code and cast the <code>uint32</code> to <code>byte</code> we get the least
significant byte. However, when numbers are stored in a register like eax <code>AL</code>
will point to the most significant byte so <code>(key & 0xFF000000) >> 24</code> does the
job.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#dc322f>void</span> <span style=color:#268bd2>FUN_008f5d90</span>(ByteArray <span style=color:#719e07>*</span>param_1,byte <span style=color:#719e07>*</span>param_2,uint param_3)
</span></span><span style=display:flex><span>    mersenne_twister_engine<span style=color:#719e07>&lt;</span>unsigned_int<span style=color:#719e07>&gt;</span> <span style=color:#719e07>*</span>mtPRNG;
</span></span><span style=display:flex><span>    <span style=color:#586e75>// removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#719e07>for</span> (<span style=color:#dc322f>int</span> i<span style=color:#719e07>=</span><span style=color:#2aa198>0</span>; i<span style=color:#719e07>&lt;</span>sizeOfPlaintext; i<span style=color:#719e07>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#586e75>// Get a uint32 from the mt19937 generator.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>        key <span style=color:#719e07>=</span> generate_uniform_int(mtPRNG, <span style=color:#719e07>*</span>mtPRNG<span style=color:#719e07>+</span><span style=color:#2aa198>2054</span>, <span style=color:#719e07>*</span>mtPRNG<span style=color:#719e07>+</span><span style=color:#2aa198>2058</span>, param_1);
</span></span><span style=display:flex><span>        ciphertext[i] <span style=color:#719e07>=</span> plaintext[i] XOR ((num <span style=color:#719e07>&amp;</span> <span style=color:#2aa198>0xFF000000</span>) <span style=color:#719e07>&gt;&gt;</span> <span style=color:#2aa198>24</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#719e07>return</span> ciphertext;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=min-and-max-values>Min and Max Values
<a class=header-link href=#min-and-max-values><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>The <code>generate_uniform_int</code> function call has two parameters <code>min</code> and <code>max</code>.
These point to the minimum and maximum values for the generated numbers. For
<code>std::mersenne_twister_engine</code> these are <code>0</code> and <code>2^32 - 1</code> (for int32 version
of the function).</p><p>These cannot be set for <code>std::mersenne_twister_engine</code> according to the docs. In
the docs for <a href=http://www.cplusplus.com/reference/random/mersenne_twister_engine/min/ target=_blank rel="noreferrer noopener">std::mersenne_twister_engine::min</a> we read:</p><blockquote><p>Minimum value: Returns the minimum value potentially returned by member
operator(), which for mersenne_twister_engine is always zero.</p></blockquote><p>Similar for and <a href=http://www.cplusplus.com/reference/random/mersenne_twister_engine/max/ target=_blank rel="noreferrer noopener">max</a>:</p><blockquote><p>Returns the maximum value potentially returned by member operator(), which for
mersenne_twister_engine is 2^w-1 (where w is the word size specified as the
second class template parameter).</p></blockquote><p>It seems like it's pointing to object fields (?) or methods (?). That means we
do not need to define min and max values in our code.</p><hr><h2 id=the-bad-route>The Bad Route
<a class=header-link href=#the-bad-route><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>I initially started writing this route for this write-up. I was ashamed that I
had found the original solution by searching for a function name. Then I
realized why not?</p><p>This is the long route and not fun BUT I discovered some valuable info here.We
will see how debug mode is detected and how console access is enabled.</p><p>For the long route, I started with the event I saw in procmon.</p><p><code>Qt5Core.dll > QFSFileEngine::write + 0x29</code>. Searching for it in Ghidra or in
the exports for <code>Qt5Core.dll</code> returns nothing. Searching online we can find
references to it in the v4.8 docs.</p><ul><li><a href=https://doc.qt.io/archives/qt-4.8/qfsfileengine.html target=_blank rel="noreferrer noopener">https://doc.qt.io/archives/qt-4.8/qfsfileengine.html</a></li></ul><p>Note: I do not know why it's not in the symbols. So I decided to do some dynamic
analysis:</p><ol><li>Run the app via x64dbg.</li><li>Go to the address for the procmon event.<ol><li>The new address in that run was <code>0x6f87b6b9</code>.</li></ol></li><li>Go a bit up to see the call to <code>?write@QFSFileEngine@@UAE_JPBD_J@Z</code>.</li><li>Put a breakpoint and rerun the app.</li><li>Go to the <code>Call Stack</code> tab in x64dbg after the breakpoint is reached.</li></ol><span class=caption-wrapper><img class=caption src=10-x64dbg-trace.png title="Call to write in x64dbg" alt="Call to write in x64dbg">
<span class=caption-text>Call to write in x64dbg</span>
</span><span class=caption-wrapper><img class=caption src=11-call-stack.png title="Call stack in x64dbg" alt="Call stack in x64dbg">
<span class=caption-text>Call stack in x64dbg</span></span><p>Now we can search for <code>LogFileOutputBase</code> in Ghidra.</p><span class=caption-wrapper><img class=caption src=12-logfileoutputbase.png title=LogFileOutputBase alt=LogFileOutputBase>
<span class=caption-text>LogFileOutputBase</span></span><p>This is a method that writes the data passed in the parameter to the log file. I
did not see any encryption in the source code. Meaning the parent class might
handle it.</p><p>Looking at the incoming references (bottom left in Ghidra), we can see:</p><pre tabindex=0><code>Incoming References - LogFileOutputBase
    FUN_008f5720 &lt;-- This references LogFileOutputBase
        CreateLogEncFileOutput &lt;-- FUN_008f5720 calls this
    FUN_008f76c0  &lt;-- This references LogFileOutputBase
        CreateLogFileOutput &lt;-- FUN_008f5720 calls this
</code></pre><p>The parent class is created by using one of the two methods above. Just by
looking at the names we can see that one creates an encrypted log file and the
other does not.</p><p>Let's go to <code>CreateLogEncFileOutput</code>. It has one parameter (string) and returns
a <code>FileResult</code> object. I could guess that it creates a log file and returns a
handle to it. Then we can write to the handle and not worry about the underlying
encryption.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>FileResult <span style=color:#268bd2>__cdecl</span> <span style=color:#268bd2>CreateLogEncFileOutput</span>(<span style=color:#dc322f>char</span> <span style=color:#719e07>*</span>param_1)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    local_30 <span style=color:#719e07>=</span> operator_new(<span style=color:#2aa198>0x9fc</span>); <span style=color:#586e75>// local_30 = new int(0x9fc);
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#719e07>this</span> <span style=color:#719e07>=</span> (LogFileOutputBase <span style=color:#719e07>*</span>)FUN_008f5720(); <span style=color:#586e75>// What is this?
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    FileName(<span style=color:#719e07>this</span>);
</span></span><span style=display:flex><span>    shared_ptr<span style=color:#719e07>&lt;</span>class_RcLogV2<span style=color:#719e07>::</span>IOutputDevice<span style=color:#719e07>&gt;&lt;</span>class_`anonymous_namespace&#39;<span style=color:#719e07>::</span>LogEncFileOutput<span style=color:#719e07>&gt;</span>
</span></span><span style=display:flex><span>            ((shared_ptr<span style=color:#719e07>&lt;</span>class_RcLogV2<span style=color:#719e07>::</span>IOutputDevice<span style=color:#719e07>&gt;</span> <span style=color:#719e07>*</span>)<span style=color:#719e07>&amp;</span>stack0xffffffb0,(LogEncFileOutput <span style=color:#719e07>*</span>)<span style=color:#719e07>this</span>);
</span></span><span style=display:flex><span>    FVar1 <span style=color:#719e07>=</span> FileResult((FileResult <span style=color:#719e07>*</span>)param_1,in_stack_ffffffb0,in_stack_ffffffb4);
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#719e07>return</span> FVar1;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>It looks like <code>FUN_008f5720</code> creates and returns the filehandle. We see some
interesting stuff in it.</p><span class=caption-wrapper><img class=caption src=13-mt19937.png title=FUN_008f5720 alt=FUN_008f5720>
<span class=caption-text>FUN_008f5720</span></span><p>We have already seen <code>mersenne_twister_engine&lt;unsigned_int, ...</code> so I will skip
explaining it this time. An educated guess tells us that the PRNG is used to
create a key to encrypt the file. But we do not know how, yet. A pointer to this
object is stored in <code>local_60</code>.</p><p>After checking that it can create or open the file, we get to this code. The
decompiled code in Ghidra gives us the general idea of what's happening but is
not correct.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>        <span style=color:#268bd2>LAB_008f5886</span>                                    <span style=color:#cb4b16>XREF</span>[<span style=color:#2aa198>1</span>]:     <span style=color:#2aa198>008</span><span style=color:#cb4b16>f5821</span>(<span style=color:#cb4b16>j</span>)  
</span></span><span style=display:flex><span><span style=color:#2aa198>008</span><span style=color:#cb4b16>f5886</span> <span style=color:#2aa198>57</span>              <span style=color:#cb4b16>PUSH</span>       <span style=color:#cb4b16>EDI</span>
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5887</span> <span style=color:#2aa198>8</span><span style=color:#cb4b16>d</span> <span style=color:#2aa198>4</span><span style=color:#cb4b16>e</span> <span style=color:#2aa198>14</span>        <span style=color:#cb4b16>LEA</span>        <span style=color:#cb4b16>ECX</span>,[<span style=color:#cb4b16>ESI</span> + <span style=color:#2aa198>0x14</span>]
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f588a</span> <span style=color:#cb4b16>ff</span> <span style=color:#2aa198>15</span> <span style=color:#2aa198>1</span><span style=color:#cb4b16>c</span>        <span style=color:#cb4b16>CALL</span>       <span style=color:#cb4b16>dword</span> <span style=color:#cb4b16>ptr</span> [-&gt;<span style=color:#cb4b16>QT5CORE.DLL</span>::?<span style=color:#cb4b16>setDevice@QDataStre</span>
</span></span><span style=display:flex><span>            <span style=color:#268bd2>c2</span> <span style=color:#cb4b16>f1</span> <span style=color:#2aa198>01</span>
</span></span></code></pre></div><p>This calls <a href=https://doc.qt.io/qt-5/qdatastream.html#setDevice target=_blank rel="noreferrer noopener">void QDataStream::setDevice(QIODevice *d)</a> which sets the
I/O device to most likely the log file we just created. This means we can now
use the <code>QDataStream</code> object to write to it.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>008<span style=color:#268bd2>f5890</span> <span style=color:#2aa198>6</span><span style=color:#cb4b16>a</span> <span style=color:#2aa198>04</span>           <span style=color:#cb4b16>PUSH</span>       <span style=color:#2aa198>0x4</span>
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5892</span> <span style=color:#cb4b16>ff</span> <span style=color:#2aa198>35</span> <span style=color:#cb4b16>e0</span>        <span style=color:#cb4b16>PUSH</span>       <span style=color:#cb4b16>dword</span> <span style=color:#cb4b16>ptr</span> [-&gt;<span style=color:#cb4b16>s_LOGZ</span>]            = <span style=color:#2aa198>030</span><span style=color:#cb4b16>fa850</span>
</span></span><span style=display:flex><span>         3<span style=color:#268bd2>a</span> <span style=color:#2aa198>87</span> <span style=color:#2aa198>03</span>                                                   = &#34;<span style=color:#cb4b16>LOGZ</span>&#34;
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f5898</span> <span style=color:#2aa198>8</span><span style=color:#cb4b16>d</span> <span style=color:#2aa198>4</span><span style=color:#cb4b16>e</span> <span style=color:#2aa198>14</span>        <span style=color:#cb4b16>LEA</span>        <span style=color:#cb4b16>ECX</span>,[<span style=color:#cb4b16>ESI</span> + <span style=color:#2aa198>0x14</span>]
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f589b</span> <span style=color:#cb4b16>ff</span> <span style=color:#2aa198>15</span> <span style=color:#2aa198>7</span><span style=color:#cb4b16>c</span>        <span style=color:#cb4b16>CALL</span>       <span style=color:#cb4b16>dword</span> <span style=color:#cb4b16>ptr</span> [-&gt;<span style=color:#cb4b16>QT5CORE.DLL</span>::?<span style=color:#cb4b16>writeRawData@QDataS</span>
</span></span><span style=display:flex><span>            <span style=color:#268bd2>c0</span> <span style=color:#cb4b16>f1</span> <span style=color:#2aa198>01</span>
</span></span></code></pre></div><p>Calls <a href=https://doc.qt.io/qt-5/qdatastream.html#writeRawData target=_blank rel="noreferrer noopener">int QDataStream::writeRawData("LOGZ", 4)</a>. This writes <code>LOGZ</code>
to the start of the file. This is exactly what we saw above.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>008<span style=color:#268bd2>f58a1</span> <span style=color:#2aa198>68</span> <span style=color:#2aa198>01</span> <span style=color:#cb4b16>ab</span>        <span style=color:#cb4b16>PUSH</span>       <span style=color:#2aa198>0x2010ab01</span>
</span></span><span style=display:flex><span>            10 20
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f58a6</span> <span style=color:#2aa198>8</span><span style=color:#cb4b16>d</span> <span style=color:#2aa198>4</span><span style=color:#cb4b16>e</span> <span style=color:#2aa198>14</span>        <span style=color:#cb4b16>LEA</span>        <span style=color:#cb4b16>ECX</span>,[<span style=color:#cb4b16>ESI</span> + <span style=color:#2aa198>0x14</span>]
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f58a9</span> <span style=color:#cb4b16>ff</span> <span style=color:#2aa198>15</span> <span style=color:#2aa198>78</span>        <span style=color:#cb4b16>CALL</span>       <span style=color:#cb4b16>dword</span> <span style=color:#cb4b16>ptr</span> [-&gt;<span style=color:#cb4b16>QT5CORE.DLL</span>::??<span style=color:#2aa198>6</span><span style=color:#cb4b16>QDataStream@@QAEA</span>
</span></span><span style=display:flex><span>            <span style=color:#268bd2>c0</span> <span style=color:#cb4b16>f1</span> <span style=color:#2aa198>01</span>
</span></span></code></pre></div><p>This call writes <code>0x2010ab01</code> to the stream. This also appears in the log file
but because it was not in printable hex I did not notice it.</p><p>IDA actually figures out what method it is.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#268bd2>call</span>    <span style=color:#cb4b16>ds</span>:<span style=color:#cb4b16>__imp_</span>??<span style=color:#2aa198>6</span><span style=color:#cb4b16>QDataStream@@QAEAAV0@I@Z</span> <span style=color:#586e75>; QDataStream::operator&lt;&lt;(uint)
</span></span></span></code></pre></div><p><a href=https://doc.qt.io/qt-5/qdatastream.html#operator-lt-lt target=_blank rel="noreferrer noopener">QDataStream &lt;&lt; 0x2010ab01</a> writes a the byte to the stream.</p><p>Next we have:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>008<span style=color:#268bd2>f58af</span> <span style=color:#2aa198>8</span><span style=color:#cb4b16>b</span> <span style=color:#2aa198>07</span>           <span style=color:#cb4b16>MOV</span>        <span style=color:#cb4b16>EAX</span>,<span style=color:#cb4b16>dword</span> <span style=color:#cb4b16>ptr</span> [<span style=color:#cb4b16>EDI</span>]
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f58b1</span> <span style=color:#2aa198>8</span><span style=color:#cb4b16>b</span> <span style=color:#cb4b16>cf</span>           <span style=color:#cb4b16>MOV</span>        <span style=color:#cb4b16>ECX</span>,<span style=color:#cb4b16>EDI</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f58b3</span> <span style=color:#2aa198>8</span><span style=color:#cb4b16>b</span> <span style=color:#2aa198>40</span> <span style=color:#2aa198>38</span>        <span style=color:#cb4b16>MOV</span>        <span style=color:#cb4b16>EAX</span>,<span style=color:#cb4b16>dword</span> <span style=color:#cb4b16>ptr</span> [<span style=color:#cb4b16>EAX</span> + <span style=color:#2aa198>0x38</span>]
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f58b6</span> <span style=color:#cb4b16>ff</span> <span style=color:#cb4b16>d0</span>           <span style=color:#cb4b16>CALL</span>       <span style=color:#cb4b16>EAX</span>
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f58b8</span> <span style=color:#2aa198>83</span> <span style=color:#cb4b16>f8</span> <span style=color:#2aa198>08</span>        <span style=color:#cb4b16>CMP</span>        <span style=color:#cb4b16>EAX</span>,<span style=color:#2aa198>0x8</span>
</span></span><span style=display:flex><span>008<span style=color:#268bd2>f58bb</span> <span style=color:#2aa198>0</span><span style=color:#cb4b16>f</span> <span style=color:#2aa198>85</span> <span style=color:#cb4b16>bb</span>        <span style=color:#cb4b16>JNZ</span>        <span style=color:#cb4b16>LAB_008f597c</span>
</span></span><span style=display:flex><span>            00 00 00
</span></span></code></pre></div><p>Honestly, I cannot figure out what it exactly does but we have written 8 bytes
and there is a compare with 8. It's either calling a method or accessing a
field. The most likely scenario is that it checks if it has written 8 bytes to
the stream.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#586e75>// Create the datastream.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#719e07>?</span>setDevice@QDataStream@@QAEXPAVQIODevice@@@Z(param_1 <span style=color:#719e07>+</span> <span style=color:#2aa198>5</span>,(QIODevice <span style=color:#719e07>*</span>)<span style=color:#719e07>this</span>);
</span></span><span style=display:flex><span><span style=color:#586e75>// Write the header
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#719e07>?</span>writeRawData@QDataStream@@QAEHPBDH@Z(param_1 <span style=color:#719e07>+</span> <span style=color:#2aa198>5</span>,c_header,<span style=color:#2aa198>4</span>);
</span></span><span style=display:flex><span><span style=color:#586e75>// Write `0x2010ab01`. 
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#719e07>??</span><span style=color:#2aa198>6</span>QDataStream@@QAEAAV0@I@Z(param_1 <span style=color:#719e07>+</span> <span style=color:#2aa198>5</span>,<span style=color:#2aa198>0x2010ab01</span>);
</span></span><span style=display:flex><span><span style=color:#586e75>// Get the number of bytes written
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>lVar5 <span style=color:#719e07>=</span> (<span style=color:#719e07>**</span>(code <span style=color:#719e07>**</span>)(<span style=color:#719e07>*</span><span style=color:#719e07>this</span> <span style=color:#719e07>+</span> <span style=color:#2aa198>0x38</span>))();
</span></span><span style=display:flex><span><span style=color:#586e75>// Compare it with 8.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#719e07>if</span> (lVar5 <span style=color:#719e07>!=</span> <span style=color:#2aa198>8</span>) {
</span></span><span style=display:flex><span>    local_64 <span style=color:#719e07>=</span> (undefined4 <span style=color:#719e07>*</span>)<span style=color:#2aa198>0x0</span>;
</span></span><span style=display:flex><span>    local_8._0_1_ <span style=color:#719e07>=</span> <span style=color:#2aa198>10</span>;
</span></span><span style=display:flex><span>    <span style=color:#586e75>// If it was wrong, return an error message.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    local_5c <span style=color:#719e07>=</span> string(<span style=color:#2aa198>&#34;Bad header size&#34;</span>);
</span></span></code></pre></div><p>The rest of the method is not interesting. So we have figured out the PRNG and
the header. But we do not know how the encryption happens.</p><p>Returning into <code>CreateLogEncFileOutput</code> we see that a <code>FileResult</code> is created
and returned.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>FileResult <span style=color:#268bd2>__cdecl</span> <span style=color:#268bd2>CreateLogEncFileOutput</span>(<span style=color:#dc322f>char</span> <span style=color:#719e07>*</span>param_1)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    local_30 <span style=color:#719e07>=</span> operator_new(<span style=color:#2aa198>0x9fc</span>); <span style=color:#586e75>// local_30 = new int(0x9fc);
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    local_8 <span style=color:#719e07>=</span> <span style=color:#2aa198>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#719e07>this</span> <span style=color:#719e07>=</span> (LogFileOutputBase <span style=color:#719e07>*</span>)FUN_008f5720();
</span></span><span style=display:flex><span>    <span style=color:#586e75>// We are now here.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    FileName(<span style=color:#719e07>this</span>);
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    FVar1 <span style=color:#719e07>=</span> FileResult(<span style=color:#719e07>this</span>);
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#719e07>return</span> FVar1;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now we need to follow the returned <code>FileResult</code> and see how data is written to
it.</p><p>Select the <code>CreateLogEncFileOutput</code> function, right-click and <code>Find references to</code> we get to <code>FUN_013697c0</code>. I have cleaned up the code and removed the
unnecessary parts.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#dc322f>void</span> __thiscall <span style=color:#268bd2>FUN_013697c0</span>(<span style=color:#dc322f>void</span> <span style=color:#719e07>*</span>param_1, undefined4 <span style=color:#719e07>*</span>param_1_00,
</span></span><span style=display:flex><span>    LogDirections <span style=color:#719e07>*</span>param_2, undefined4 param_3, <span style=color:#dc322f>int</span> param_4)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#586e75>// This checks if we are running in debug mode.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    isDebugMode <span style=color:#719e07>=</span> <span style=color:#719e07>?</span>ModanoDebugMode@ModanoUtils@@YA_NXZ(param_1);
</span></span><span style=display:flex><span>    <span style=color:#719e07>if</span> (isDebugMode) {
</span></span><span style=display:flex><span>        <span style=color:#586e75>// If running in debug mode create plaintext log.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>        logFile <span style=color:#719e07>=</span> CreateLogFileOutput((<span style=color:#dc322f>char</span><span style=color:#719e07>*</span> local_28);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#719e07>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#586e75>// If not debug mode create encrypted log.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>        logFile <span style=color:#719e07>=</span> CreateLogEncFileOutput(<span style=color:#dc322f>char</span><span style=color:#719e07>*</span> local_68);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#586e75>// removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#719e07>if</span> (isDebugMode) {
</span></span><span style=display:flex><span>        <span style=color:#719e07>~</span>FileResult(local_28);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#586e75>// removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#719e07>if</span> (<span style=color:#719e07>!</span>isDebugMode) {
</span></span><span style=display:flex><span>        <span style=color:#719e07>~</span>FileResult(local_68);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#586e75>// File permissions?
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    param_1_00[<span style=color:#2aa198>4</span>] <span style=color:#719e07>=</span> <span style=color:#2aa198>0</span>;
</span></span><span style=display:flex><span>    param_1_00[<span style=color:#2aa198>5</span>] <span style=color:#719e07>=</span> <span style=color:#2aa198>0</span>;
</span></span><span style=display:flex><span>    param_1_00[<span style=color:#2aa198>5</span>] <span style=color:#719e07>=</span> <span style=color:#2aa198>7</span>;
</span></span><span style=display:flex><span>    param_1_00[<span style=color:#2aa198>4</span>] <span style=color:#719e07>=</span> <span style=color:#2aa198>0</span>;
</span></span><span style=display:flex><span>    puVar5 <span style=color:#719e07>=</span> param_1_00;
</span></span><span style=display:flex><span>    <span style=color:#719e07>if</span> (<span style=color:#2aa198>7</span> <span style=color:#719e07>&lt;</span> (uint)param_1_00[<span style=color:#2aa198>5</span>]) {
</span></span><span style=display:flex><span>        puVar5 <span style=color:#719e07>=</span> (undefined4 <span style=color:#719e07>*</span>)<span style=color:#719e07>*</span>param_1_00;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#586e75>// removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#719e07>return</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Seems like it creates a log file based on whether we have debug mode enabled or
not. Let's rename it to <code>CreateLogFile</code>. There is not much in the rest of the
function. As a detour let's check the debug mode.</p><h3 id=debug-mode>Debug mode
<a class=header-link href=#debug-mode><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Click on the <code>ModanoDebugMode@ModanoUtils</code> function.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#dc322f>bool</span> __thiscall <span style=color:#719e07>?</span>ModanoDebugMode@ModanoUtils@@YA_NXZ(<span style=color:#dc322f>void</span> <span style=color:#719e07>*</span><span style=color:#719e07>this</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#719e07>if</span> ((g_debugEnabled <span style=color:#719e07>==</span> (optional<span style=color:#719e07>&lt;</span><span style=color:#dc322f>bool</span><span style=color:#719e07>&gt;</span>)<span style=color:#2aa198>0x0</span>) <span style=color:#719e07>&amp;&amp;</span>
</span></span><span style=display:flex><span>     (DAT_03b34bfd <span style=color:#719e07>=</span> (<span style=color:#dc322f>bool</span>)FUN_0132a220(), g_debugEnabled <span style=color:#719e07>==</span> (optional<span style=color:#719e07>&lt;</span><span style=color:#dc322f>bool</span><span style=color:#719e07>&gt;</span>)<span style=color:#2aa198>0x0</span>)) {
</span></span><span style=display:flex><span>    g_debugEnabled <span style=color:#719e07>=</span> (optional<span style=color:#719e07>&lt;</span><span style=color:#dc322f>bool</span><span style=color:#719e07>&gt;</span>)<span style=color:#2aa198>0x1</span>;
</span></span><span style=display:flex><span>    <span style=color:#719e07>return</span> DAT_03b34bfd;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> DAT_03b34bfd;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>It checks if the global variable <code>g_debugEnabled</code> is not zero. If it's zero, it
returns with what we can assume is <code>false</code>.</p><p>If it's not zero, it calls <code>FUN_0132a22</code>. <code>AL</code> (the return value of this
function is in <code>EAX</code> and <code>AL</code> is the first byte) is stored in <code>DAT_03b34bfd</code> and
returned. It also sets <code>g_debugEnabled</code> to <code>1</code>. Otherwise, <code>DAT_03b34bfd</code> is
returned without being set.</p><p>So <code>FUN_0132a22</code> sets debug mode. Let's check it. Cleaned up decompiled code
tells us what it does:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#dc322f>void</span> <span style=color:#268bd2>FUN_0132a220</span>(<span style=color:#dc322f>void</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Get the name of the executable.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    executableName <span style=color:#719e07>=</span> Utils<span style=color:#719e07>::</span>ExeName<span style=color:#719e07>::</span>Instance();
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Get the executable directory.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    executableDirectory <span style=color:#719e07>=</span> Utils<span style=color:#719e07>::</span>ExeName<span style=color:#719e07>::</span>GetExeDirAsStr(executableName);
</span></span><span style=display:flex><span>    <span style=color:#586e75>// debugFilePath = &#34;path/to/executable/directory/debug&#34;
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    debugFilePath <span style=color:#719e07>=</span> concat(executableDirectory, <span style=color:#2aa198>&#34;debug&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Return the file_status of debugFilePath
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    fileStatus <span style=color:#719e07>=</span> boost<span style=color:#719e07>::</span>filesystem<span style=color:#719e07>::</span>detail<span style=color:#719e07>::</span>status(debugFilePath, system<span style=color:#719e07>::</span>error_code<span style=color:#719e07>&amp;</span> ec);
</span></span><span style=display:flex><span>    <span style=color:#586e75>// If the status is not `status_error` (0) and is not `file_not_found` (1)
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#719e07>if</span> ((fileStatus[<span style=color:#2aa198>0</span>] <span style=color:#719e07>!=</span> <span style=color:#2aa198>0</span>) <span style=color:#719e07>&amp;&amp;</span> (fileStatus[<span style=color:#2aa198>0</span>] <span style=color:#719e07>!=</span> <span style=color:#2aa198>1</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#586e75>// Show the console window.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>        ShowConsolWindow();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#719e07>return</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>fileStatus</code> is of type <a href=https://www.boost.org/doc/libs/1_66_0/libs/filesystem/doc/reference.html#file_status target=_blank rel="noreferrer noopener">Boost::Filesystem::file_status</a> and it can
contain values of enum <a href=https://www.boost.org/doc/libs/1_66_0/libs/filesystem/doc/reference.html#file_type target=_blank rel="noreferrer noopener">Boost::Filesystem::file_type</a>.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#719e07>enum</span> <span style=color:#268bd2>file_type</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    status_error, file_not_found, regular_file, directory_file,
</span></span><span style=display:flex><span>    symlink_file, block_file, character_file, fifo_file, socket_file,
</span></span><span style=display:flex><span>    type_unknown
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p><code>0</code> and <code>1</code> are <code>status_error</code> and <code>file_not_found</code> respectively. The code
explicitly checks if the result is 0 or 1.</p><p>In short, it checks <strong>if there is a file named <code>debug</code> in the executable directory.</strong>
Enables debug mode and shows the console window.</p><p>To figure out what the console window is. Click on <code>ShowConsolWindow</code>. It prints
the app output to the console. If you run the app from a command line and you have
debug mode enabled you will see messages printed to the console:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#dc322f>void</span> <span style=color:#268bd2>__cdecl</span> <span style=color:#268bd2>ShowConsolWindow</span>(<span style=color:#dc322f>void</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    Console <span style=color:#719e07>*</span><span style=color:#719e07>this</span>;
</span></span><span style=display:flex><span>    ulong uVar1;
</span></span><span style=display:flex><span>    <span style=color:#dc322f>int</span> iVar2;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#719e07>this</span> <span style=color:#719e07>=</span> Win32<span style=color:#719e07>::</span>Console<span style=color:#719e07>::</span>Instance();
</span></span><span style=display:flex><span>    <span style=color:#719e07>if</span> (<span style=color:#719e07>*</span><span style=color:#719e07>this</span> <span style=color:#719e07>==</span> (Console)<span style=color:#2aa198>0x0</span>) {
</span></span><span style=display:flex><span>        uVar1 <span style=color:#719e07>=</span> Win32<span style=color:#719e07>::</span>ToolHelp<span style=color:#719e07>::</span>GetParentProcessId(<span style=color:#2aa198>0</span>);
</span></span><span style=display:flex><span>        iVar2 <span style=color:#719e07>=</span> Win32<span style=color:#719e07>::</span>Console<span style=color:#719e07>::</span>RedirectIOToConsole(uVar1);
</span></span><span style=display:flex><span>        <span style=color:#719e07>if</span> (iVar2 <span style=color:#719e07>==</span> <span style=color:#2aa198>0</span>) {
</span></span><span style=display:flex><span>            Win32<span style=color:#719e07>::</span>Console<span style=color:#719e07>::</span>Allocate(<span style=color:#719e07>this</span>);
</span></span><span style=display:flex><span>            <span style=color:#719e07>return</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        Win32<span style=color:#719e07>::</span>Console<span style=color:#719e07>::</span>RedirectIOToConsole(<span style=color:#719e07>this</span>);
</span></span><span style=display:flex><span>        <span style=color:#719e07>*</span><span style=color:#719e07>this</span> <span style=color:#719e07>=</span> (Console)<span style=color:#2aa198>0x1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#719e07>return</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The debug mode is used in many places. Incoming references for the
<code>ModanoDebugMode@ModanoUtils</code> are:</p><span class=caption-wrapper><img class=caption src=14-debug-references.png title="Functions that check for debug mode" alt="Functions that check for debug mode">
<span class=caption-text>Functions that check for debug mode</span></span><h3 id=back-to-hunting-for-encryption>Back to Hunting for Encryption
<a class=header-link href=#back-to-hunting-for-encryption><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>After our little side-quest, we are back here. We know <code>CreateLogEncFileOutput</code>
creates an encrypted log file and returns a <code>FileResult</code> handle. It's referenced
in <code>FUN_013697c0/CreateLogFile</code> which we saw it checked for debug mode and
returned a log file accordingly (plaintext vs. encrypted).</p><p>Now we need to figure out what happens to the <code>FileResult</code> and how it's handled.
Following <code>CreateLogFile</code> we can see it's called by <code>FUN_01369160</code> which is a
wrapper. We can rename it to <code>CreateLogFileWrapper</code>.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#dc322f>void</span> <span style=color:#268bd2>CreateLogFileWrapper</span>(undefined4 param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#719e07>return</span> CreateLogFile(param_1,param_2,param_3,param_4);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This is in turn called by <code>FUN_01368870</code>.</p><span class=caption-wrapper><img class=caption src=15-wrapper-call.png title="Call stack" alt="Call stack">
<span class=caption-text>Call stack</span></span><h3 id=rage-quit>Rage Quit
<a class=header-link href=#rage-quit><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>I went down the rabbit hole and wasted a few hours trying to trace
the calls with nothing to show. The only nice thing was finding how to
enable the debug mode.</p><p>Then I realized there is an easier way of doing what I have been trying to do.
We know we are using a <code>mersenne_twister_engine</code> and it's a somewhat unique
string. Why not search for it in the binary?</p><p>I selected an instance that I saw above then did <code>Right-click > References > find uses of</code>.</p><p>The result has 135 locations but most of them are probably internal. We should
start with the ones with <code>FUN_00</code> labels because they are the most "fun"
(dadjoke.png).</p><span class=caption-wrapper><img class=caption src=16-uses-of-mersenne.png title="Mersenne uses" alt="Mersenne uses">
<span class=caption-text>Mersenne uses</span></span><p>And we find it in <code>FUN_008f5d90</code>. <code>local_80</code> is the <code>mt19937</code> variable. We have
seen this function before above. But this time it's in the context of decrypting
the logs. XOR is transitive so encryption and decryption do the same.</p><h1 id=decryptlog-code>DecryptLog Code
<a class=header-link href=#decryptlog-code><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>Now we can write code. I could not find implementations of mt19937 32-bit in Go.
Python supposedly uses the same engine to generate <code>random</code> output but I did not
get the result I wanted either. So I had to write C++ code.</p><p>Not having written C++ I spent a lot of time creating useless functions to warm
up and get used to vectors. I have used the <code>std::byte</code> type in the code so you
need to use the instructions in the code to use C++17.</p><p>The final code is at:</p><ul><li><a href=https://github.com/parsiya/Parsia-Code/tree/master/decrypt-log target=_blank rel="noreferrer noopener">https://github.com/parsiya/Parsia-Code/tree/master/decrypt-log</a></li></ul><span class=caption-wrapper><img class=caption src=20-decrypted-log.png title="Decrypted log" alt="Decrypted log">
<span class=caption-text>Decrypted log</span></span><h1 id=what-did-we-learn-here-today>What Did We Learn Here Today?
<a class=header-link href=#what-did-we-learn-here-today><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><ol><li>Installers might include symbols with the main executable.</li><li>Symbols are fun.</li><li>Ghidra's PDB processing has some issues.</li><li>The Mersenne Twister Engine is part of the C++ standard library.</li><li>Debug mode can be set with some silly methods (e.g., having a file named
<code>debug</code>).</li><li>Ghidra's decompiler is sometimes misleading so be sure to check the
disassembly and not trust it blindly.</li></ol><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>PEID also detects the linker version but its signatures are out of date to figure out the name of the compiler.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>Parsia</span></span>
<time>Apr 17, 2020</time></span></p><p class=meta><a class="basic-alignment left" href=https://parsiya.net/blog/2020-04-05-the-golang-int-and-the-overlooked-bug/ title="The Golang int and the Overlooked Bug">The Golang int and the Overlooked Bug</a>
<a class="basic-alignment right" href=https://parsiya.net/blog/2020-05-01-towards-a-quieter-burp-history/ title="Towards a Quieter Burp History">Towards a Quieter Burp History</a></p><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//parsiya.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h1>Who am I?</h1><p><p>I am Parsia, an application security engineer.</p><p>I write about application security, cryptography, static analysis, and
(of course) videogames.</p><p>Click on <a href=/about/>About Me!</a> to know more.</p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank rel="me noopener noreferrer" href=https://infosec.exchange/@parsiya title=https://infosec.exchange/@parsiya><i class="fa fa-mastodon fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://github.com/parsiya/ title=https://github.com/parsiya/><i class="fa fa-github fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://twitter.com/cryptogangsta/ title=https://twitter.com/cryptogangsta/><i class="fa fa-twitter fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/in/parsiya title=https://www.linkedin.com/in/parsiya><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><h1>Collections</h1><li><a href=https://parsiya.net/categories/thick-client-proxying/ title="Thick Client Proxying">Thick Client Proxying</a></li><li><a href=https://parsiya.net/categories/writeup/ title=CTFs/Writeups>CTFs/Writeups</a></li><li><a href=https://parsiya.net/categories/attack-surface-analysis/ title="Attack Surface Analysis">Attack Surface Analysis</a></li><li><a href=https://parsiya.net/categories/semgrep/ title=Semgrep>Semgrep</a></li><li><a href=https://parsiya.net/categories/bug-bounty/ title="Bug Bounty">Bug Bounty</a></li><li><a href=https://parsiya.net/categories/blockchain/ title="Blockchain (lol)">Blockchain (lol)</a></li><li><a href=https://parsiya.net/categories/crypto/ title=Crypto(graphy)>Crypto(graphy)</a></li><li><a href=https://parsiya.net/categories/burp-extension/ title="Burp Extension Development">Burp Extension Development</a></li><li><a href=https://parsiya.net/categories/automation/ title=Automation>Automation</a></li><li><a href=https://parsiya.net/categories/reverse-engineering/ title="Reverse Engineering">Reverse Engineering</a></li><li><a href=https://parsiya.net/categories/winappdbg/ title="WinAppDbg (use Frida instead)">WinAppDbg (use Frida instead)</a></li><li><a href=https://awsome.pw title='AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability'>AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability</a></li></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2024 Parsia - <a href=https://parsiya.net/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>