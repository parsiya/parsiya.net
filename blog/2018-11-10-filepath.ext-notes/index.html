<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>filepath.Ext Notes</title><link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://parsiya.net/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Parsia Hakimian Parsiya infosec information security]"><meta name=author content="Parsia"><meta name=generator content="Hugo 0.96.0"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image:src content="https://parsiya.net/blog/2018-11-10-filepath.ext-notes/main.png"><meta name=twitter:title content="filepath.Ext Notes"><meta name=twitter:description content="The filepath package has some functions for processing paths and filenames. I am using it extensively in a current project. You can do cool stuff with it, like traversing a path recursively with filepath.Walk.
filepath.Ext returns the extension of a filename (or path). It returns whatever is after the last dot. It has some gotchas that might have security implications.
Code is at: https://github.com/parsiya/Parsia-Code/tree/master/filepath-ext"><meta name=twitter:domain content="parsiya.net"><meta name=twitter:creator content="@CryptoGangsta"></head><body><header role=banner><hgroup><h1><a href=https://parsiya.net/>Hackerman's Hacking Tutorials</a></h1><h2>The knowledge of anything, since all things have causes, is not acquired or
complete unless it is known by its causes. - Avicenna</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://parsiya.net/about/>» About Me!</option><option value=https://parsiya.net/cheatsheet/>» Cheat Sheet</option><option value=https://parsiya.io/>» My Clone</option><option value=https://github.com/parsiya/parsiya.net>» Source Repo</option><option value="https://queue.acm.org/detail.cfm?id=3197520">» Manual Work is a Bug</option><option value="https://www.google.com/search?q=andrew+ridgeley">» The Other Guy from Wham!</option></select></fieldset><ul class=main-navigation><li><a href=https://parsiya.net/about/ title="About Me!" target=_blank rel="noopener noreferrer">About Me!</a></li><li><a href=https://parsiya.net/cheatsheet/ title="Cheat Sheet" target=_blank rel="noopener noreferrer">Cheat Sheet</a></li><li><a href=https://parsiya.io/ title="My Clone" target=_blank rel="noopener noreferrer">My Clone</a></li><li><a href=https://github.com/parsiya/parsiya.net title="Source Repo" target=_blank rel="noopener noreferrer">Source Repo</a></li><li><a href="https://queue.acm.org/detail.cfm?id=3197520" title="Manual Work is a Bug" target=_blank rel="noopener noreferrer">Manual Work is a Bug</a></li><li><a href="https://www.google.com/search?q=andrew+ridgeley" title="The Other Guy from Wham!" target=_blank rel="noopener noreferrer">The Other Guy from Wham!</a></li></ul><ul class=subscription><a href=https://parsiya.net/index.xml target=_blank type=application/rss+xml title=RSS rel="noopener noreferrer"><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://parsiya.net/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>Nov 10, 2018
- 3 minute read
- <a href=https://parsiya.net/blog/2018-11-10-filepath.ext-notes/#disqus_thread>Comments</a>
- <a class=label href=https://parsiya.net/categories/go/>Go</a></p><h1 class=entry-title>filepath.Ext Notes</h1></header><div class=entry-content><p>The <a href=https://golang.org/pkg/path/filepath/ target=_blank rel="noreferrer noopener">filepath</a> package has some functions for processing paths and filenames. I am using it extensively in a current project. You can do cool stuff with it, like <a href=/blog/2018-10-06-gophercises-lessons-learned/#filepath-walk title=filepath.Walk>traversing a path recursively with filepath.Walk</a>.</p><p><a href=https://golang.org/pkg/path/filepath/#Ext target=_blank rel="noreferrer noopener">filepath.Ext</a> returns the extension of a filename (or path). It returns whatever is after the last dot. It has some gotchas that might have security implications.</p><p>Code is at: <a href=https://github.com/parsiya/Parsia-Code/tree/master/filepath-ext target=_blank rel="noreferrer noopener">https://github.com/parsiya/Parsia-Code/tree/master/filepath-ext</a></p><h1 id=source>Source
<a class=header-link href=#source><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p><a href="https://golang.org/src/path/filepath/path.go?s=6131:6159#L207" target=_blank rel="noreferrer noopener">https://golang.org/src/path/filepath/path.go?s=6131:6159#L207</a></p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#586e75>// Ext returns the file name extension used by path.
</span></span></span><span style=display:flex><span><span style=color:#586e75>// The extension is the suffix beginning at the final dot
</span></span></span><span style=display:flex><span><span style=color:#586e75>// in the final element of path; it is empty if there is
</span></span></span><span style=display:flex><span><span style=color:#586e75>// no dot.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#268bd2>func</span> <span style=color:#268bd2>Ext</span>(path <span style=color:#dc322f>string</span>) <span style=color:#dc322f>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#719e07>for</span> i <span style=color:#719e07>:=</span> <span style=color:#b58900>len</span>(path) <span style=color:#719e07>-</span> <span style=color:#2aa198>1</span>; i <span style=color:#719e07>&gt;=</span> <span style=color:#2aa198>0</span> <span style=color:#719e07>&amp;&amp;</span> !os.<span style=color:#268bd2>IsPathSeparator</span>(path[i]); i<span style=color:#719e07>--</span> {
</span></span><span style=display:flex><span>		<span style=color:#719e07>if</span> path[i] <span style=color:#719e07>==</span> <span style=color:#2aa198>&#39;.&#39;</span> {
</span></span><span style=display:flex><span>			<span style=color:#719e07>return</span> path[i:]
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#719e07>return</span> <span style=color:#2aa198>&#34;&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=example>Example
<a class=header-link href=#example><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>To demonstrate the tips, we are going to create a simple example. Let's assume we have a file hosting service. We have created a blacklist of banned extensions. It checks the files by extension. This is not really a good way to do this:</p><ol><li>It's better to default to deny and then use a whitelist.</li><li>Detecting file types by extension is easily bypassed by changing the extension. However, this might render some attacks invalid. Consider an attack where a user downloads a file, if the attacker has been forced to rename the file from <code>exe</code> to <code>txt</code> or another random extension, the user needs to manually rename it back and execute it.</li></ol><p>But let's use it for demonstrating our points. This is the blacklist function:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#586e75>// Blacklist returns true if a file is one of the banned types by checking its extension.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#268bd2>func</span> <span style=color:#268bd2>Blacklist</span>(filename <span style=color:#dc322f>string</span>) <span style=color:#dc322f>bool</span> {
</span></span><span style=display:flex><span>	<span style=color:#719e07>if</span> filepath.<span style=color:#268bd2>Ext</span>(filename) <span style=color:#719e07>==</span> <span style=color:#2aa198>&#34;.exe&#34;</span> {
</span></span><span style=display:flex><span>		<span style=color:#719e07>return</span> <span style=color:#cb4b16>false</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#719e07>return</span> <span style=color:#cb4b16>true</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=ext-keeps-the-case-of-input>Ext Keeps the Case of Input
<a class=header-link href=#ext-keeps-the-case-of-input><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>The input's letter case does not change. Everything is just passed through. Consider the following code (<code>case.go</code>):</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#719e07>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#2aa198>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#2aa198>&#34;path/filepath&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>main</span>() {
</span></span><span style=display:flex><span>    fmt.<span style=color:#268bd2>Println</span>(<span style=color:#2aa198>&#34;filepath.Ext(\&#34;whatever.txt\&#34;):&#34;</span>, filepath.<span style=color:#268bd2>Ext</span>(<span style=color:#2aa198>&#34;whatever.txt&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#586e75>// filepath.Ext(&#34;whatever.txt&#34;): .txt
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>
</span></span><span style=display:flex><span>    fmt.<span style=color:#268bd2>Println</span>(<span style=color:#2aa198>&#34;filepath.Ext(\&#34;whatever.TXT\&#34;):&#34;</span>, filepath.<span style=color:#268bd2>Ext</span>(<span style=color:#2aa198>&#34;whatever.TXT&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#586e75>// filepath.Ext(&#34;whatever.TXT&#34;): .TXT
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>
</span></span><span style=display:flex><span>    fmt.<span style=color:#268bd2>Println</span>(<span style=color:#2aa198>&#34;filepath.Ext(\&#34;whatever.Txt\&#34;):&#34;</span>, filepath.<span style=color:#268bd2>Ext</span>(<span style=color:#2aa198>&#34;whatever.Txt&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#586e75>// filepath.Ext(&#34;whatever.Txt&#34;): .Txt
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>}
</span></span></code></pre></div><p>To bypass the blacklist, we can just change the case <code>case_blacklist.go</code>:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>main</span>() {
</span></span><span style=display:flex><span>    fmt.<span style=color:#268bd2>Println</span>(<span style=color:#2aa198>&#34;Blacklist(\&#34;whatever.exe\&#34;):&#34;</span>, <span style=color:#268bd2>Blacklist</span>(<span style=color:#2aa198>&#34;whatever.exe&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#586e75>// true
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>
</span></span><span style=display:flex><span>    fmt.<span style=color:#268bd2>Println</span>(<span style=color:#2aa198>&#34;Blacklist(\&#34;whatever.ExE\&#34;):&#34;</span>, <span style=color:#268bd2>Blacklist</span>(<span style=color:#2aa198>&#34;whatever.ExE&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#586e75>// false
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>}
</span></span></code></pre></div><h1 id=ext-returns-the-dot-with-the-extension>Ext Returns the dot with the Extension
<a class=header-link href=#ext-returns-the-dot-with-the-extension><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>In our mind, the extension of a file is just the letters after the dot. It does not include the dot. However, Ext returns the dot. This is really unintuitive and has caught me off guard a few times.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#719e07>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#2aa198>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#2aa198>&#34;path/filepath&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>main</span>() {
</span></span><span style=display:flex><span>    fmt.<span style=color:#268bd2>Println</span>(<span style=color:#2aa198>&#34;Blacklist(\&#34;whatever.exe\&#34;):&#34;</span>, <span style=color:#268bd2>Blacklist</span>(<span style=color:#2aa198>&#34;whatever.exe&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#586e75>// true
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75>// Blacklist returns true if a file is one of the banned types by checking its extension.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#268bd2>func</span> <span style=color:#268bd2>Blacklist</span>(filename <span style=color:#dc322f>string</span>) <span style=color:#dc322f>bool</span> {
</span></span><span style=display:flex><span>	<span style=color:#586e75>// Developers did not expect the dot to be part of the output.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>	<span style=color:#719e07>if</span> filepath.<span style=color:#268bd2>Ext</span>(filename) <span style=color:#719e07>==</span> <span style=color:#2aa198>&#34;exe&#34;</span> {
</span></span><span style=display:flex><span>		<span style=color:#719e07>return</span> <span style=color:#cb4b16>false</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#719e07>return</span> <span style=color:#cb4b16>true</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This blacklist is useless, the condition is never true.</p><h1 id=returns-an-empty-string-if-input-has-no-dots>Returns an Empty String if Input has no Dots
<a class=header-link href=#returns-an-empty-string-if-input-has-no-dots><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>This is mentioned in the docs but aI did not expect it.</p></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>Parsia</span></span>
<time>Nov 10, 2018</time>
<span class=categories>Tags:
<a class=category href=https://parsiya.net/tags/filepath>filepath</a></span></p><p class=meta><a class="basic-alignment left" href=https://parsiya.net/blog/2018-11-01-windows-filetime-timestamps-and-byte-wrangling-with-go/ title="Windows Filetime Timestamps and Byte Wrangling with Go">Windows Filetime Timestamps and Byte Wrangling with Go</a>
<a class="basic-alignment right" href=https://parsiya.net/blog/2018-11-18-pointers-inside-for/ title="Pointers Inside for">Pointers Inside for</a></p><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//parsiya.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h1>Who am I?</h1><p><p>I am Parsia, a senior security engineer at <a href=https://www.ea.com/security target=_blank rel="noreferrer noopener">Electronic Arts</a>.</p><p>I write about application security, reverse engineering,
Go, cryptography, and (obviously) videogames.</p><p>Click on <a href=/about/>About Me!</a> to know more.</p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank rel="noopener noreferrer" href=https://github.com/parsiya/ title=https://github.com/parsiya/><i class="fa fa-github fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://twitter.com/cryptogangsta/ title=https://twitter.com/cryptogangsta/><i class="fa fa-twitter fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://keybase.io/parsiya/ title=https://keybase.io/parsiya/><i class="fa fa-keybase fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/in/parsiya title=https://www.linkedin.com/in/parsiya><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><h1>Collections</h1><li><a href=https://parsiya.net/categories/thick-client-proxying/ title="Thick Client Proxying">Thick Client Proxying</a></li><li><a href=https://parsiya.net/categories/writeup/ title=CTFs/Writeups>CTFs/Writeups</a></li><li><a href=https://parsiya.net/categories/attack-surface-analysis/ title="Attack Surface Analysis">Attack Surface Analysis</a></li><li><a href=https://parsiya.net/categories/bug-bounty/ title="Bug Bounty">Bug Bounty</a></li><li><a href=https://parsiya.net/categories/go/ title=Go/Golang>Go/Golang</a></li><li><a href=https://parsiya.net/categories/blockchain/ title=Blockchain>Blockchain</a></li><li><a href=https://parsiya.net/categories/burp-extension/ title="Burp Extension Development">Burp Extension Development</a></li><li><a href=https://parsiya.net/categories/automation/ title=Automation>Automation</a></li><li><a href=https://parsiya.net/categories/reverse-engineering/ title="Reverse Engineering">Reverse Engineering</a></li><li><a href=https://parsiya.net/categories/crypto/ title=Crypto(graphy)>Crypto(graphy)</a></li><li><a href=https://parsiya.net/categories/winappdbg/ title=WinAppDbg>WinAppDbg</a></li><li><a href=https://awsome.pw title="AWSome.pw - S3 bucket squatting - my very legit branded vulnerability">AWSome.pw - S3 bucket squatting - my very legit branded vulnerability</a></li></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2022 Parsia - <a href=https://parsiya.net/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>