<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>Thick Client Proxying - Part 7 - Proxying .NET Applications via Config File</title>
<link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://parsiya.net/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Parsia Hakimian Parsiya infosec information security]"><meta name=author content="Parsia"><meta name=generator content="Hugo 0.124.1"><meta name=twitter:card content="summary"><meta name=twitter:title content="Thick Client Proxying - Part 7 - Proxying .NET Applications via Config File"><meta name=twitter:description content=".NET applications use a configuration file to read some settings. It's an XML
file named appName.exe.config. We can pass a proxy address in this file.
These apps usually use WinINET or IE proxy settings. Sometimes, they do not. We
can either use an application specific config file or use one for the entire
.NET framework for a machine.
Look inside the decompiled code (or just grep the binary files) for references
to System.Configuration MSDN-page. Applications
use ConfigurationManager and WebConfigurationManager classes to access these
settings.
"><meta name=twitter:domain content="parsiya.net"><meta name=twitter:creator content="@CryptoGangsta"></head><body><header role=banner><hgroup><h1><a href=https://parsiya.net/>Hackerman's Hacking Tutorials</a></h1><h2>The knowledge of anything, since all things have causes, is not acquired or
complete unless it is known by its causes. - Avicenna</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://parsiya.net/about/>» About Me!</option><option value=https://parsiya.net/cheatsheet/>» Cheat Sheet</option><option value=https://parsiya.io/>» My Clone</option><option value=https://github.com/parsiya/parsiya.net>» Source Repo</option><option value="https://queue.acm.org/detail.cfm?id=3197520">» Manual Work is a Bug</option><option value="https://www.google.com/search?q=andrew+ridgeley">» The Other Guy from Wham!</option></select></fieldset><ul class=main-navigation><li><a href=https://parsiya.net/about/ title="About Me!" target=_blank rel="noopener noreferrer">About Me!</a></li><li><a href=https://parsiya.net/cheatsheet/ title="Cheat Sheet" target=_blank rel="noopener noreferrer">Cheat Sheet</a></li><li><a href=https://parsiya.io/ title="My Clone" target=_blank rel="noopener noreferrer">My Clone</a></li><li><a href=https://github.com/parsiya/parsiya.net title="Source Repo" target=_blank rel="noopener noreferrer">Source Repo</a></li><li><a href="https://queue.acm.org/detail.cfm?id=3197520" title="Manual Work is a Bug" target=_blank rel="noopener noreferrer">Manual Work is a Bug</a></li><li><a href="https://www.google.com/search?q=andrew+ridgeley" title="The Other Guy from Wham!" target=_blank rel="noopener noreferrer">The Other Guy from Wham!</a></li></ul><ul class=subscription><a href=https://parsiya.net/index.xml target=_blank type=application/rss+xml title=RSS rel="noopener noreferrer"><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://parsiya.net/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>Oct 7, 2017
- 3 minute read
- <a href=https://parsiya.net/blog/2017-10-07-thick-client-proxying-part-7-proxying-.net-applications-via-config-file/#disqus_thread>Comments</a>
- <a class=label href=https://parsiya.net/categories/thick-client-proxying/>Thick Client Proxying </a><a class=label href=https://parsiya.net/categories/.net-framework/>.NET Framework</a></p><h1 class=entry-title>Thick Client Proxying - Part 7 - Proxying .NET Applications via Config File</h1></header><div class=entry-content><p>.NET applications use a configuration file to read some settings. It's an XML
file named <code>appName.exe.config</code>. We can pass a proxy address in this file.</p><p>These apps usually use WinINET or IE proxy settings. Sometimes, they do not. We
can either use an application specific config file or use one for the entire
.NET framework for a machine.</p><p>Look inside the decompiled code (or just grep the binary files) for references
to <code>System.Configuration</code> <a href="https://msdn.microsoft.com/en-us/library/system.configuration.configuration%28v=vs.110%29.aspx" target=_blank rel="noreferrer noopener">MSDN-page</a>. Applications
use <code>ConfigurationManager</code> and <code>WebConfigurationManager</code> classes to access these
settings.</p><h1 id=tldr>TL;DR
<a class=header-link href=#tldr><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><ol><li>For <code>app.exe</code>, create or edit <code>app.exe.config</code>.</li><li>Add the following to it. If the config file exist, merge the inner tags
(usually <code>system.net</code>).</li><li>Restart the app.</li></ol><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#268bd2>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#268bd2>&lt;system.net&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&lt;defaultProxy</span> enabled=<span style=color:#2aa198>&#34;true&#34;</span><span style=color:#268bd2>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#268bd2>&lt;proxy</span>
</span></span><span style=display:flex><span>        proxyaddress=<span style=color:#2aa198>&#34;http://127.0.0.1:8080&#34;</span>
</span></span><span style=display:flex><span>        bypassonlocal=<span style=color:#2aa198>&#34;false&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#268bd2>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&lt;/defaultProxy&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#268bd2>&lt;/system.net&gt;</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>&lt;/configuration&gt;</span>
</span></span></code></pre></div><h1 id=application-specific-config-file>Application specific config file.
<a class=header-link href=#application-specific-config-file><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>Add these settings (<code>configuration</code> is already present in existing config files):</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#268bd2>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#268bd2>&lt;system.net&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&lt;defaultProxy</span>
</span></span><span style=display:flex><span>      enabled = <span style=color:#2aa198>&#34;true&#34;</span> [true|false]
</span></span><span style=display:flex><span>      useDefaultCredentials = <span style=color:#2aa198>&#34;false&#34;</span> [true|false]
</span></span><span style=display:flex><span>      <span style=color:#268bd2>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#268bd2>&lt;bypasslist&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#268bd2>&lt;add</span>
</span></span><span style=display:flex><span>            address = <span style=color:#2aa198>&#34;&#34;</span> [String, Required, Collection Key]
</span></span><span style=display:flex><span>          <span style=color:#268bd2>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#268bd2>&lt;/bypasslist&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#268bd2>&lt;module</span>
</span></span><span style=display:flex><span>          type = <span style=color:#2aa198>&#34;&#34;</span> [String]
</span></span><span style=display:flex><span>      <span style=color:#268bd2>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#268bd2>&lt;proxy</span>
</span></span><span style=display:flex><span>        autoDetect = <span style=color:#2aa198>&#34;Unspecified&#34;</span> [False | True | Unspecified]
</span></span><span style=display:flex><span>        scriptLocation = <span style=color:#2aa198>&#34;&#34;</span>
</span></span><span style=display:flex><span>        bypassonlocal = <span style=color:#2aa198>&#34;Unspecified&#34;</span> [False | True | Unspecified]    // whitelist
</span></span><span style=display:flex><span>        proxyaddress = <span style=color:#2aa198>&#34;&#34;</span>                                             // proxy address
</span></span><span style=display:flex><span>        usesystemdefault = <span style=color:#2aa198>&#34;Unspecified&#34;</span> [False | True | Unspecified] // IE proxy settings
</span></span><span style=display:flex><span>      <span style=color:#268bd2>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&lt;/defaultProxy&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#268bd2>&lt;/system.net&gt;</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>Note <code>usesystemdefault</code> and <code>proxyaddress</code> are mutually exclusive. I think you
can have both but I am not sure which one will be used (probably
<code>usesystemdefault</code>)</p><p>For example:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#268bd2>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#268bd2>&lt;system.net&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&lt;defaultProxy&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#268bd2>&lt;proxy</span>
</span></span><span style=display:flex><span>        proxyaddress=<span style=color:#2aa198>&#34;http://127.0.0.1:8080&#34;</span>
</span></span><span style=display:flex><span>        bypassonlocal=<span style=color:#2aa198>&#34;false&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#268bd2>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#268bd2>&lt;bypasslist&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#268bd2>&lt;add</span> address=<span style=color:#2aa198>&#34;[a-z]+\.contoso\.com&#34;</span> <span style=color:#268bd2>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#268bd2>&lt;/bypasslist&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&lt;/defaultProxy&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#268bd2>&lt;/system.net&gt;</span>
</span></span><span style=display:flex><span><span style=color:#268bd2>&lt;/configuration&gt;</span>
</span></span></code></pre></div><ul><li>Keep <code>http://</code> in <code>proxy address</code> even if you are using an HTTPS proxy like
Burp, it will proxy TLS.</li><li>If IE proxy settings are not working then <code>usesystemdefault</code> is useless for
you as it does the same thing. For Windows services it will not work because
proxy settings are per-user by default and different for the account running
the service.</li></ul><p>Use tools like <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/procmon target=_blank rel="noreferrer noopener">Process Monitor</a> to detect if the application is
looking for this or any other configuration files.</p><h2 id=net-framework-machine-configuration-file>.NET Framework Machine Configuration File
<a class=header-link href=#net-framework-machine-configuration-file><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>We can use a similar config file for the entire machine. Meaning any application
running via that .NET framework will use those settings (honoring them is
another matter but standard libraries usually do).</p><p>Location is <code>%WINDIR%\Microsoft.NET\Framework|Framework64\[version]\Config\machine.config</code>.</p><p><strong>Important note</strong>: You need to change the config for both 32 and 64-bit
frameworks (Framework|Framework64) and each version (e.g. 2, 3 or 4) separately.</p><p>For example for 64-bit .NET Framework 4.x (anything 4.x is under 4):</p><ul><li><code>C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config</code></li></ul><p>To learn more about the config file (which is really recommended) see file
<code>machine.config.comments</code> in the same location. It has comments and examples.
<strong>Read those</strong>.</p></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>Parsia</span></span>
<time>Oct 7, 2017</time>
<span class=categories>Tags:
<a class=category href=https://parsiya.net/tags/.net>.NET</a></span></p><p class=meta><a class="basic-alignment left" href=https://parsiya.net/blog/2017-09-21-razer-comms/ title="Razer Comms">Razer Comms</a>
<a class="basic-alignment right" href=https://parsiya.net/blog/2017-10-08-thick-client-proxying-part-8-notes-on-proxying-windows-services/ title="Thick Client Proxying - Part 8 - Notes on Proxying Windows Services">Thick Client Proxying - Part 8 - Notes on Proxying Windows Services</a></p><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//parsiya.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h1>Who am I?</h1><p><p>I am Parsia, an application security engineer.</p><p>I write about application security, cryptography, static analysis, and
(of course) videogames.</p><p>Click on <a href=/about/>About Me!</a> to know more.</p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank rel="me noopener noreferrer" href=https://infosec.exchange/@parsiya title=https://infosec.exchange/@parsiya><i class="fa fa-mastodon fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://github.com/parsiya/ title=https://github.com/parsiya/><i class="fa fa-github fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://twitter.com/cryptogangsta/ title=https://twitter.com/cryptogangsta/><i class="fa fa-twitter fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/in/parsiya title=https://www.linkedin.com/in/parsiya><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><h1>Collections</h1><li><a href=https://parsiya.net/categories/thick-client-proxying/ title="Thick Client Proxying">Thick Client Proxying</a></li><li><a href=https://parsiya.net/categories/writeup/ title=CTFs/Writeups>CTFs/Writeups</a></li><li><a href=https://parsiya.net/categories/attack-surface-analysis/ title="Attack Surface Analysis">Attack Surface Analysis</a></li><li><a href=https://parsiya.net/categories/static-analysis/ title="Static Analysis">Static Analysis</a></li><li><a href=https://parsiya.net/categories/bug-bounty/ title="Bug Bounty">Bug Bounty</a></li><li><a href=https://parsiya.net/categories/blockchain/ title="Blockchain (lol)">Blockchain (lol)</a></li><li><a href=https://parsiya.net/categories/crypto/ title=Crypto(graphy)>Crypto(graphy)</a></li><li><a href=https://parsiya.net/categories/burp-extension/ title="Burp Extension Development">Burp Extension Development</a></li><li><a href=https://parsiya.net/categories/automation/ title=Automation>Automation</a></li><li><a href=https://parsiya.net/categories/reverse-engineering/ title="Reverse Engineering">Reverse Engineering</a></li><li><a href=https://parsiya.net/categories/winappdbg/ title="WinAppDbg (use Frida instead)">WinAppDbg (use Frida instead)</a></li><li><a href=https://awsome.pw title='AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability'>AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability</a></li></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2024 Parsia - <a href=https://parsiya.net/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>