<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>Thick Client Proxying - Part 5: FileHippo App Manager or the Bloated Hippo</title><link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://parsiya.net/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Parsia Hakimian Parsiya infosec information security]"><meta name=author content="Parsia"><meta name=generator content="Hugo 0.110.0"><meta name=twitter:card content="summary"><meta name=twitter:title content="Thick Client Proxying - Part 5: FileHippo App Manager or the Bloated Hippo"><meta name=twitter:description content="I have talked a lot about this and that but have done nothing in action. Now I will talk about proxying actual applications. I will start with something easy, the FileHippo App Manager. This app was chosen because it can be proxied with Burp, it does not use TLS and it has its own proxy settings (also works with Internet Explorer proxy settings). The requests are pretty simple to understand. I like the FileHippo website because it archives old versions of software. For example I loved the non-bloated Yahoo! Messenger 8.0 when I used it (it's pretty popular in some places) and used FileHippo to download the old versions.
FileHippo App Manager turned out to be more interesting than I thought and this post turned into some .NET reverse engineering using dnSpy. Here's what I talk about in this post:

The app contains the AWS SDK and a fortunately invalid set of AWS Access/Secret keys. Both the SDK and the keys are in dead code.
Requests have an AccessToken header which is generated client-side. We will discuss how it is generated.
The application has a &#34;hidden&#34; DEBUG mode which unfortunately does nothing special. We will discover how to enable it.
"><meta name=twitter:domain content="parsiya.net"><meta name=twitter:creator content="@CryptoGangsta"></head><body><header role=banner><hgroup><h1><a href=https://parsiya.net/>Hackerman's Hacking Tutorials</a></h1><h2>The knowledge of anything, since all things have causes, is not acquired or
complete unless it is known by its causes. - Avicenna</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://parsiya.net/about/>» About Me!</option><option value=https://parsiya.net/cheatsheet/>» Cheat Sheet</option><option value=https://parsiya.io/>» My Clone</option><option value=https://github.com/parsiya/parsiya.net>» Source Repo</option><option value="https://queue.acm.org/detail.cfm?id=3197520">» Manual Work is a Bug</option><option value="https://www.google.com/search?q=andrew+ridgeley">» The Other Guy from Wham!</option></select></fieldset><ul class=main-navigation><li><a href=https://parsiya.net/about/ title="About Me!" target=_blank rel="noopener noreferrer">About Me!</a></li><li><a href=https://parsiya.net/cheatsheet/ title="Cheat Sheet" target=_blank rel="noopener noreferrer">Cheat Sheet</a></li><li><a href=https://parsiya.io/ title="My Clone" target=_blank rel="noopener noreferrer">My Clone</a></li><li><a href=https://github.com/parsiya/parsiya.net title="Source Repo" target=_blank rel="noopener noreferrer">Source Repo</a></li><li><a href="https://queue.acm.org/detail.cfm?id=3197520" title="Manual Work is a Bug" target=_blank rel="noopener noreferrer">Manual Work is a Bug</a></li><li><a href="https://www.google.com/search?q=andrew+ridgeley" title="The Other Guy from Wham!" target=_blank rel="noopener noreferrer">The Other Guy from Wham!</a></li></ul><ul class=subscription><a href=https://parsiya.net/index.xml target=_blank type=application/rss+xml title=RSS rel="noopener noreferrer"><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://parsiya.net/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>May 15, 2016
- 20 minute read
- <a href=https://parsiya.net/blog/2016-05-15-thick-client-proxying-part-5-filehippo-app-manager-or-the-bloated-hippo/#disqus_thread>Comments</a>
- <a class=label href=https://parsiya.net/categories/burp/>Burp </a><a class=label href=https://parsiya.net/categories/thick-client-proxying/>Thick Client Proxying</a></p><h1 class=entry-title>Thick Client Proxying - Part 5: FileHippo App Manager or the Bloated Hippo</h1></header><div class=entry-content><nav id=TableOfContents><ul><li><a href=#1-ingredients>1. Ingredients</a></li><li><a href=#2-proxying>2. Proxying</a><ul><li><a href=#21-proxy-settings>2.1 Proxy settings</a></li><li><a href=#22-app-manager-scanning>2.2 App Manager Scanning</a></li><li><a href=#23-updating-applications-via-the-filehippo-app-manager>2.3 Updating Applications via the FileHippo App Manager</a></li><li><a href=#24-calling-home>2.4 Calling Home</a></li><li><a href=#25-self-update>2.5 Self-Update</a></li><li><a href=#26-done-with-proxying>2.6 Done with Proxying</a></li></ul></li><li><a href=#3-application-analysis-via-dnspy>3. Application Analysis via dnSpy</a><ul><li><a href=#31-the-bloated-hippo>3.1 The Bloated Hippo</a></li><li><a href=#32-searching-through-the-code>3.2 Searching through the Code</a></li><li><a href=#33-the-accesstoken-header>3.3 The AccessToken Header</a><ul><li><a href=#331-the-encryption-scheme>3.3.1 The Encryption Scheme</a></li><li><a href=#332-key-generation>3.3.2 Key Generation</a></li></ul></li><li><a href=#34-the-abandoned-s3-keys>3.4 The Abandoned S3 Keys</a><ul><li><a href=#341-checking-the-validity-of-the-key-pair-without-going-to-jail>3.4.1 Checking the Validity of the Key Pair without Going to Jail</a></li></ul></li><li><a href=#35-the-update-process>3.5 The Update Process</a></li><li><a href=#36-debug-and-background-modes>3.6 Debug and Background Modes</a><ul><li><a href=#361-activating-the-debug-mode>3.6.1 Activating the Debug Mode</a><ul><li><a href=#3611-using-linqpad-to-decipher-196676>3.6.1.1 Using LINQPad to Decipher 196676</a></li></ul></li><li><a href=#362-what-does-the-debug-mode-do>3.6.2 What does the Debug Mode do?</a><ul><li><a href=#3621-scanner-debug-mode>3.6.2.1 Scanner Debug Mode</a></li><li><a href=#3622-obsolete-debug-program-definitions>3.6.2.2 (Obsolete) Debug Program Definitions</a></li></ul></li></ul></li></ul></li><li><a href=#4-conclusion>4. Conclusion</a></li></ul></nav><p>I have talked a lot about this and that but have done nothing in action. Now I will talk about proxying actual applications. I will start with something easy, the <a href=http://filehippo.com/download_app_manager/ target=_blank rel="noreferrer noopener">FileHippo App Manager</a>. This app was chosen because it can be proxied with Burp, it does not use TLS and it has its own proxy settings (also works with Internet Explorer proxy settings). The requests are pretty simple to understand. I like the FileHippo website because it archives old versions of software. For example I loved the non-bloated Yahoo! Messenger 8.0 when I used it (it's pretty popular in some places) and used FileHippo to download the old versions.</p><p>FileHippo App Manager turned out to be more interesting than I thought and this post turned into some .NET reverse engineering using dnSpy. Here's what I talk about in this post:</p><ul><li>The app contains the AWS SDK and a fortunately invalid set of AWS Access/Secret keys. Both the SDK and the keys are in dead code.</li><li>Requests have an <code>AccessToken</code> header which is generated client-side. We will discuss how it is generated.</li><li>The application has a "hidden" DEBUG mode which unfortunately does nothing special. We will discover how to enable it.</li></ul><p>Note: I attempted to contact both <a href=http://www.wkmedia.com/ target=_blank rel="noreferrer noopener">Well Known Media</a> (parent company of FileHippo) and <a href=http://filehippo.com/ target=_blank rel="noreferrer noopener">FileHippo</a> via their security addresses. <code>security@filehippo.com</code> and <code>security@wkmedia.com</code> do not exist. I contacted them via their only email on the Well Known Media website which is <code>adsales@wkemdia.com</code> and got no response. I tried to check the validity of the keys using the most non-intrusive way possible as discussed below and fortunately they were not valid so I went ahead and shared the adventure.</p><h1 id=1-ingredients>1. Ingredients
<a class=header-link href=#1-ingredients><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><ul><li>Windows 7 VM</li><li><a href=http://filehippo.com/download_app_manager/ target=_blank rel="noreferrer noopener">FileHippo App Manager 2.0 beta 4</a></li><li>Burp free</li><li><a href="https://portswigger.net/bappstore/ShowBappDetails.aspx?uuid=ceed5b1568ba4b92abecce0dff1e1f2c" target=_blank rel="noreferrer noopener">JSON Decoder plugin from Burp's App Store</a></li><li><a href=https://github.com/0xd4d/dnSpy/releases target=_blank rel="noreferrer noopener">dnSpy</a></li></ul><h1 id=2-proxying>2. Proxying
<a class=header-link href=#2-proxying><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><h2 id=21-proxy-settings>2.1 Proxy settings
<a class=header-link href=#21-proxy-settings><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Install and run the application. Click on the <code>Settings</code> gear icon to the left and then select the <code>Connection</code> tab to see the proxy settings.</p><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/01.PNG title="Application's proxy settings" alt="Application's proxy settings">
<span class=caption-text>Application's proxy settings</span></span><p>As you can see, the application supports its own proxy settings and also can use IE proxy settings via the <code>Auto-detect proxy settings for this network</code>. It does not really matter which method is chosen, we can use both of these to point the application to Burp. Point it to Burp's proxy listener (default is <code>127.0.0.1:8080</code>), run Burp and then press <code>Test</code>.</p><p>We can see two requests in Burp. First request is to get <code>update.filehippo.com</code> which is redirected with a <code>302 Found</code> response to <a href=http://filehippo.com/default.asp target=_blank rel="noreferrer noopener">http://filehippo.com/default.asp</a>.</p><figure class=code><figcaption><span>GET update.filehippo.com and the 302 response</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>Request:
</span></span><span style=display:flex><span>GET / HTTP/1.1
</span></span><span style=display:flex><span>Host: update.filehippo.com
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Response:
</span></span><span style=display:flex><span>HTTP/1.1 302 Found
</span></span><span style=display:flex><span>Location: http://filehippo.com/default.aspx
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Content-Length: 150
</span></span><span style=display:flex><span>Connection: Close
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#268bd2>html</span>&gt;&lt;<span style=color:#268bd2>head</span>&gt;&lt;<span style=color:#268bd2>title</span>&gt;Object moved&lt;/<span style=color:#268bd2>title</span>&gt;&lt;/<span style=color:#268bd2>head</span>&gt;&lt;<span style=color:#268bd2>body</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#268bd2>h2</span>&gt;Object moved to &lt;<span style=color:#268bd2>a</span> href<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;http://filehippo.com/default.aspx&#34;</span>&gt;here&lt;/<span style=color:#268bd2>a</span>&gt;.&lt;/<span style=color:#268bd2>h2</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#268bd2>body</span>&gt;&lt;/<span style=color:#268bd2>html</span>&gt;</span></span></code></pre></td></tr></table></div></div></div></figure><p>The application automatically attempts to grab the <code>default.aspx</code> page and if successful will pass the proxy test.</p><p>If we look at the traffic captured between the application and Burp we can see http proxying in action.</p><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/02.PNG title="HTTP proxying in action" alt="HTTP proxying in action">
<span class=caption-text>HTTP proxying in action</span></span><p><a href=https://parsiya.net/blog/2015-10-19-proxying-hipchat-part-3-ssl-added-and-removed-here/#2-1-get-downloads-hipchat-com-blog-info-html title="HTTP requests through a proxy">As we already know</a>, there is no <code>CONNECT</code> because the proxy can see the <code>Host</code> header and forward the requests to the correct destination.</p><h2 id=22-app-manager-scanning>2.2 App Manager Scanning
<a class=header-link href=#22-app-manager-scanning><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Close the application and restart it again (there is one request that we want to see).</p><p>First request is a weird one. It is asking the server for the current date and time via a GET request to <a href=http://appmanager.filehippo.com/api/v1/DateTime target=_blank rel="noreferrer noopener">http://appmanager.filehippo.com/api/v1/DateTime</a>.</p><figure class=code><figcaption><span>Get DateTime</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>GET /api/v<span style=color:#2aa198>1</span>/DateTime HTTP/<span style=color:#2aa198>1.1</span>
</span></span><span style=display:flex><span>User-Agent: download_manager
</span></span><span style=display:flex><span>ClientId: <span style=color:#2aa198>4</span>dfe<span style=color:#2aa198>2</span>b<span style=color:#2aa198>82-501</span>c<span style=color:#2aa198>-4324-83</span>ce<span style=color:#2aa198>-6</span>d<span style=color:#2aa198>49</span>a<span style=color:#2aa198>96</span>cdf<span style=color:#2aa198>61</span>
</span></span><span style=display:flex><span>AppManagerVersion: <span style=color:#2aa198>2.0</span>.<span style=color:#2aa198>0.392</span>
</span></span><span style=display:flex><span>AccessToken: <span style=color:#2aa198>2</span>N<span style=color:#2aa198>0</span>+YwVnSXph<span style=color:#2aa198>9</span>L<span style=color:#2aa198>0</span>ZuS<span style=color:#2aa198>8</span>zOmnSvvKHq<span style=color:#2aa198>10</span>QYMtuM<span style=color:#2aa198>0</span>GdUVmLp<span style=color:#2aa198>067</span>RfBBpw==
</span></span><span style=display:flex><span>RequestTime: <span style=color:#2aa198>2016-05-17</span>T<span style=color:#2aa198>04</span>:<span style=color:#2aa198>47</span>:<span style=color:#2aa198>25.3968037</span>Z
</span></span><span style=display:flex><span>Host: appmanager.filehippo.com
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Response body:
</span></span><span style=display:flex><span>{<span style=color:#268bd2>&#34;DateTime&#34;</span>:<span style=color:#2aa198>&#34;2016-05-17T04:47:57.0719162Z&#34;</span>,<span style=color:#268bd2>&#34;Status&#34;</span>:<span style=color:#2aa198>0</span>,<span style=color:#268bd2>&#34;Message&#34;</span>:<span style=color:#cb4b16>null</span>}</span></span></code></pre></td></tr></table></div></div></div></figure><p>Note the <code>AccessToken</code> which is a 40 byte blob in base64. For this request we can remove the <code>AccessToken</code> and it works. Why would the app get the date and time from the server?</p><p>Then the app requests <a href=http://appmanager.filehippo.com/api/v1/ProgramDefinitions target=_blank rel="noreferrer noopener">http://appmanager.filehippo.com/api/v1/ProgramDefinitions</a> which is a list of all applications that are supported by the App Manager. This request also contains the <code>AccessToken</code> header which contains a base64 encoded 40 byte blob. It seems like this access token is also time sensitive because if you send the request to Repeater and then send it after 10 minutes the response is <code>401 Unauthorized</code> while this did not happen in the <code>DateTime</code> request. At this point we do not know where this access token comes from because it is not in any of the responses (up until now we have only done the proxy test). There is also a 32 byte GUID named <code>ClientId</code>. Based on the previous request and the <code>ClientId</code> header, you can probably guess how the <code>AccessToken</code> is generated.</p><figure class=code><figcaption><span>Retrieving program definitions</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>Request:
</span></span><span style=display:flex><span>GET /api/v<span style=color:#2aa198>1</span>/ProgramDefinitions HTTP/<span style=color:#2aa198>1.1</span>
</span></span><span style=display:flex><span>User-Agent: download_manager
</span></span><span style=display:flex><span>ClientId: ...
</span></span><span style=display:flex><span>AppManagerVersion: <span style=color:#2aa198>2.0</span>.<span style=color:#2aa198>0.392</span>
</span></span><span style=display:flex><span>AccessToken: ...
</span></span><span style=display:flex><span>RequestTime: <span style=color:#2aa198>2016-05-15</span>T<span style=color:#2aa198>21</span>:<span style=color:#2aa198>56</span>:<span style=color:#2aa198>10.2127122</span>Z
</span></span><span style=display:flex><span>Host: appmanager.filehippo.com
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Response body:
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;Status&#34;</span>: <span style=color:#2aa198>0</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;Message&#34;</span>: <span style=color:#cb4b16>null</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;Definitions&#34;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;DetectionXML&#34;</span>: <span style=color:#2aa198>&#34;&lt;fp&gt;\r\n    &lt;fn&gt;abiword.exe&lt;/fn&gt;\r\n    &lt;pfloc&gt;abisuite2\\abiword\\bin&lt;/pfloc&gt;\r\n&lt;/fp&gt;\r\n&lt;fp&gt;\r\n    &lt;fn&gt;abiword.exe&lt;/fn&gt;\r\n    &lt;pfloc&gt;abiword\\bin&lt;/pfloc&gt;\r\n&lt;/fp&gt;\r\n&lt;reg&gt;\r\n    &lt;k hive=\&#34;hklm\&#34; key=\&#34;software\\abisuite\\abiword\\v2\&#34;&gt;\r\n        &lt;v name=\&#34;Version\&#34;/&gt;\r\n    &lt;/k&gt;\r\n&lt;/reg&gt;\r\n&lt;reg&gt;\r\n    &lt;k hive=\&#34;hklm\&#34; key=\&#34;software\\abiword\\v2\&#34;&gt;\r\n        &lt;v name=\&#34;Version\&#34;/&gt;\r\n    &lt;/k&gt;\r\n&lt;/reg&gt;&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;ProgramId&#34;</span>: <span style=color:#2aa198>135</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;DetectionXML&#34;</span>: <span style=color:#2aa198>&#34;&lt;fp&gt;\r\n    &lt;fn&gt;ACDSee*.exe&lt;/fn&gt;\r\n    &lt;pfloc&gt;ACD Systems\\ACDSee\\*&lt;/pfloc&gt;\r\n&lt;/fp&gt;\r\n&lt;fp&gt;\r\n    &lt;fn&gt;ACDSee*.exe&lt;/fn&gt;\r\n    &lt;pfloc&gt;ACD Systems\\ACDSee\\17.0&lt;/pfloc&gt;\r\n&lt;/fp&gt;\r\n&lt;fp&gt;\r\n    &lt;fn&gt;ACDSee*.exe&lt;/fn&gt;\r\n    &lt;pfloc&gt;ACD Systems\\ACDSee\\18.0&lt;/pfloc&gt;\r\n&lt;/fp&gt;&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;ProgramId&#34;</span>: <span style=color:#2aa198>83</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        ...</span></span></code></pre></td></tr></table></div></div></div></figure><p>Next is a <code>POST</code> request to <a href=http://appmanager.filehippo.com/api/v1/ScanResults target=_blank rel="noreferrer noopener">http://appmanager.filehippo.com/api/v1/ScanResults</a> with a JSON payload in the body. The payload contains information about installed programs. The access token is also different.</p><figure class=code><figcaption><span>POST ScanResults</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">35
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>parts of request&#39;s body:
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;Programs&#34;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Registry&#34;</span>: [],
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Id&#34;</span>: <span style=color:#2aa198>298</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Files&#34;</span>: [
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#268bd2>&#34;VerPv&#34;</span>: <span style=color:#2aa198>&#34;2.0.0.392&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#268bd2>&#34;VerPvr&#34;</span>: <span style=color:#2aa198>&#34;2.0.0.392&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#268bd2>&#34;Len&#34;</span>: <span style=color:#2aa198>10566352</span>,
</span></span><span style=display:flex><span>                    <span style=color:#268bd2>&#34;VerFv&#34;</span>: <span style=color:#2aa198>&#34;2.0.0.392&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#268bd2>&#34;VerFvr&#34;</span>: <span style=color:#2aa198>&#34;2.0.0.392&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#268bd2>&#34;File&#34;</span>: <span style=color:#2aa198>&#34;C:\\Program Files (x86)\\FileHippo.com\\FileHippo.AppManager.exe&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#268bd2>&#34;Md5&#34;</span>: <span style=color:#2aa198>&#34;6798339CF7C87F5F567A8F050614D6B8&#34;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Registry&#34;</span>: [],
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Id&#34;</span>: <span style=color:#2aa198>12</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Files&#34;</span>: [
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#268bd2>&#34;VerPv&#34;</span>: <span style=color:#2aa198>&#34;46.0.1&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#268bd2>&#34;VerPvr&#34;</span>: <span style=color:#2aa198>&#34;46.0.1.0&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#268bd2>&#34;Len&#34;</span>: <span style=color:#2aa198>392136</span>,
</span></span><span style=display:flex><span>                    <span style=color:#268bd2>&#34;VerFv&#34;</span>: <span style=color:#2aa198>&#34;46.0.1&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#268bd2>&#34;VerFvr&#34;</span>: <span style=color:#2aa198>&#34;46.0.1.5966&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#268bd2>&#34;File&#34;</span>: <span style=color:#2aa198>&#34;C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#268bd2>&#34;Md5&#34;</span>: <span style=color:#2aa198>&#34;7DF8845A1CF92C227E81DBBC6F6434DF&#34;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></div></figure><p>The response contains links to the applications that have updates. For example in this case, <code>Firefox 47 Beta 2.0</code> is available.</p><figure class=code><figcaption><span>Response to ScanResults</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;HasUpdate&#34;</span>: <span style=color:#cb4b16>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;Size&#34;</span>: <span style=color:#2aa198>4203840</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;InstalledDatePublished&#34;</span>: <span style=color:#2aa198>&#34;2015-10-19T08:04:36&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;Title&#34;</span>: <span style=color:#2aa198>&#34;Notepad++ 6.9.1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;ProgramID&#34;</span>: <span style=color:#2aa198>186</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;ApplicationManagerIconData&#34;</span>: <span style=color:#2aa198>&#34;base64 encoded application icon&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;DatePublished&#34;</span>: <span style=color:#2aa198>&#34;2016-03-29T12:27:13&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;IconURL&#34;</span>: <span style=color:#cb4b16>null</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;InstalledVersion&#34;</span>: <span style=color:#2aa198>&#34;6.8.5.0.0&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;LatestVersion&#34;</span>: <span style=color:#2aa198>&#34;6.9.1.0.0&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;InstallationPath&#34;</span>: <span style=color:#2aa198>&#34;C:\\Program Files (x86)\\Notepad++&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;FileID&#34;</span>: <span style=color:#2aa198>67045</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;IsBeta&#34;</span>: <span style=color:#cb4b16>false</span>,
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;DownloadUrl&#34;</span>: <span style=color:#2aa198>&#34;http://filehippo.com/download/file/2c2add5142b29932a40731e489a786c97d3ca3b1a2a9627b395eb6878d0c12df&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>...</span></span></code></pre></td></tr></table></div></div></div></figure><p>Notice that the download link is over HTTP, in fact <code>FileHippo.com</code> is served over HTTP.</p><p>Next request is where the app <em>exfiltrates</em> (hyperbole of course) data from our machine. Not super secret stuff but information about installed applications and the operating system. The previous request only contained applications supported by the App Manager but this one contains a lot more. It's a <code>POST</code> request to <a href=http://appmanager.filehippo.com/api/v1/InstallerPrograms target=_blank rel="noreferrer noopener">http://appmanager.filehippo.com/api/v1/InstallerPrograms</a> with another JSON payload.</p><p>The <code>ClientId</code> is the same between requests but the <code>AccessToken</code> is different each time and we still do not know where it comes from.</p><figure class=code><figcaption><span>InstallerPrograms</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">30
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;Programs&#34;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Publisher&#34;</span>: <span style=color:#2aa198>&#34;FileHippo.com&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Name&#34;</span>: <span style=color:#2aa198>&#34;FileHippo App Manager&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Is64Bit&#34;</span>: <span style=color:#cb4b16>false</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Version&#34;</span>: <span style=color:#cb4b16>null</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;HiveLocalMachine&#34;</span>: <span style=color:#cb4b16>true</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;HiveCurrentUser&#34;</span>: <span style=color:#cb4b16>false</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Key&#34;</span>: <span style=color:#2aa198>&#34;FileHippo.com&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Publisher&#34;</span>: <span style=color:#2aa198>&#34;Google Inc.&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Name&#34;</span>: <span style=color:#2aa198>&#34;Google Chrome&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Is64Bit&#34;</span>: <span style=color:#cb4b16>false</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Version&#34;</span>: <span style=color:#2aa198>&#34;50.0.2661.102&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;HiveLocalMachine&#34;</span>: <span style=color:#cb4b16>true</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;HiveCurrentUser&#34;</span>: <span style=color:#cb4b16>false</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Key&#34;</span>: <span style=color:#2aa198>&#34;Google Chrome&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Publisher&#34;</span>: <span style=color:#2aa198>&#34;Ma\u00ebl H\u00f6rz&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Name&#34;</span>: <span style=color:#2aa198>&#34;HxD Hex Editor version 1.7.7.0&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Is64Bit&#34;</span>: <span style=color:#cb4b16>false</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Version&#34;</span>: <span style=color:#2aa198>&#34;1.7.7.0&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;HiveLocalMachine&#34;</span>: <span style=color:#cb4b16>true</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;HiveCurrentUser&#34;</span>: <span style=color:#cb4b16>false</span>,
</span></span><span style=display:flex><span>            <span style=color:#268bd2>&#34;Key&#34;</span>: <span style=color:#2aa198>&#34;HxD Hex Editor_is1&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        ...</span></span></code></pre></td></tr></table></div></div></div></figure><p>Notice the <em>exfiltrated</em> data. It includes if the application is installed for all users (has entries in the <code>LocalMachine</code> registry hive) vs. installed for current user (has entries in the <code>CurrentUser</code> registry hive), the version, publisher and if it is a 64-bit application.</p><p>The response to this message makes no sense (dots are added to the code block for better visibility).</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>Response to InstallerPrograms
</span></span><span style=display:flex><span>{<span style=color:#268bd2>&#34;Status&#34;</span>:<span style=color:#2aa198>1</span>,<span style=color:#268bd2>&#34;Message&#34;</span>:<span style=color:#2aa198>&#34;The IP address \&#34;10.0.1.34\&#34;
</span></span></span><span style=display:flex><span><span style=color:#2aa198>    is a reserved IP address (private, multicast, etc.)&#34;</span>}
</span></span></code></pre></div><p>The request does not contain any IP addresses. Is this the internal IP address of the metrics server? Why is this a response?</p><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/03-ScanResult.PNG title="Scan Result" alt="Scan Result">
<span class=caption-text>Scan Result</span></span><h2 id=23-updating-applications-via-the-filehippo-app-manager>2.3 Updating Applications via the FileHippo App Manager
<a class=header-link href=#23-updating-applications-via-the-filehippo-app-manager><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Updating is pretty simple. I am going to update <code>Notepad++</code>.</p><p>First the application sends a <code>GET</code> request over HTTP to download the new version. This link came from the <code>DownloadUrl</code> element in the <code>ScanResults</code> response that we saw above. The response is a <code>302 Moved Permanently</code> to a different download URL: <a href="http://dl1.filehippo.com/668e1f2d71fd4e9290c5396cb22af8c0/npp.6.9.1.Installer.exe?ttl=1463371091&token=045580ac50574f9e72be3a8db8337740" target=_blank rel="noreferrer noopener">http://dl1.filehippo.com/668e1f2d71fd4e9290c5396cb22af8c0/npp.6.9.1.Installer.exe?ttl=1463371091&token=045580ac50574f9e72be3a8db8337740</a>.</p><p>Then the installer is downloaded over HTTP and executed. We will later see how.</p><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/04-AllRequests.PNG title="All requests in Burp HTTP History" alt="All requests in Burp HTTP History">
<span class=caption-text>All requests in Burp HTTP History</span></span><h2 id=24-calling-home>2.4 Calling Home
<a class=header-link href=#24-calling-home><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>From time to time the app <code>Calls Home</code> and send the current Operating System version.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>POST /api/v<span style=color:#2aa198>1</span>/CallHome HTTP/<span style=color:#2aa198>1.1</span>
</span></span><span style=display:flex><span>User-Agent: download_manager
</span></span><span style=display:flex><span>ClientId: ...
</span></span><span style=display:flex><span>AppManagerVersion: <span style=color:#2aa198>2.0</span>.<span style=color:#2aa198>0.392</span>
</span></span><span style=display:flex><span>AccessToken: ...
</span></span><span style=display:flex><span>RequestTime: <span style=color:#2aa198>2016-05-15</span>T<span style=color:#2aa198>22</span>:<span style=color:#2aa198>08</span>:<span style=color:#2aa198>59.6814622</span>Z
</span></span><span style=display:flex><span>Content-Type: application/json; charset=utf<span style=color:#2aa198>-8</span>
</span></span><span style=display:flex><span>Host: appmanager.filehippo.com
</span></span><span style=display:flex><span>Content-Length: <span style=color:#2aa198>66</span>
</span></span><span style=display:flex><span>Expect: <span style=color:#2aa198>100</span>-continue
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{<span style=color:#268bd2>&#34;OperatingSystem&#34;</span>:<span style=color:#2aa198>&#34;Microsoft Windows NT 6.1.7601 Service Pack 1&#34;</span>}
</span></span></code></pre></div><p>And the response is similar to the <code>InstallerPrograms</code> request:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>Response to CallHome
</span></span><span style=display:flex><span>{<span style=color:#268bd2>&#34;Status&#34;</span>:<span style=color:#2aa198>1</span>,<span style=color:#268bd2>&#34;Message&#34;</span>:<span style=color:#2aa198>&#34;The IP address \&#34;10.0.1.34\&#34;
</span></span></span><span style=display:flex><span><span style=color:#2aa198>    is a reserved IP address (private, multicast, etc.)&#34;</span>}
</span></span></code></pre></div><p>Another <code>CallHome</code> response had a different internal IP in response <code>10.0.0.73</code>. Is the application leaking internal IPs in responses?</p><h2 id=25-self-update>2.5 Self-Update
<a class=header-link href=#25-self-update><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Every once in a while the application checks if a new version of itself is published. The request and the response are both pretty simple.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>GET /api/v<span style=color:#2aa198>1</span>/AppUpdateCheck HTTP/<span style=color:#2aa198>1.1</span>
</span></span><span style=display:flex><span>User-Agent: download_manager
</span></span><span style=display:flex><span>ClientId: ...
</span></span><span style=display:flex><span>AppManagerVersion: <span style=color:#2aa198>2.0</span>.<span style=color:#2aa198>0.392</span>
</span></span><span style=display:flex><span>AccessToken: ...
</span></span><span style=display:flex><span>RequestTime: <span style=color:#2aa198>2016-05-18</span>T<span style=color:#2aa198>04</span>:<span style=color:#2aa198>44</span>:<span style=color:#2aa198>0</span><span style=color:#2aa198>5.3721068</span>Z
</span></span><span style=display:flex><span>Host: appmanager.filehippo.com
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Response body:
</span></span><span style=display:flex><span>{<span style=color:#268bd2>&#34;Url&#34;</span>:<span style=color:#cb4b16>null</span>,<span style=color:#268bd2>&#34;UpdateAvailable&#34;</span>:<span style=color:#cb4b16>false</span>,<span style=color:#268bd2>&#34;Status&#34;</span>:<span style=color:#2aa198>0</span>,<span style=color:#268bd2>&#34;Message&#34;</span>:<span style=color:#cb4b16>null</span>}
</span></span></code></pre></div><h2 id=26-done-with-proxying>2.6 Done with Proxying
<a class=header-link href=#26-done-with-proxying><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>At this point we are pretty much done with the proxying, however we still have some questions such as:</p><ul><li>How is the <code>AccessToken</code> header generated?</li><li>How does the installer get executed?</li></ul><h1 id=3-application-analysis-via-dnspy>3. Application Analysis via dnSpy
<a class=header-link href=#3-application-analysis-via-dnspy><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>It's a .NET application, so we can use our favorite tool for investigating managed code which is dnSpy. The application does not have a lot of functionality. But the executable is around 10 MBs which is interestingn.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#268bd2>PS</span> <span style=color:#cb4b16>C</span>:\<span style=color:#cb4b16>Program</span> <span style=color:#cb4b16>Files</span> (<span style=color:#cb4b16>x86</span>)\<span style=color:#cb4b16>FileHippo.com</span>&gt; <span style=color:#cb4b16>ls</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Directory: C:\<span style=color:#268bd2>Program</span> <span style=color:#cb4b16>Files</span> (<span style=color:#cb4b16>x86</span>)\<span style=color:#cb4b16>FileHippo.com</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>Mode</span>                <span style=color:#cb4b16>LastWriteTime</span>     <span style=color:#cb4b16>Length</span> <span style=color:#cb4b16>Name</span>
</span></span><span style=display:flex><span>----                -------------     ------ ----
</span></span><span style=display:flex><span>-<span style=color:#268bd2>a---</span>          <span style=color:#2aa198>9</span>/<span style=color:#2aa198>2</span>/<span style=color:#2aa198>2015</span>   <span style=color:#2aa198>7</span>:<span style=color:#2aa198>00</span> <span style=color:#cb4b16>AM</span>   <span style=color:#2aa198>10566352</span> <span style=color:#cb4b16>FileHippo.AppManager.exe</span>
</span></span><span style=display:flex><span>-<span style=color:#268bd2>a---</span>         <span style=color:#2aa198>5</span>/<span style=color:#2aa198>11</span>/<span style=color:#2aa198>2016</span>   <span style=color:#2aa198>9</span>:<span style=color:#2aa198>51</span> <span style=color:#cb4b16>PM</span>     <span style=color:#2aa198>177577</span> <span style=color:#cb4b16>Uninstall.exe</span>
</span></span><span style=display:flex><span>-<span style=color:#268bd2>a---</span>         <span style=color:#2aa198>2</span>/<span style=color:#2aa198>17</span>/<span style=color:#2aa198>2015</span>  <span style=color:#2aa198>12</span>:<span style=color:#2aa198>47</span> <span style=color:#cb4b16>PM</span>     <span style=color:#2aa198>211456</span> <span style=color:#cb4b16>updater.exe</span>
</span></span></code></pre></div><h2 id=31-the-bloated-hippo>3.1 The Bloated Hippo
<a class=header-link href=#31-the-bloated-hippo><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Let's open the application in dnSpy.</p><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/05-DecompiledAppManager.PNG title="Amazon SDK for .NET" alt="Amazon SDK for .NET">
<span class=caption-text>Amazon SDK for .NET</span></span><p>The application contains the <a href=https://aws.amazon.com/sdk-for-net/ target=_blank rel="noreferrer noopener">Amazon SDK for .NET</a>.</p><p>There are also other third party libraries:</p><ul><li>Newtonsoft Json</li><li>Bouncy Castle? The application does not use any kind of encryption whatsoever (not even HTTPs).</li><li>log4net</li><li>Exceptionless</li></ul><h2 id=32-searching-through-the-code>3.2 Searching through the Code
<a class=header-link href=#32-searching-through-the-code><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>There is a lot of dead code in the application. dnSpy supports searching through the assemblies but the application has so much dead code that the results will have a lot of noise. In order to discover interesting things, we need to only decompile and search in the application modules. They all conveniently start with <code>FileHippo</code>.</p><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/06-FileHippoComponents.PNG title="FileHippo components" alt="FileHippo components">
<span class=caption-text>FileHippo components</span></span><p>Select the application and then <code>File > Export to Project</code> to create a Visual Studio project using the decompiled code. But this contains all of the 3rd party libraries. The directory that we need is <code>\decompiled-project\FileHippo.AppManager\FileHippo</code> which contains two directories:</p><ul><li>AppManager</li><li>Shared</li></ul><p>Everything else can be safely ignored and now we can <code>grep</code> through the code with less noise.</p><h2 id=33-the-accesstoken-header>3.3 The AccessToken Header
<a class=header-link href=#33-the-accesstoken-header><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>We saw the <code>AccessToken</code> header and we did not see it coming from the server. Now we can look at decompiled code and find out how it is created. Let's search for <code>AccessToken</code> in the decompiled code.</p><figure class=code><figcaption><span>grep -ir "accesstoken"</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#268bd2>$</span> <span style=color:#cb4b16>grep</span> -<span style=color:#cb4b16>ir</span> &#34;<span style=color:#cb4b16>accesstoken</span>&#34;
</span></span><span style=display:flex><span><span style=color:#268bd2>AppManager</span>/<span style=color:#cb4b16>Core</span>/<span style=color:#cb4b16>Authentication</span>/<span style=color:#cb4b16>AuthenticationProvider.cs</span>:   <span style=color:#cb4b16>public</span> <span style=color:#cb4b16>bool</span> <span style=color:#cb4b16>Authenticate</span>(<span style=color:#cb4b16>string</span> <span style=color:#cb4b16>accessToken</span>, <span style=color:#cb4b16>string</span> <span style=color:#cb4b16>clientId</span>, <span style=color:#cb4b16>string</span> <span style=color:#cb4b16>requestTime</span>)
</span></span><span style=display:flex><span><span style=color:#268bd2>AppManager</span>/<span style=color:#cb4b16>Core</span>/<span style=color:#cb4b16>Authentication</span>/<span style=color:#cb4b16>AuthenticationProvider.cs</span>:   <span style=color:#cb4b16>string</span> <span style=color:#cb4b16>text</span> = <span style=color:#cb4b16>this.Encrypter.DecryptString</span>(<span style=color:#cb4b16>accessToken</span>)<span style=color:#586e75>;
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#268bd2>AppManager</span>/<span style=color:#cb4b16>Core</span>/<span style=color:#cb4b16>Authentication</span>/<span style=color:#cb4b16>AuthenticationProvider.cs</span>:   <span style=color:#cb4b16>public</span> <span style=color:#cb4b16>string</span> <span style=color:#cb4b16>GenerateAccessToken</span>(<span style=color:#cb4b16>string</span> <span style=color:#cb4b16>clientId</span>, <span style=color:#cb4b16>DateTime</span> <span style=color:#cb4b16>requestTime</span>)
</span></span><span style=display:flex><span><span style=color:#268bd2>AppManager</span>/<span style=color:#cb4b16>Core</span>/<span style=color:#cb4b16>Authentication</span>/<span style=color:#cb4b16>IAuthenticationProvider.cs</span>:  <span style=color:#cb4b16>bool</span> <span style=color:#cb4b16>Authenticate</span>(<span style=color:#cb4b16>string</span> <span style=color:#cb4b16>accessToken</span>, <span style=color:#cb4b16>string</span> <span style=color:#cb4b16>clientId</span>, <span style=color:#cb4b16>string</span> <span style=color:#cb4b16>requestTime</span>)<span style=color:#586e75>;
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#268bd2>AppManager</span>/<span style=color:#cb4b16>Core</span>/<span style=color:#cb4b16>Authentication</span>/<span style=color:#cb4b16>IAuthenticationProvider.cs</span>:  <span style=color:#cb4b16>string</span> <span style=color:#cb4b16>GenerateAccessToken</span>(<span style=color:#cb4b16>string</span> <span style=color:#cb4b16>clientId</span>, <span style=color:#cb4b16>DateTime</span> <span style=color:#cb4b16>requestTime</span>)<span style=color:#586e75>;
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#268bd2>AppManager</span>/<span style=color:#cb4b16>Core</span>/<span style=color:#cb4b16>WebClient</span>/<span style=color:#cb4b16>v1</span>/<span style=color:#cb4b16>Client.cs</span>:                     <span style=color:#cb4b16>string</span> <span style=color:#cb4b16>value</span> = <span style=color:#cb4b16>this._authenticationProvider.GenerateAccessToken</span>(<span style=color:#cb4b16>this.ClientId</span>, <span style=color:#cb4b16>requestTime</span>)<span style=color:#586e75>;
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#268bd2>AppManager</span>/<span style=color:#cb4b16>Core</span>/<span style=color:#cb4b16>WebClient</span>/<span style=color:#cb4b16>v1</span>/<span style=color:#cb4b16>Client.cs</span>:                     <span style=color:#cb4b16>headers.Add</span>(&#34;<span style=color:#cb4b16>AccessToken</span>&#34;, <span style=color:#cb4b16>value</span>);<span style=color:#cb4b16>_</span></span></span></code></pre></td></tr></table></div></div></div></figure><p>Look at line four. There is a function named <code>GenerateAccessToken</code> in <code>FileHippo.AppManager.Core.Authentication.AuthenticationProvider</code>. We can see the function code here:</p><figure class=code><figcaption><span>GenerateAccessToken(string clientId, DateTime requestTime)</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#586e75>// FileHippo.AppManager.Core.Authentication.AuthenticationProvider</span>
</span></span><span style=display:flex><span><span style=color:#586e75>// Token: 0x0600DE83 RID: 56963 RVA: 0x002073FC File Offset: 0x002055FC</span>
</span></span><span style=display:flex><span><span style=color:#719e07>public</span> <span style=color:#dc322f>string</span> GenerateAccessToken(<span style=color:#dc322f>string</span> clientId, DateTime requestTime)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#719e07>this</span>.Encrypter.Key = Encoding.UTF8.GetBytes(<span style=color:#719e07>this</span>.GetEncryptionKey());
</span></span><span style=display:flex><span>	<span style=color:#dc322f>int</span> count = <span style=color:#719e07>this</span>.Encrypter.BlockSize / <span style=color:#2aa198>8</span>;
</span></span><span style=display:flex><span>	<span style=color:#719e07>this</span>.Encrypter.IV = Encoding.UTF8.GetBytes(requestTime.ToString(<span style=color:#2aa198>&#34;T&#34;</span>, CultureInfo.InvariantCulture)).Take(count).ToArray&lt;<span style=color:#dc322f>byte</span>&gt;();
</span></span><span style=display:flex><span>	<span style=color:#719e07>return</span> <span style=color:#719e07>this</span>.Encrypter.EncryptString(clientId);
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></div></figure><p>It looks like that the application encrypts the <code>clientId</code> uses the current time. Using the current time in the token was the reason for the access tokens being invalidated after a while.</p><h3 id=331-the-encryption-scheme>3.3.1 The Encryption Scheme
<a class=header-link href=#331-the-encryption-scheme><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Put a breakpoint on the return line of <code>GenerateAccessToken</code> function and run the application from inside dnSpy. Remember to close the previous instance of the application which may be in the Windows tray.</p><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/07-EncrypterInformation.PNG title="Encrypter information" alt="Encrypter information">
<span class=caption-text>Encrypter information</span></span><p>We see <code>3DES</code>, a 0x18 byte (24 byte or 192 bit) key and an 8 byte IV.</p><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/08-IV.PNG title=IV alt=IV>
<span class=caption-text>IV</span></span><p>IV is <code>30 31 3A 31 35 3A 30 32</code> which is <code>01:15:32</code> in hex (quick hint: <code>0x3n</code> is ASCII-Hex for number <code>n</code>). This looks like time and the answer is right in front of our eyes in the previous screenshot. Look at the <code>requestTime</code>. Line number 7 generates the IV.</p><p>And we can see the key too which is <code>00020206040A060E08120A160C1A0E1E10221226142A162E</code> in hex.</p><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/09-Key.PNG title=Key alt=Key>
<span class=caption-text>Key</span></span><p>The key is different from the IV, because it is the result of a function call. Later during static analysis we will see how the key is generated. For now, we want to see if it is hardcoded or no. Stop the application and run it again and look at the value of the key. It has not changed.</p><p>Now let's <code>step into</code> the function.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#586e75>// Token: 0x0600DD04 RID: 56580 RVA: 0x00202858 File Offset: 0x00200A58</span>
</span></span><span style=display:flex><span><span style=color:#719e07>public</span> <span style=color:#dc322f>string</span> EncryptString(<span style=color:#dc322f>string</span> text)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> Convert.ToBase64String(<span style=color:#719e07>this</span>.Encrypt(Encoding.UTF8.GetBytes(text))); &lt;-- we are here
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Which counts for the base64 encoding. Another step and we land in:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#586e75>// Token: 0x0600DD02 RID: 56578 RVA: 0x002027E8 File Offset: 0x002009E8</span>
</span></span><span style=display:flex><span><span style=color:#719e07>public</span> <span style=color:#dc322f>byte</span>[] Encrypt(<span style=color:#dc322f>byte</span>[] data)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> <span style=color:#719e07>this</span>.Encrypt(data, data.Length); &lt;-- we are here
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And finally.</p><figure class=code><figcaption><span>Encrypt</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#586e75>// Token: 0x0600DD03 RID: 56579 RVA: 0x002027F4 File Offset: 0x002009F4</span>
</span></span><span style=display:flex><span><span style=color:#719e07>public</span> <span style=color:#dc322f>byte</span>[] Encrypt(<span style=color:#dc322f>byte</span>[] data, <span style=color:#dc322f>int</span> length)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  MemoryStream memoryStream = <span style=color:#719e07>new</span> MemoryStream(); &lt;-- we are here
</span></span><span style=display:flex><span>  CryptoStream cryptoStream = <span style=color:#719e07>new</span> CryptoStream(memoryStream, <span style=color:#719e07>this</span>._algorithm.CreateEncryptor(<span style=color:#719e07>this</span>._algorithm.Key, <span style=color:#719e07>this</span>._algorithm.IV), CryptoStreamMode.Write);
</span></span><span style=display:flex><span>  cryptoStream.Write(data, <span style=color:#2aa198>0</span>, length);
</span></span><span style=display:flex><span>  cryptoStream.FlushFinalBlock();
</span></span><span style=display:flex><span>  <span style=color:#dc322f>byte</span>[] result = memoryStream.ToArray();
</span></span><span style=display:flex><span>  cryptoStream.Close();
</span></span><span style=display:flex><span>  memoryStream.Close();
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> result;
</span></span><span style=display:flex><span>}_</span></span></code></pre></td></tr></table></div></div></div></figure><p>So <code>AccessToken</code> is <code>ClientId</code> encrypted using <code>3DES</code> with IV being the current time <code>hour:minute:second</code> and a hardcoded key.</p><h3 id=332-key-generation>3.3.2 Key Generation
<a class=header-link href=#332-key-generation><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Let's go back and look at how the encryption key is generated. Just clicking the <code>GetEncryptionKey</code> function in dnSpy shows us the decompiled code:</p><figure class=code><figcaption><span>GetEncryptionKey</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#586e75>// Token: 0x0600DE84 RID: 56964 RVA: 0x00207474 File Offset: 0x00205674</span>
</span></span><span style=display:flex><span><span style=color:#719e07>private</span> <span style=color:#dc322f>string</span> GetEncryptionKey()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  StringBuilder stringBuilder = <span style=color:#719e07>new</span> StringBuilder();
</span></span><span style=display:flex><span>  <span style=color:#719e07>for</span> (<span style=color:#dc322f>int</span> i = <span style=color:#2aa198>0</span>; i &lt; <span style=color:#2aa198>24</span>; i++)
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    stringBuilder.Append(<span style=color:#dc322f>char</span>.ConvertFromUtf32((i % <span style=color:#2aa198>2</span> == <span style=color:#2aa198>0</span>) ? i : (i * <span style=color:#2aa198>2</span>)));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> stringBuilder.ToString();
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></div></figure><p>This looks pretty easy to reverse and is the same as the following Python code.</p><figure class=code><figcaption><span>Encryption Key</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Python data-lang=Python><span style=display:flex><span>key <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#719e07>for</span> i <span style=color:#719e07>in</span> xrange(<span style=color:#2aa198>0</span>,<span style=color:#2aa198>24</span>):
</span></span><span style=display:flex><span>  <span style=color:#719e07>if</span> (i <span style=color:#719e07>%</span> <span style=color:#2aa198>2</span> <span style=color:#719e07>==</span> <span style=color:#2aa198>0</span>):
</span></span><span style=display:flex><span>    key <span style=color:#719e07>+=</span> <span style=color:#2aa198>&#34;</span><span style=color:#2aa198>%0.2X</span><span style=color:#2aa198>&#34;</span> <span style=color:#719e07>%</span> i
</span></span><span style=display:flex><span>  <span style=color:#719e07>else</span>:
</span></span><span style=display:flex><span>    key <span style=color:#719e07>+=</span> <span style=color:#2aa198>&#34;</span><span style=color:#2aa198>%0.2X</span><span style=color:#2aa198>&#34;</span> <span style=color:#719e07>%</span> (i<span style=color:#719e07>*</span><span style=color:#2aa198>2</span>)
</span></span><span style=display:flex><span><span style=color:#b58900>print</span> key</span></span></code></pre></td></tr></table></div></div></div></figure><p>Which returns the same key: <code>00020206040A060E08120A160C1A0E1E10221226142A162E</code>.</p><h2 id=34-the-abandoned-s3-keys>3.4 The Abandoned S3 Keys
<a class=header-link href=#34-the-abandoned-s3-keys><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>As I mentioned before, the application has the Amazon SDK. I usually grep for certain keywords in decompiled code. Keywords such as <code>username</code>, <code>password</code>, <code>encryption</code>, <code>decryption</code> and <code>secret</code>.</p><p>So what happened when I searched for <code>secret</code> in application code?</p><figure class=code><figcaption><span>grep -it "secret"</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#268bd2>$</span> <span style=color:#cb4b16>grep</span> -<span style=color:#cb4b16>ir</span> &#34;<span style=color:#cb4b16>secret</span>&#34;
</span></span><span style=display:flex><span>.../<span style=color:#cb4b16>AmazonS3ContentPublishingService.cs</span>: <span style=color:#cb4b16>protected</span> <span style=color:#cb4b16>virtual</span> <span style=color:#cb4b16>string</span> <span style=color:#cb4b16>GetSecretKey</span>()
</span></span><span style=display:flex><span>.../<span style=color:#cb4b16>AmazonS3ContentPublishingService.cs</span>: <span style=color:#cb4b16>return</span> <span style=color:#cb4b16>this.AmazonS3SecretKey</span><span style=color:#586e75>;
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>.../<span style=color:#cb4b16>AmazonS3ContentPublishingService.cs</span>: <span style=color:#cb4b16>using</span> (<span style=color:#cb4b16>AmazonS3</span> <span style=color:#cb4b16>amazonS</span> = <span style=color:#cb4b16>AWSClientFactory.CreateAmazonS3Client</span>(<span style=color:#cb4b16>this.GetAccessKey</span>(), <span style=color:#cb4b16>this.GetSecretKey</span>()))
</span></span><span style=display:flex><span>.../<span style=color:#cb4b16>AmazonS3ContentPublishingService.cs</span>: <span style=color:#cb4b16>private</span> <span style=color:#cb4b16>readonly</span> <span style=color:#cb4b16>string</span> <span style=color:#cb4b16>AmazonS3SecretKey</span> = <span style=color:#2aa198>&#34;B6nB5T9d1CHGL4YrU5zCuySf65Js7fsi2cNhQh1B&#34;</span>;</span></span></code></pre></td></tr></table></div></div></div></figure><p><code>AmazonS3SecretKey</code> in the last line. Oh wow. Looking at the decompiled code for <code>AmazonS3ContentPublishingService.cs</code> we can see:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#586e75>// Token: 0x04003423 RID: 13347</span>
</span></span><span style=display:flex><span><span style=color:#719e07>private</span> <span style=color:#719e07>readonly</span> <span style=color:#dc322f>string</span> AmazonS3AccessKey = <span style=color:#2aa198>&#34;AKIAJYWNSWLQDSSXG3FA&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75>// Token: 0x04003425 RID: 13349</span>
</span></span><span style=display:flex><span><span style=color:#719e07>private</span> <span style=color:#719e07>readonly</span> <span style=color:#dc322f>string</span> AmazonS3BucketName = <span style=color:#2aa198>&#34;cache.filehippo.com&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75>// Token: 0x04003424 RID: 13348</span>
</span></span><span style=display:flex><span><span style=color:#719e07>private</span> <span style=color:#719e07>readonly</span> <span style=color:#dc322f>string</span> AmazonS3SecretKey = <span style=color:#2aa198>&#34;B6nB5T9d1CHGL4YrU5zCuySf65Js7fsi2cNhQh1B&#34;</span>;
</span></span></code></pre></div><p>A little bit further up we have:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#586e75>// Token: 0x0600E4D3 RID: 58579 RVA: 0x00211474 File Offset: 0x0020F674</span>
</span></span><span style=display:flex><span><span style=color:#719e07>protected</span> <span style=color:#719e07>virtual</span> <span style=color:#dc322f>string</span> GetBucketURL()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> <span style=color:#2aa198>&#34;http://cache.filehippo.com&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>But what is at <a href=http://cache.filehippo.com target=_blank rel="noreferrer noopener">http://cache.filehippo.com</a>?</p><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/11-cache.filehippo.com.PNG title=http://cache.filehippo.com alt=http://cache.filehippo.com>
<span class=caption-text>http://cache.filehippo.com</span></span><p>Assuming these keys are valid, they can be used to modify the website and possibly put backdoored versions of the File Hippo App Manager application.</p><h3 id=341-checking-the-validity-of-the-key-pair-without-going-to-jail>3.4.1 Checking the Validity of the Key Pair without Going to Jail
<a class=header-link href=#341-checking-the-validity-of-the-key-pair-without-going-to-jail><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>I wanted to find a non-intrusive way of checking the validity of these keys. So I asked one of my colleagues about it.</p><p>We can use the AWS CLI application to get the bucket policy like <a href=https://docs.aws.amazon.com/cli/latest/reference/s3api/get-bucket-policy.html target=_blank rel="noreferrer noopener">this</a>:
<code>aws s3api get-bucket-policy --bucket my-bucket</code>.</p><p>Fortunately (for both me and FileHippo.com) the result was <code>AccessDenied</code>. Meaning that the keys are not valid for that bucket.</p><p>However they may be valid for other buckets (or have access to other AWS services). We can get the list of buckets that are associated with a key pair like <a href=https://docs.aws.amazon.com/cli/latest/reference/s3api/list-buckets.html target=_blank rel="noreferrer noopener">this</a>: <code>aws s3api list-buckets --query 'Buckets[].Name'</code>.</p><p>Again this resulted in an <code>AccessDenied</code> message.</p><h2 id=35-the-update-process>3.5 The Update Process
<a class=header-link href=#35-the-update-process><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>We have already seen part of the update process. The download is pulled over HTTP and then executed. There's not much to look at that part. But many times applications/services running binaries (or starting processes) are the main vector to a sweet RCE or local privilege escalation. For example if you can make the service (typically run as SYSTEM) execute your binary you can make yourself admin already. We probably will not find anything here but it is good practice to go ahead and look at the update process especially because we have the decompiled code.</p><p>First we need to find a way to discover where the installer is executed. We have the decompiled code, so we can grep for keywords. Grep for <code>execute</code> returns this.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#268bd2>$</span> <span style=color:#cb4b16>grep</span> -<span style=color:#cb4b16>ir</span> &#34;<span style=color:#cb4b16>execute</span>&#34;
</span></span><span style=display:flex><span><span style=color:#268bd2>AppManager</span>/<span style=color:#cb4b16>Core</span>/<span style=color:#cb4b16>UpdateProgram.cs</span>:  <span style=color:#cb4b16>public</span> <span style=color:#cb4b16>void</span> <span style=color:#cb4b16>ExecuteInstaller</span>(<span style=color:#cb4b16>string</span> <span style=color:#cb4b16>installerFilePath</span>, <span style=color:#cb4b16>Guid</span> <span style=color:#cb4b16>requester</span>)
</span></span><span style=display:flex><span><span style=color:#268bd2>AppManager</span>/<span style=color:#cb4b16>Core</span>/<span style=color:#cb4b16>UpdateProgram.cs</span>:  <span style=color:#cb4b16>public</span> <span style=color:#cb4b16>void</span> <span style=color:#cb4b16>ExecuteInstallerAsync</span>(<span style=color:#cb4b16>string</span> <span style=color:#cb4b16>installerFilePath</span>, <span style=color:#cb4b16>Guid</span> <span style=color:#cb4b16>requester</span>)
</span></span><span style=display:flex><span><span style=color:#268bd2>AppManager</span>/<span style=color:#cb4b16>Core</span>/<span style=color:#cb4b16>UpdateProgram.cs</span>:  <span style=color:#cb4b16>this.ExecuteInstaller</span>(<span style=color:#cb4b16>installerFilePath</span>, <span style=color:#cb4b16>requester</span>)<span style=color:#586e75>;
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#268bd2>AppManager</span>/<span style=color:#cb4b16>ProgramItemControl.Designer.cs</span>:  <span style=color:#cb4b16>this.updateProgram.ExecuteInstallerAsync</span>(<span style=color:#cb4b16>this._downloadFilePath</span>, <span style=color:#cb4b16>Guid.NewGuid</span>())<span style=color:#586e75>;
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#268bd2>AppManager</span>/<span style=color:#cb4b16>ProgramItemControl.Designer.cs</span>:  <span style=color:#cb4b16>this.updateProgram.ExecuteInstallerAsync</span>(<span style=color:#cb4b16>e.AdditionalData</span>, <span style=color:#cb4b16>Guid.NewGuid</span>())<span style=color:#586e75>;
</span></span></span></code></pre></div><p><code>ExecuteInstaller</code> executes the update like this.</p><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/12-ExecueInstallerCode.PNG title="ExecuteInstaller code" alt="ExecuteInstaller code">
<span class=caption-text>ExecuteInstaller code</span></span><p>By analyzing (right click <code>Analyze</code>) the <code>ExecuteInstaller</code> function we will see where it is called.</p><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/13-ExecuteInstallerAnalysis.PNG title="ExecuteInstaller analysis" alt="ExecuteInstaller analysis">
<span class=caption-text>ExecuteInstaller analysis</span></span><p>To see if this is actually the case, we can go back inside <code>ExecuteInstaller</code> and set a breakpoint at the start of the function and then run the application via dnSpy.</p><p>When we land in the function after the breakpoint is hit, we can see how we got here by using <code>Debug (menu) > Call Stack</code> and the culprit for running thee installer is the following line:</p><figure class=code><figcaption><span>Running the installer</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>Process process = Process.Start(installerFilePath);</span></span></code></pre></td></tr></table></div></div></div></figure><p>So next time you are looking at a .NET application to determine how it executes external binaries one of the things we search for is <code>Process.Start</code>.</p><h2 id=36-debug-and-background-modes>3.6 Debug and Background Modes
<a class=header-link href=#36-debug-and-background-modes><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>While looking at the application I saw references to a <code>Debug Mode</code>. After I grepped for <code>debug</code> I saw the following lines (among other things):</p><figure class=code><figcaption><span>grep -ir "debug"</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>AppManager/MainForm.cs:                         <span style=color:#719e07>if</span> (text2.ToLower() == <span style=color:#2aa198>&#34;/debug&#34;</span>)
</span></span><span style=display:flex><span>AppManager/MainForm.cs:                                 ApplicationManager.DebugMode = <span style=color:#719e07>true</span>;
</span></span><span style=display:flex><span>AppManager/MainForm.cs:                 <span style=color:#719e07>this</span>.SetDebugLabelVisibility();
</span></span><span style=display:flex><span>AppManager/MainForm.cs:                         ApplicationManager.DebugMode = !ApplicationManager.DebugMode;
</span></span><span style=display:flex><span>AppManager/MainForm.cs:                         <span style=color:#719e07>this</span>.SetDebugLabelVisibility();
</span></span><span style=display:flex><span>AppManager/MainForm.cs:         <span style=color:#719e07>private</span> <span style=color:#719e07>void</span> SetDebugLabelVisibility()
</span></span><span style=display:flex><span>AppManager/MainForm.Designer.cs:                        <span style=color:#719e07>this</span>.debugModeLabel.Text = <span style=color:#2aa198>&#34;Application is in DEBUG mode&#34;</span>;</span></span></code></pre></td></tr></table></div></div></div></figure><p>The application has a debug mode when run with the <code>/debug</code> switch. If we go to <code>FileHippo.AppManager.MainForm</code> and look at the <code>MainForm_Load</code> function we will the first line in the grep results above.</p><figure class=code><figcaption><span>MainForm_Load</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#719e07>private</span> <span style=color:#719e07>void</span> MainForm_Load(<span style=color:#dc322f>object</span> sender, EventArgs e)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  <span style=color:#dc322f>bool</span> flag = <span style=color:#719e07>false</span>;
</span></span><span style=display:flex><span>  <span style=color:#dc322f>string</span>[] commandLineArgs = Environment.GetCommandLineArgs();
</span></span><span style=display:flex><span>  <span style=color:#dc322f>string</span>[] array2 = commandLineArgs;
</span></span><span style=display:flex><span>  <span style=color:#719e07>for</span> (<span style=color:#dc322f>int</span> i = <span style=color:#2aa198>0</span>; i &lt; array2.Length; i++)
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#dc322f>string</span> text = array2[i];
</span></span><span style=display:flex><span>    <span style=color:#dc322f>string</span> text2 = text;
</span></span><span style=display:flex><span>    <span style=color:#719e07>if</span> (text2.ToLower() == <span style=color:#2aa198>&#34;/debug&#34;</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      ApplicationManager.DebugMode = <span style=color:#719e07>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#719e07>else</span> <span style=color:#719e07>if</span> (text2.ToLower() == <span style=color:#2aa198>&#34;/background&#34;</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      flag = <span style=color:#719e07>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#719e07>if</span> (flag)
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#719e07>this</span>.MinimizeToTray();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#719e07>this</span>.SetDebugLabelVisibility();
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></div></figure><p><code>/background</code> switch just minimizes the app to Windows tray and does nothing interesting. While <code>/debug</code> sets <code>ApplicationManager.DebugMode</code> to true and runs <code>this.SetDebugLabelVisibility();</code>.</p><h3 id=361-activating-the-debug-mode>3.6.1 Activating the Debug Mode
<a class=header-link href=#361-activating-the-debug-mode><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>In order to see how the debug mode is activated we need to follow the <code>ApplicationManager.DebugMode</code> and see where it is set to <code>True</code>. Again we can use the excellent <code>Analyze</code> feature to see what accesses <code>ApplicationManager.DebugMode</code>. First we go for the <code>set</code> method to see if anything other than the command line switch activates the debug mode.</p><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/14-SetDebugModeAnalysis.PNG title="Where debug mode is set" alt="Where debug mode is set">
<span class=caption-text>Where debug mode is set</span></span><p>Interesting, apart from where we already where (<code>MainForm_Load</code>), there is another place that sets the debug mode which is <a href="https://msdn.microsoft.com/en-us/library/system.windows.forms.form.processcmdkey%28v=vs.110%29.aspx" target=_blank rel="noreferrer noopener">ProcessCmdKey</a>.</p><figure class=code><figcaption><span>ProcessCmdKey</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#719e07>protected</span> <span style=color:#719e07>override</span> <span style=color:#dc322f>bool</span> ProcessCmdKey(<span style=color:#719e07>ref</span> Message msg, Keys keyData)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#719e07>if</span> (keyData == (Keys)<span style=color:#2aa198>196676</span>)
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    ApplicationManager.DebugMode = !ApplicationManager.DebugMode;
</span></span><span style=display:flex><span>    <span style=color:#719e07>this</span>.SetDebugLabelVisibility();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> <span style=color:#719e07>base</span>.ProcessCmdKey(<span style=color:#719e07>ref</span> msg, keyData);
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></div></figure><p><code>ProcessCmdKey</code> processes pressed keys. The keys pressed are in <code>keyData</code>. Check line 3, the keys pressed are compared to the equivalent of keys with integer value of <code>196676</code>. By clicking the <code>(Keys)</code> we can see the enum in <code>System.Windows.Forms.dll > Keys</code>. However, this value is not present in that file which means it's a key combination.</p><h4 id=3611-using-linqpad-to-decipher-196676>3.6.1.1 Using LINQPad to Decipher 196676
<a class=header-link href=#3611-using-linqpad-to-decipher-196676><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h4><p>In order to discover the keys for <code>196676</code> we will use our old friend <a href=https://www.linqpad.net/Download.aspx target=_blank rel="noreferrer noopener">LINQPad</a> that we used in <a href=https://parsiya.net/blog/2015-11-14-intro-to-.net-remoting-for-hackers/#6-modifying-il-instructions-with-dnspy-and-patching-binaries title="Intro to .NET Remoting for Hackers">Intro to .NET Remoting for Hackers</a>.</p><ol><li>Change the <code>Language</code> drop-down list to <code>C# Statement</code>.</li><li>Right click and select <code>References and Properties</code> or press <code>F4</code>.</li><li>In the <code>References</code> tab click <code>Add</code> and search for <code>System.Windows.Forms.dll</code>.</li><li>Press <code>Add</code> and then <code>Ok</code>. Now it should be added.</li><li>Again press <code>Ok</code> to close this window.</li><li>Type the following code and press the green arrow button and voila.</li></ol><figure class=code><figcaption><span>Code entered in LINQPad</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>Keys nem = (Keys)<span style=color:#2aa198>196676</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Console.WriteLine(nem.ToString());</span></span></code></pre></td></tr></table></div></div></div></figure><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/15-SystemWindowsFormsAdded.PNG title="System.Windows.Forms added as reference" alt="System.Windows.Forms added as reference">
<span class=caption-text>System.Windows.Forms added as reference</span></span>
<span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/16-DebugShortcutDiscovered.PNG title="Debug shortcut is Ctrl+Shift+D" alt="Debug shortcut is Ctrl+Shift+D">
<span class=caption-text>Debug shortcut is Ctrl+Shift+D</span></span><p>Run the application and press <code>Ctrl+Shift+D</code> to see the anticlimactic debug mode in action. See the bottom right label <code>Application is in DEBUG mode</code>.</p><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/17-DebugModeinAction.gif title="Debug mode in action" alt="Debug mode in action">
<span class=caption-text>Debug mode in action</span></span><h3 id=362-what-does-the-debug-mode-do>3.6.2 What does the Debug Mode do?
<a class=header-link href=#362-what-does-the-debug-mode-do><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Go back to <code>MainForm_Load</code> and do <code>Analyze</code> on <code>ApplicationManager.DebugMode</code> but this time look at the <code>get</code> method. This time we want to see where this is accessed which means the places where the application checks if debug mode is active. Most likely application behavior changes after checking the <code>DebugMode</code>.</p><span class=caption-wrapper><img class=caption src=/images/2016/thickclient-5-filehippo/18-GetDebugMode.PNG title="Get debug mode functions" alt="Get debug mode functions">
<span class=caption-text>Get debug mode functions</span></span><p>We've already seen some of them such as <code>ProcessCmdKey</code>. I decided to pursue a few of the others.</p><h4 id=3621-scanner-debug-mode>3.6.2.1 Scanner Debug Mode
<a class=header-link href=#3621-scanner-debug-mode><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h4><p>First function is <code>FileHippo.AppManager.Core.UpdateChecker.CreateScanResultsRequest(...)</code> in which we see the following:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>Scanner scanner = <span style=color:#719e07>new</span> Scanner();
</span></span><span style=display:flex><span>scanner.ApplicationVersion = <span style=color:#719e07>this</span>.ApplicationVersion;
</span></span><span style=display:flex><span>scanner.CustomFolders = settings.CustomerFoldersRaw;
</span></span><span style=display:flex><span>scanner.DebugMode = ApplicationManager.DebugMode; &lt;-- scanner <span style=color:#719e07>set</span> to Debugmode
</span></span></code></pre></div><p>Again if we go after <code>scanner.DebugMode</code> with <code>Analyze</code> with its <code>get</code> method, we can see the scanner debug mode in <code>FileHippo.AppManager.Core.LegacyComponents.Scanner.DoScan(...)</code>:</p><figure class=code><figcaption><span>Scanner debug mode</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#719e07>this</span>.mCustomFolders.Add(text2);
</span></span><span style=display:flex><span><span style=color:#719e07>try</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#719e07>this</span>.mCustomFolders.AddRange(Directory.GetDirectories(text2, <span style=color:#2aa198>&#34;*.*&#34;</span>, SearchOption.AllDirectories));
</span></span><span style=display:flex><span>  <span style=color:#719e07>goto</span> IL_19F;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#719e07>catch</span> (UnauthorizedAccessException ex)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#719e07>if</span> (<span style=color:#719e07>this</span>.DebugMode)
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    Interaction.MsgBox(ex.Message, MsgBoxStyle.OkOnly, <span style=color:#719e07>null</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#719e07>goto</span> IL_19F;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#719e07>catch</span> (DirectoryNotFoundException ex2)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#719e07>if</span> (<span style=color:#719e07>this</span>.DebugMode)
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    Interaction.MsgBox(ex2.Message, MsgBoxStyle.OkOnly, <span style=color:#719e07>null</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#719e07>goto</span> IL_19F;
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></div></figure><p>It seems like if the scanner cannot access a directory in debug mode, the application displays a message box. Nothing special.</p><h4 id=3622-obsolete-debug-program-definitions>3.6.2.2 (Obsolete) Debug Program Definitions
<a class=header-link href=#3622-obsolete-debug-program-definitions><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h4><p>Next one is <code>FileHippo.AppManager.Core.UpdateChecker.DownloadProgramDefinitions()</code>. This one is also interesting. It is never called. If you do <code>Analyze > Used By</code>, the list is empty. If you set a breakpoint in the function and run the app in debug mode, the breakpoint is never triggered. It looks like that it should change the program definition URL if the app is in debug mode and the function is called:</p><figure class=code><figcaption><span>DownloadProgramDefinitions()</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#719e07>private</span> <span style=color:#dc322f>string</span> DownloadProgramDefinitions()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#dc322f>string</span> result;
</span></span><span style=display:flex><span>  <span style=color:#719e07>using</span> (WebClient webClient = <span style=color:#719e07>new</span> WebClient())
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#dc322f>string</span> address = ApplicationManager.DebugMode ? ApplicationManager.ProgramDefinitionURL_Debug : ApplicationManager.ProgramDefinitionURL;
</span></span><span style=display:flex><span>    <span style=color:#719e07>this</span>.ConfigureWebClient(webClient);
</span></span><span style=display:flex><span>    <span style=color:#dc322f>byte</span>[] bytes = webClient.DownloadData(address);
</span></span><span style=display:flex><span>    <span style=color:#dc322f>string</span> @string = Encoding.ASCII.GetString(bytes);
</span></span><span style=display:flex><span>    result = @string;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#719e07>return</span> result;
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></div></figure><p>Check line 6, if <code>DebugMode</code> is active, the program definition URL is modified. Those two values are set like this:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#719e07>public</span> <span style=color:#719e07>static</span> <span style=color:#dc322f>string</span> ProgramDefinitionURL
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#586e75>// Token: 0x0600DD73 RID: 56691 RVA: 0x00204A28 File Offset: 0x00202C28</span>
</span></span><span style=display:flex><span>  <span style=color:#719e07>get</span>
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#719e07>return</span> <span style=color:#dc322f>string</span>.Format(<span style=color:#2aa198>&#34;{0}/update/programs&#34;</span>, ApplicationManager.RootURL);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75>// Token: 0x17002562 RID: 9570</span>
</span></span><span style=display:flex><span><span style=color:#719e07>public</span> <span style=color:#719e07>static</span> <span style=color:#dc322f>string</span> ProgramDefinitionURL_Debug
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#586e75>// Token: 0x0600DD74 RID: 56692 RVA: 0x00204A3C File Offset: 0x00202C3C</span>
</span></span><span style=display:flex><span>  <span style=color:#719e07>get</span>
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#719e07>return</span> <span style=color:#dc322f>string</span>.Format(<span style=color:#2aa198>&#34;{0}/update/all_programs&#34;</span>, ApplicationManager.RootURL);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>However, none of them are called in the application. As we have seen in Burp the program definition URL is <code>/api/v1/ProgramDefinition</code>.</p><p>You can continue to see what the rest of the stuff do. But none of them are interesting or give us any secrets. Most just display message boxes if errors occur. One also enabled the debug label.</p><h1 id=4-conclusion>4. Conclusion
<a class=header-link href=#4-conclusion><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>It took me a while to find a suitable app. I like FileHippo and decided to use this application for analysis by accident. It turned out to be much more interesting that I had anticipated (I wanted to just use it for proxying). dnSpy allowed me to dig deeper and discover some interesting things. Hopefully this can help readers in analyzing managed code.</p><p>The AWS keys were another surprise. Fortunately the keys are invalid. I tried contacting World Known Media (owns FileHippo) and FileHippo both to report it but I got no answer. The keys are invalid to the best of my knowledge and have been accessible for a couple of years at least.</p><p>Thanks for reading and as usual if you have any questions/complaints/suggestions, you know where to find me.</p></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>Parsia</span></span>
<time>May 15, 2016</time>
<span class=categories>Tags:
<a class=category href=https://parsiya.net/tags/burp>Burp</a> <a class=category href=https://parsiya.net/tags/filehippo>FileHippo</a> <a class=category href=https://parsiya.net/tags/dnspy>dnSpy</a> <a class=category href=https://parsiya.net/tags/aws>AWS</a> <a class=category href=https://parsiya.net/tags/tutorial>Tutorial</a></span></p><p class=meta><a class="basic-alignment left" href=https://parsiya.net/blog/2016-05-09-looking-for-apps-to-proxy/ title="Looking for Apps to Proxy">Looking for Apps to Proxy</a>
<a class="basic-alignment right" href=https://parsiya.net/blog/2016-06-01-learning-go/ title="Learning Go">Learning Go</a></p><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//parsiya.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h1>Who am I?</h1><p><p>I am Parsia, an application security engineer.</p><p>I write about application security, cryptography, static analysis, and
(of course) videogames.</p><p>Click on <a href=/about/>About Me!</a> to know more.</p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank rel="me noopener noreferrer" href=https://infosec.exchange/@parsiya title=https://infosec.exchange/@parsiya><i class="fa fa-mastodon fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://github.com/parsiya/ title=https://github.com/parsiya/><i class="fa fa-github fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://twitter.com/cryptogangsta/ title=https://twitter.com/cryptogangsta/><i class="fa fa-twitter fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/in/parsiya title=https://www.linkedin.com/in/parsiya><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><h1>Collections</h1><li><a href=https://parsiya.net/categories/thick-client-proxying/ title="Thick Client Proxying">Thick Client Proxying</a></li><li><a href=https://parsiya.net/categories/writeup/ title=CTFs/Writeups>CTFs/Writeups</a></li><li><a href=https://parsiya.net/categories/attack-surface-analysis/ title="Attack Surface Analysis">Attack Surface Analysis</a></li><li><a href=https://parsiya.net/categories/bug-bounty/ title="Bug Bounty">Bug Bounty</a></li><li><a href=https://parsiya.net/categories/go/ title=Go/Golang>Go/Golang</a></li><li><a href=https://parsiya.net/categories/blockchain/ title=Blockchain>Blockchain</a></li><li><a href=https://parsiya.net/categories/burp-extension/ title="Burp Extension Development">Burp Extension Development</a></li><li><a href=https://parsiya.net/categories/automation/ title=Automation>Automation</a></li><li><a href=https://parsiya.net/categories/reverse-engineering/ title="Reverse Engineering">Reverse Engineering</a></li><li><a href=https://parsiya.net/categories/crypto/ title=Crypto(graphy)>Crypto(graphy)</a></li><li><a href=https://parsiya.net/categories/winappdbg/ title=WinAppDbg>WinAppDbg</a></li><li><a href=https://awsome.pw title="AWSome.pw - S3 bucket squatting - my very legit branded vulnerability">AWSome.pw - S3 bucket squatting - my very legit branded vulnerability</a></li></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2023 Parsia - <a href=https://parsiya.net/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>