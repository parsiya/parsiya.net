<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>Decoding Large Base64 Files with Go</title>
<link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://parsiya.net/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Parsia Hakimian Parsiya infosec information security]"><meta name=author content="Parsia"><meta name=generator content="Hugo 0.124.0"><meta name=twitter:card content="summary"><meta name=twitter:title content="Decoding Large Base64 Files with Go"><meta name=twitter:description content="I am working on this challenge and it has a large base64 file. Each line has 2 characters and it has 150+ million lines.
Luckily we can use the Base64 stream decoder. It reads from an io.Reader and returns one that can be copied into an io.Writer. It also takes care of the new lines.
Sample code is at:

https://github.com/parsiya/Go-Security/blob/master/base64-stream-decoder/b64-stream-decoder.go.
"><meta name=twitter:domain content="parsiya.net"><meta name=twitter:creator content="@CryptoGangsta"></head><body><header role=banner><hgroup><h1><a href=https://parsiya.net/>Hackerman's Hacking Tutorials</a></h1><h2>The knowledge of anything, since all things have causes, is not acquired or
complete unless it is known by its causes. - Avicenna</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://parsiya.net/about/>» About Me!</option><option value=https://parsiya.net/cheatsheet/>» Cheat Sheet</option><option value=https://parsiya.io/>» My Clone</option><option value=https://github.com/parsiya/parsiya.net>» Source Repo</option><option value="https://queue.acm.org/detail.cfm?id=3197520">» Manual Work is a Bug</option><option value="https://www.google.com/search?q=andrew+ridgeley">» The Other Guy from Wham!</option></select></fieldset><ul class=main-navigation><li><a href=https://parsiya.net/about/ title="About Me!" target=_blank rel="noopener noreferrer">About Me!</a></li><li><a href=https://parsiya.net/cheatsheet/ title="Cheat Sheet" target=_blank rel="noopener noreferrer">Cheat Sheet</a></li><li><a href=https://parsiya.io/ title="My Clone" target=_blank rel="noopener noreferrer">My Clone</a></li><li><a href=https://github.com/parsiya/parsiya.net title="Source Repo" target=_blank rel="noopener noreferrer">Source Repo</a></li><li><a href="https://queue.acm.org/detail.cfm?id=3197520" title="Manual Work is a Bug" target=_blank rel="noopener noreferrer">Manual Work is a Bug</a></li><li><a href="https://www.google.com/search?q=andrew+ridgeley" title="The Other Guy from Wham!" target=_blank rel="noopener noreferrer">The Other Guy from Wham!</a></li></ul><ul class=subscription><a href=https://parsiya.net/index.xml target=_blank type=application/rss+xml title=RSS rel="noopener noreferrer"><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://parsiya.net/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>Jan 19, 2018
- 3 minute read
- <a href=https://parsiya.net/blog/2018-01-19-decoding-large-base64-files-with-go/#disqus_thread>Comments</a>
- <a class=label href=https://parsiya.net/categories/go/>Go</a></p><h1 class=entry-title>Decoding Large Base64 Files with Go</h1></header><div class=entry-content><p>I am working on this challenge and it has a large base64 file. Each line has 2 characters and it has 150+ million lines.</p><p>Luckily we can use the <a href=https://golang.org/pkg/encoding/base64/#NewDecoder target=_blank rel="noreferrer noopener">Base64 stream decoder</a>. It reads from an <code>io.Reader</code> and returns one that can be copied into an <code>io.Writer</code>. It also takes care of the new lines.</p><p>Sample code is at:</p><ul><li><a href=https://github.com/parsiya/Go-Security/blob/master/base64-stream-decoder/b64-stream-decoder.go target=_blank rel="noreferrer noopener">https://github.com/parsiya/Go-Security/blob/master/base64-stream-decoder/b64-stream-decoder.go</a>.</li></ul><p>This code will accept a base64 encoded file (whitespace does not matter) with <code>-file/--file</code> and store the decoded bytes in <code>filename-out</code>:</p><figure class=code><figcaption><span>Base64 stream decoder</span></figcaption><div class=codewrapper><div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">45
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#586e75>// Example to demonstrate base64 stream decoder on large files.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#719e07>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#2aa198>&#34;encoding/base64&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#2aa198>&#34;flag&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#2aa198>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#2aa198>&#34;io&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#2aa198>&#34;os&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#586e75>// This creates a flag parameter. Meaning we can call -file or --file.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#268bd2>var</span> filename <span style=color:#dc322f>string</span>
</span></span><span style=display:flex><span>    flag.<span style=color:#268bd2>StringVar</span>(<span style=color:#719e07>&amp;</span>filename, <span style=color:#2aa198>&#34;file&#34;</span>, <span style=color:#2aa198>&#34;&#34;</span>, <span style=color:#2aa198>&#34;input file&#34;</span>)
</span></span><span style=display:flex><span>    flag.<span style=color:#268bd2>Parse</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fmt.<span style=color:#268bd2>Println</span>(<span style=color:#2aa198>&#34;reading input file, this may take a while&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Open input file
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    input, err <span style=color:#719e07>:=</span> os.<span style=color:#268bd2>Open</span>(filename)
</span></span><span style=display:flex><span>    <span style=color:#586e75>// We are panic-ing with every error because we want to stop if things
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#586e75>// go wrong.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#719e07>if</span> err <span style=color:#719e07>!=</span> <span style=color:#cb4b16>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#b58900>panic</span>(err)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Close input file
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#719e07>defer</span> input.<span style=color:#268bd2>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Open output file
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    output, err <span style=color:#719e07>:=</span> os.<span style=color:#268bd2>Create</span>(filename <span style=color:#719e07>+</span> <span style=color:#2aa198>&#34;-out&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#719e07>if</span> err <span style=color:#719e07>!=</span> <span style=color:#cb4b16>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#b58900>panic</span>(err)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Close output file
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#719e07>defer</span> output.<span style=color:#268bd2>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Create base64 stream decoder from input file. *io.File implements the
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    <span style=color:#586e75>// io.Reader interface. In other words we can pass it to NewDecoder.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    decoder <span style=color:#719e07>:=</span> base64.<span style=color:#268bd2>NewDecoder</span>(base64.StdEncoding, input)
</span></span><span style=display:flex><span>    <span style=color:#586e75>// Magic! Copy from base64 decoder to output file
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    io.<span style=color:#268bd2>Copy</span>(output, decoder)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fmt.<span style=color:#268bd2>Println</span>(<span style=color:#2aa198>&#34;storing base64 decoder input file&#34;</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></div></figure><p>Two interesting things:</p><ol><li>The file handle is of type <code>*io.File</code> that implements <code>io.Reader</code>, meaning we can pass it to any function that can use one.</li><li>Because the output of decoder is also <code>io.Reader</code>, we can use <code>io.Copy</code> to copy it to the output file directly.</li></ol><p>The code is pretty simple, we open the input file and the output file, pass the input file to the base64 stream decoder and copy its output to the output file and we're done.</p><p>Now this code is pretty fast and simple. For example our input file of 150+ million lines was decoded and written to disk in less then three seconds (<a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-powershell-1.0/ee176899%28v=technet.10%29" target=_blank rel="noreferrer noopener">Measure-Command</a> == <code>time</code>):</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>PS&gt; <span style=color:#b58900>Measure-Command</span>{go run .\<span style=color:#b58900>base64streamdecoder-example</span>.go <span style=color:#719e07>-file</span> base64file}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Days              : <span style=color:#2aa198>0</span>
</span></span><span style=display:flex><span>Hours             : <span style=color:#2aa198>0</span>
</span></span><span style=display:flex><span>Minutes           : <span style=color:#2aa198>0</span>
</span></span><span style=display:flex><span>Seconds           : <span style=color:#2aa198>2</span>
</span></span><span style=display:flex><span>Milliseconds      : <span style=color:#2aa198>960</span>
</span></span><span style=display:flex><span>Ticks             : <span style=color:#2aa198>29604607</span>
</span></span><span style=display:flex><span>TotalDays         : <span style=color:#2aa198>3</span>.42645914351852E-<span style=color:#2aa198>05</span>
</span></span><span style=display:flex><span>TotalHours        : <span style=color:#2aa198>0.000822350194444444</span>
</span></span><span style=display:flex><span>TotalMinutes      : <span style=color:#2aa198>0.0493410116666667</span>
</span></span><span style=display:flex><span>TotalSeconds      : <span style=color:#2aa198>2.9604607</span>
</span></span><span style=display:flex><span>TotalMilliseconds : <span style=color:#2aa198>2960.4607</span>
</span></span></code></pre></div><p>Such is the magic of <code>io.Reader</code>.</p></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>Parsia</span></span>
<time>Jan 19, 2018</time>
<span class=categories>Tags:
<a class=category href=https://parsiya.net/tags/base64>base64</a> <a class=category href=https://parsiya.net/tags/io.reader>io.Reader</a></span></p><p class=meta><a class="basic-alignment left" href=https://parsiya.net/blog/2017-12-29-simple-ssh-harvester-in-go/ title="Simple SSH Harvester in Go">Simple SSH Harvester in Go</a>
<a class="basic-alignment right" href=https://parsiya.net/blog/2018-01-23-mounting-live-snapshots-of-encrypted-vms-in-virtualbox/ title="Mounting Live Snapshots of Encrypted VMs in VirtualBox">Mounting Live Snapshots of Encrypted VMs in VirtualBox</a></p><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//parsiya.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h1>Who am I?</h1><p><p>I am Parsia, an application security engineer.</p><p>I write about application security, cryptography, static analysis, and
(of course) videogames.</p><p>Click on <a href=/about/>About Me!</a> to know more.</p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank rel="me noopener noreferrer" href=https://infosec.exchange/@parsiya title=https://infosec.exchange/@parsiya><i class="fa fa-mastodon fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://github.com/parsiya/ title=https://github.com/parsiya/><i class="fa fa-github fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://twitter.com/cryptogangsta/ title=https://twitter.com/cryptogangsta/><i class="fa fa-twitter fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/in/parsiya title=https://www.linkedin.com/in/parsiya><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><h1>Collections</h1><li><a href=https://parsiya.net/categories/thick-client-proxying/ title="Thick Client Proxying">Thick Client Proxying</a></li><li><a href=https://parsiya.net/categories/writeup/ title=CTFs/Writeups>CTFs/Writeups</a></li><li><a href=https://parsiya.net/categories/attack-surface-analysis/ title="Attack Surface Analysis">Attack Surface Analysis</a></li><li><a href=https://parsiya.net/categories/static-analysis/ title="Static Analysis">Static Analysis</a></li><li><a href=https://parsiya.net/categories/bug-bounty/ title="Bug Bounty">Bug Bounty</a></li><li><a href=https://parsiya.net/categories/blockchain/ title="Blockchain (lol)">Blockchain (lol)</a></li><li><a href=https://parsiya.net/categories/crypto/ title=Crypto(graphy)>Crypto(graphy)</a></li><li><a href=https://parsiya.net/categories/burp-extension/ title="Burp Extension Development">Burp Extension Development</a></li><li><a href=https://parsiya.net/categories/automation/ title=Automation>Automation</a></li><li><a href=https://parsiya.net/categories/reverse-engineering/ title="Reverse Engineering">Reverse Engineering</a></li><li><a href=https://parsiya.net/categories/winappdbg/ title="WinAppDbg (use Frida instead)">WinAppDbg (use Frida instead)</a></li><li><a href=https://awsome.pw title='AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability'>AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability</a></li></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2024 Parsia - <a href=https://parsiya.net/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>