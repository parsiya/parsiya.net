<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>Cloudflare Concise Christmas Cryptography Challenges 2019 Solutions</title>
<link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://parsiya.net/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Parsia Hakimian Parsiya infosec information security]"><meta name=author content="Parsia"><meta name=generator content="Hugo 0.134.1"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image:src content="https://parsiya.net/blog/2019-01-03-cloudflare-concise-christmas-cryptography-challenges-2019-solutions/04-rpki.png"><meta name=twitter:title content="Cloudflare Concise Christmas Cryptography Challenges 2019 Solutions"><meta name=twitter:description content="Cloudflare had a Christmas crypto(graphy) challenge. Here are my solutions. The first two questions were pretty easy but the 3rd sent me down on a rabbit hole. Apparently, only 15 people solved it which places me in the world top 15 cryptographers (that's how it works right?)."><meta name=twitter:domain content="parsiya.net"><meta name=twitter:creator content="@CryptoGangsta"></head><body><header role=banner><hgroup><h1><a href=https://parsiya.net/>Hackerman's Hacking Tutorials</a></h1><h2>The knowledge of anything, since all things have causes, is not acquired or
complete unless it is known by its causes. - Avicenna</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://parsiya.net/about/>» About Me!</option><option value=https://parsiya.net/cheatsheet/>» Cheat Sheet</option><option value=https://parsiya.io/>» My Clone</option><option value=https://github.com/parsiya/parsiya.net>» Source Repo</option><option value="https://queue.acm.org/detail.cfm?id=3197520">» Manual Work is a Bug</option><option value="https://www.google.com/search?q=andrew+ridgeley">» The Other Guy from Wham!</option></select></fieldset><ul class=main-navigation><li><a href=https://parsiya.net/about/ title="About Me!" target=_blank rel="noopener noreferrer">About Me!</a></li><li><a href=https://parsiya.net/cheatsheet/ title="Cheat Sheet" target=_blank rel="noopener noreferrer">Cheat Sheet</a></li><li><a href=https://parsiya.io/ title="My Clone" target=_blank rel="noopener noreferrer">My Clone</a></li><li><a href=https://github.com/parsiya/parsiya.net title="Source Repo" target=_blank rel="noopener noreferrer">Source Repo</a></li><li><a href="https://queue.acm.org/detail.cfm?id=3197520" title="Manual Work is a Bug" target=_blank rel="noopener noreferrer">Manual Work is a Bug</a></li><li><a href="https://www.google.com/search?q=andrew+ridgeley" title="The Other Guy from Wham!" target=_blank rel="noopener noreferrer">The Other Guy from Wham!</a></li></ul><ul class=subscription><a href=https://parsiya.net/index.xml target=_blank type=application/rss+xml title=RSS rel="noopener noreferrer"><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://parsiya.net/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>Jan 3, 2019
- 9 minute read
- <a href=https://parsiya.net/blog/2019-01-03-cloudflare-concise-christmas-cryptography-challenges-2019-solutions/#disqus_thread>Comments</a>
- <a class=label href=https://parsiya.net/categories/crypto/>Crypto </a><a class=label href=https://parsiya.net/categories/writeup/>Writeup</a></p><h1 class=entry-title>Cloudflare Concise Christmas Cryptography Challenges 2019 Solutions</h1></header><div class=entry-content><nav id=TableOfContents><ul><li><a href=#client-says-hello>Client says Hello</a></li><li><a href=#totp>TOTP</a></li><li><a href=#rpki>RPKI</a></li><li><a href=#lessons-learned-from-the-rpki-challenge>Lessons Learned from The RPKI Challenge</a><ul><li><ul><li><a href=#cloudflare-cirrus>Cloudflare Cirrus</a></li><li><a href=#gortr>gortr</a></li><li><a href=#bgpmon-whois>BGPMON Whois</a></li><li><a href=#rsyncrpkiripenetrepository>rsync://rpki.ripe.net/repository/</a></li></ul></li></ul></li></ul></nav><p>Cloudflare had a <a href=https://blog.cloudflare.com/christmas-cryptography-challenges-2019/ target=_blank rel="noreferrer noopener">Christmas crypto(graphy) challenge</a>. Here are my solutions. The first two questions were pretty easy but the 3rd sent me down on a rabbit hole. Apparently, only 15 people solved it which places me in the world top 15 cryptographers (that's how it works right?).</p><h1 id=client-says-hello>Client says Hello
<a class=header-link href=#client-says-hello><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>The packet is a raw <code>ClientHello</code> (not completely but let's not debate that). <code>ClientHello</code> is the first part in the 3-way TLS handshake (don't mix it up with the 3-way TCP handshake).</p><p>Dropping it into CyberChef and applying <code>From Hex</code> filter shows us an interesting payload. Supposedly SNI but I did not check the format of the packet.</p><p>SNI stands for Server Name Indication. It's a way for the client to tell a virtual host what certificate to use for communication. Read about it:</p><ul><li><a href=/blog/2016-07-28-thick-client-proxying-part-6-how-https-proxies-work/#4-cloudfront-and-server-name-indication title="How HTTP Proxies Work - CloudFront and Server Name Indication">How HTTP Proxies Work - CloudFront and Server Name Indication</a></li></ul><p>On the Cloudflare blog we can read about encrypting the SNI to prevent privacy leaks:</p><ul><li><a href=https://blog.cloudflare.com/encrypted-sni/ target=_blank rel="noreferrer noopener">https://blog.cloudflare.com/encrypted-sni/</a></li></ul><p>The result from Cyberchef looks like this:</p><pre tabindex=0><code>....¬.xOC}¿Ç..E..òV.@.@.ÛX¬. ÈCÇø.Ñ÷.»È²¯4Iµ.u...*r§.....
g[Î.xz½.....¹...µ..\.¥iÕöMóØc
è½ÝÑ..uõ(®W}$6..èÞ·....D.ÿÀ,À+À$À#À
À	À.À0À/À(À&#39;À.À.À......k.g.9.3.......=.&lt;.5./.
.¯.®.........H.....	...cfl.re.
.................
.....................................R0VUIC8yQWRLemdCClRFWFQgT04gTElORVMgNCBBTkQgNQ==
</code></pre><span class=caption-wrapper><img class=caption src=01-fromhex.png title="From Hex applied to the payload" alt="From Hex applied to the payload">
<span class=caption-text>From Hex applied to the payload</span></span><p>Base64 decode the payload:</p><pre tabindex=0><code>GET /2AdKzgB
TEXT ON LINES 4 AND 5
</code></pre><p>Combine it with <code>clf.re</code> (included in the raw data) to get <a href=https://cfl.re/2AdKzgB target=_blank rel="noreferrer noopener">https://cfl.re/2AdKzgB</a> which redirects to <a href=https://www.cloudflare.com/robots.txt target=_blank rel="noreferrer noopener">https://www.cloudflare.com/robots.txt</a>.</p><pre tabindex=0><code>#    .__________________________.
#    | .___________________. |==|
#    | | ................. | |  |
#    | | ::[ Dear robot ]: | |  |
#    | | ::::[ be nice ]:: | |  |
#    | | ::::::::::::::::: | |  |
#    | | ::::::::::::::::: | |  |
#    | | ::::::::::::::::: | |  |
#    | | ::::::::::::::::: | | ,|
#    | !___________________! |(c|
#    !_______________________!__!
#   /                            \
#  /  [][][][][][][][][][][][][]  \
# /  [][][][][][][][][][][][][][]  \
#(  [][][][][____________][][][][]  )
# \ ------------------------------ /
#  \______________________________/
</code></pre><p><strong>Answer: Lines 4 and 5 say <code>Dear Robot be nice</code>.</strong></p><h1 id=totp>TOTP
<a class=header-link href=#totp><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>Convert each of those times into a Unix timestamp. We can use Cyberchef again:</p><span class=caption-wrapper><img class=caption src=02-timestamps.png title="Dates converted to time" alt="Dates converted to time">
<span class=caption-text>Dates converted to time</span></span><p>The hints say it's using TOTP w/o a secret. TOTP is a modified version HOTP that uses timestamps. Long story short, you use a shared secret to calculate an HMAC (SHA-1 by default) of counter and secret. Then convert the result to six digits for usage. The counter is the number of durations (usually <code>30</code> seconds) since the start (usually it's <code>0</code> epoch). This means each code will be valid for 30 seconds.</p><p>Cyberchef has a TOTP and HOTP module but it creates it does not support generation without a secret. If a secret is not provided, it will generate a random secret and use that.</p><p>We can use a Go package <a href=https://github.com/pquerna/otp/totp target=_blank rel="noreferrer noopener">github.com/pquerna/otp/totp</a> to test our theory. January 1st 2019 is <code>1546300800</code> and plugging it into the code gives us the result.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#719e07>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#2aa198>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#2aa198>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#2aa198>&#34;github.com/pquerna/otp/totp&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>main</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	time1 <span style=color:#719e07>:=</span> time.<span style=color:#268bd2>Unix</span>(<span style=color:#2aa198>1545409768</span>, <span style=color:#2aa198>0</span>)
</span></span><span style=display:flex><span>	fmt.<span style=color:#268bd2>Println</span>(time1.<span style=color:#268bd2>UTC</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	str1, _ <span style=color:#719e07>:=</span> totp.<span style=color:#268bd2>GenerateCode</span>(<span style=color:#2aa198>&#34;&#34;</span>, time1)
</span></span><span style=display:flex><span>	fmt.<span style=color:#268bd2>Println</span>(str1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	time2 <span style=color:#719e07>:=</span> time.<span style=color:#268bd2>Unix</span>(<span style=color:#2aa198>1546300800</span>, <span style=color:#2aa198>0</span>)
</span></span><span style=display:flex><span>	str2, _ <span style=color:#719e07>:=</span> totp.<span style=color:#268bd2>GenerateCode</span>(<span style=color:#2aa198>&#34;&#34;</span>, time2)
</span></span><span style=display:flex><span>	fmt.<span style=color:#268bd2>Println</span>(str2)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Answer: <code>301554</code>.</strong></p><span class=caption-wrapper><img class=caption src=03-totp.png title="Output of Go code" alt="Output of Go code">
<span class=caption-text>Output of Go code</span></span><h1 id=rpki>RPKI
<a class=header-link href=#rpki><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>I wasted five hours on this one.</p><p>Using the hints:</p><ul><li>Hint #0: Four or six? Probably six.<ul><li>Cloudflare supports both IPv4 and IPv6 addresses. We should be looking for IPv6 addresses.</li></ul></li><li>Hint #1: If only there was a way of listing only our IPs!<ul><li>IP addresses are here: <a href=https://www.cloudflare.com/ips/ target=_blank rel="noreferrer noopener">https://www.cloudflare.com/ips/</a></li><li>Only IPv6 addresses: <a href=https://www.cloudflare.com/ips-v6 target=_blank rel="noreferrer noopener">https://www.cloudflare.com/ips-v6</a></li></ul></li><li>Hint #2: What is the only part of the ROA where we can hide information into?<ul><li>ROA has four fields: ASN, Prefix, Maximum Length, Trust Anchor (TA),</li><li>They are using ASN.</li></ul></li><li>Hint #3: Subtract the reserve, the char will show itself.<ul><li>See below. We did not really need to do any subtracting.</li></ul></li></ul><p>Plugin IPv6 addresses into this website <a href=http://ripeval.labs.lacnic.net:8080/roas target=_blank rel="noreferrer noopener">http://ripeval.labs.lacnic.net:8080/roas</a>. You can also run a local version of it using <a href=https://github.com/RIPE-NCC/rpki-validator-3 target=_blank rel="noreferrer noopener">https://github.com/RIPE-NCC/rpki-validator-3</a>.</p><p>Searching for <code>2803:f800::/32</code> we get some interesting results:</p><span class=caption-wrapper><img class=caption src=04-rpki.png title="Funky looking ASNs" alt="Funky looking ASNs">
<span class=caption-text>Funky looking ASNs</span></span><p>If you have looked at ASCII codex in Hex or Decimal long enough, you can see the last digits are printable Decimal ASCII characters.</p><pre tabindex=0><code>97      a
98      b
111     o
114     r
118     v
</code></pre><p>This doesn't make any sense. So I thought maybe we need to subtract <code>42</code> from them (<code>subtract the reserve</code> in the hints). Which gives us:</p><pre tabindex=0><code>97	    a	    55      U
98	    b	    56	    V
111	    o	    69	    E
114	    r	    72	    H
118	    v	    76	    L
</code></pre><p>This does not make any sense either. Now, look at the prefixes. They end with a single digit from 1 to 5. Sorting by prefix we get <code>bravo</code> or <code>VHULE</code> if you do the subtracting. <strong>I went with <code>bravo</code>.</strong></p><h1 id=lessons-learned-from-the-rpki-challenge>Lessons Learned from The RPKI Challenge
<a class=header-link href=#lessons-learned-from-the-rpki-challenge><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>I wasted five hours going around the internet for the third challenge. The first three hints were easy. The whole challenge up to that moment had taken only five minutes (that's not a brag, it's very easy). But then I got stuck. Note the solution prefixes do not show up in any of the following places.</p><p>So <code>Route Origin Authorisation</code> or ROA is an object that is signed by a CA. It's using the x509 ecosystem and five root CAs to sign these announcements (one for each region). This supposedly reduces BGP hijacking. I do not know enough to give you a good explanation so please read their blog post and other resources:</p><ul><li><a href=https://blog.cloudflare.com/rpki/ target=_blank rel="noreferrer noopener">https://blog.cloudflare.com/rpki/</a></li></ul><h3 id=cloudflare-cirrus>Cloudflare Cirrus
<a class=header-link href=#cloudflare-cirrus><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>My train of thought was "Ok, they are signing certificate like objects" (ROAs are not certificates but they are signed). Cloudflare has a certificate transparency log for ROAs called Cirrus at <a href=https://ct.cloudflare.com/logs/cirrus target=_blank rel="noreferrer noopener">https://ct.cloudflare.com/logs/cirrus</a>.</p><p>Supposedly, you can get the logs but how? The page does not have anything. 15 minutes of searching and I realized the <code>get-entries</code> and other items in the left side bar are REST style endpoints. There's an RFC at <a href=https://tools.ietf.org/html/rfc6962 target=_blank rel="noreferrer noopener">https://tools.ietf.org/html/rfc6962</a>.</p><p>Jump down to <a href=https://tools.ietf.org/html/rfc6962#page-20 target=_blank rel="noreferrer noopener">page 20</a> to see <code>get-entries</code>:</p><p><code>GET https://&lt;log server>/ct/v1/get-entries?start=1234&amp;end=5678</code></p><p>Looking at their status page I saw two certificates were recently enrolled (20th and 21st December 2018). These must be the new certificates, right?</p><span class=caption-wrapper><img class=caption src=05-cirrus.png title="New certificates added to the Cirrus certificate transparency log" alt="New certificates added to the Cirrus certificate transparency log">
<span class=caption-text>New certificates added to the Cirrus certificate transparency log</span></span><p>There were <code>7906</code> certificates in the log. We can access each of the individual entries or search for ranges, so to get the last six entries we can use this GET request:</p><ul><li><a href="https://ct.cloudflare.com/logs/cirrus/ct/v1/get-entries?start=7900&amp;end=7906" target=_blank rel="noreferrer noopener">https://ct.cloudflare.com/logs/cirrus/ct/v1/get-entries?start=7900&end=7906</a></li></ul><p>Which gives us this big JSON file, the keys are discussed in the RFC on the same page. Unfortunately, neither of them are the certificate:</p><ul><li><code>leaf_input</code> is the Merkle Tree.</li><li><code>extra_data</code> is the chain.</li></ul><p>We can decode them from base64 to get the underlying item but it's not what we want.</p><h3 id=gortr>gortr
<a class=header-link href=#gortr><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Cloudflare is a Go shop and they have this utility: <a href=https://github.com/cloudflare/gortr target=_blank rel="noreferrer noopener">https://github.com/cloudflare/gortr</a>.</p><p>I do not know enough to tell you what it does but it has a link to this file:</p><ul><li><a href=https://rpki.cloudflare.com/rpki.json target=_blank rel="noreferrer noopener">https://rpki.cloudflare.com/rpki.json</a></li></ul><p>It has records like this:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{<span style=color:#268bd2>&#34;prefix&#34;</span>:<span style=color:#2aa198>&#34;157.119.101.0/24&#34;</span>,<span style=color:#268bd2>&#34;maxLength&#34;</span>:<span style=color:#2aa198>24</span>,<span style=color:#268bd2>&#34;asn&#34;</span>:<span style=color:#2aa198>&#34;AS3177&#34;</span>,<span style=color:#268bd2>&#34;ta&#34;</span>:<span style=color:#2aa198>&#34;&#34;</span>}
</span></span></code></pre></div><p>I looked up Cloudflare's IPv6 addresses to find the ASNs. Nothing looked out of the ordinary.</p><h3 id=bgpmon-whois>BGPMON Whois
<a class=header-link href=#bgpmon-whois><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>I also stumbled upon this blog:</p><ul><li><a href=https://bgpmon.net/securing-bgp-routing-with-rpki-and-roas/ target=_blank rel="noreferrer noopener">https://bgpmon.net/securing-bgp-routing-with-rpki-and-roas/</a></li></ul><p>We can get ROA information from this whois server. Plugging the prefixes from the <code>rpki.json</code> file or any other place we can see the results:</p><pre tabindex=0><code>$ whois -h whois.bgpmon.net 2400:cb00:151::/48
% This is the BGPmon.net whois Service
% You can use this whois gateway to retrieve information
% about an IP adress or prefix
% We support both IPv4 and IPv6 address.
%
% For more information visit:
% http://bgpmon.net/bgpmonapi.php

Prefix:              2400:cb00:151::/48
Prefix description:  101 Townsend Street, San Francisco, California 94107, US
Country code:        US
Origin AS:           13335
Origin AS Name:      Cloudflare Inc
RPKI status:         ROA validation successful
First seen:          2018-12-21
Last seen:           2018-12-26
Seen by #peers:      57
</code></pre><p>There's a typo in line 4 (<code>adress</code>) that is bugging me but we get some info. Next, we can plug the ASN and prefix into this other command:</p><pre tabindex=0><code>$ whois -h whois.bgpmon.net &#34; --roa 13335 2400:cb00:151::/48&#34;
0 - Valid
------------------------
ROA Details
------------------------
Origin ASN:       AS13335
Not valid Before: 2018-11-29 20:32:10
Not valid After:  2019-07-30 00:00:00  Expires in 214d16h22m30s
Trust Anchor:     rpki.apnic.net
Prefixes:         2400:cb00:11::/48 (max length /48)
                  2400:cb00:2048::/48 (max length /48)
                  2400:cb00:27::/48 (max length /48)
                  2400:cb00:120::/48 (max length /48)
                  2400:cb00:42::/48 (max length /48)
                  2400:cb00:174::/48 (max length /48)
</code></pre><p>You don't even need the first command. Simply send the second command with any ROA and the output will correct you:</p><pre tabindex=0><code>$ whois -h whois.bgpmon.net &#34; --roa 123456 2400:cb00:151::/48&#34;
2 - Not Valid: Invalid Origin ASN, expected 13335
</code></pre><p>I plugged in Cloudflare's IPv6 IP and could not find anything fishy there. The solution prefixes are not found here either.</p><pre tabindex=0><code>$ whois -h whois.bgpmon.net 2803:f800:cfcf:cfcf:cfcf:cfcf:cfcf:3/128
Prefix not found
</code></pre><p>Seems like we can also use this whois server:</p><ul><li><a href=https://www.ripe.net/analyse/archived-projects/ris-tools-web-interfaces/riswhois target=_blank rel="noreferrer noopener">https://www.ripe.net/analyse/archived-projects/ris-tools-web-interfaces/riswhois</a></li></ul><pre tabindex=0><code>$ whois -h riswhois.ripe.net 2400:cb00:151::/48
% This is RIPE NCC&#39;s Routing Information Service
% whois gateway to collected BGP Routing Tables, version2.0
% IPv4 or IPv6 address to origin prefix match
%
% For more information visit http://www.ripe.net/ris/riswhois.html
%
% Connected to backend ris-whois12.ripe.net

route6:       2400:cb00:151::/48
origin:       AS13335
descr:        CLOUDFLARENET - Cloudflare, Inc., US
lastupd-frst: 2018-10-03 06:11Z  2001:478:124::241@rrc16
lastupd-last: 2018-12-26 23:34Z  2001:7f8:4::9471:1@rrc01
seen-at:      rrc00,rrc01,rrc03,rrc04,rrc05,rrc06,rrc07,rrc10,rrc11,rrc12,rrc13,rrc14,rrc15,rrc19,rrc20,rrc21,rrc23
num-rispeers: 211
source:       RISWHOIS
</code></pre><p>And again, nothing there for the fishy prefixes:</p><pre tabindex=0><code>$ whois -h riswhois.ripe.net 2803:f800:cfcf:cfcf:cfcf:cfcf:cfcf:3/128
% This is RIPE NCC&#39;s Routing Information Service
% whois gateway to collected BGP Routing Tables, version2.0
% IPv4 or IPv6 address to origin prefix match
%
% For more information visit http://www.ripe.net/ris/riswhois.html
%
% Connected to backend ris-whois04.ripe.net

% No entries found
</code></pre><h3 id=rsyncrpkiripenetrepository>rsync://rpki.ripe.net/repository/
<a class=header-link href=#rsyncrpkiripenetrepository><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Validators use <code>rsync</code> to get all the certificates and ROAs. We can get them manually too.</p><pre tabindex=0><code>$ rsync -av rsync://rpki.ripe.net/repository/ .
</code></pre><p>The <code>v</code> switch prints everything, and there are a ton of files being downloaded so I removed it. The result is this huge lot of certificates, ROAs, CRLs, and other stuff. Seriously, there were 40000+ files in 14000 folders. There was no way that I could parse all of these and figure out the solution so I gave up there.</p><pre tabindex=0><code>│   2a7dd1d787d793e4c8af56e197d4eed92af6ba13.cer
│   ripe-ncc-ta.crl
│   ripe-ncc-ta.mft
│
├───aca
│       HGp1AESLbyiopScGy7yW4b6s_T4.cer
│       Kn3R14fXk-TIr1bhl9Tu2Sr2uhM.crl
│       Kn3R14fXk-TIr1bhl9Tu2Sr2uhM.mft
│
└───DEFAULT
    │   0-sjfvx8LHPCPmrwyaX3vz51CQw.cer
    │   0-SVCv6AXz7c9M8RLlcYO_0ALFY.cer
    │   01qjZwczxpcrS5FhVwvd6aIPlTU.cer
    │   01Z_Y4Iw6KiE7J_X-uTLSRwv_eU.cer
    │   03l7bVyOqC4v44GDY6-4JscZKOc.cer
    │   03z5DDj2eKrXwsVXQmiNpZ9pzis.cer
    │   04kZ4OLyGlSKdZHdOvDg_k7YO_g.cer
    │   05BnEzOQAuBsZwwCI4CEJmVs0L4.cer
</code></pre><p>If you wanna know what these files are, navigate to this page <a href=https://www.ripe.net/publications/docs/ripe-549#Repositories target=_blank rel="noreferrer noopener">https://www.ripe.net/publications/docs/ripe-549#Repositories</a> and scroll up.</p><span class=caption-wrapper><img class=caption src=06-rsync-files.png title="Description of files downloaded via rsync" alt="Description of files downloaded via rsync">
<span class=caption-text>Description of files downloaded via rsync</span></span><p>I wanted to parse the ROA files and see if I can grab any information from inside them but I gave up. There might be some support here:</p><ul><li><a href=https://github.com/google/certificate-transparency-go/blob/master/x509/rpki.go target=_blank rel="noreferrer noopener">https://github.com/google/certificate-transparency-go/blob/master/x509/rpki.go</a></li></ul><p>Seems like that is a fork of the x509 package aimed for working with certificate transparency logs.</p></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>Parsia</span></span>
<time>Jan 3, 2019</time></span></p><p class=meta><a class="basic-alignment left" href=https://parsiya.net/blog/2018-12-24-cryptography-in-python-burp-extensions/ title="Cryptography in Python Burp Extensions">Cryptography in Python Burp Extensions</a>
<a class="basic-alignment right" href=https://parsiya.net/blog/2019-01-15-sans-holiday-hack-challenge-2018-solutions/ title="SANS Holiday Hack Challenge 2018 Solutions">SANS Holiday Hack Challenge 2018 Solutions</a></p><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//parsiya.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h1>Who am I?</h1><p><p>I am Parsia, an application security engineer.</p><p>I write about application security, cryptography, static analysis, and
(of course) videogames.</p><p>Click on <a href=/about/>About Me!</a> to know more.</p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank rel="me noopener noreferrer" href=https://infosec.exchange/@parsiya title=https://infosec.exchange/@parsiya><i class="fa fa-mastodon fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://github.com/parsiya/ title=https://github.com/parsiya/><i class="fa fa-github fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://twitter.com/cryptogangsta/ title=https://twitter.com/cryptogangsta/><i class="fa fa-twitter fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/in/parsiya title=https://www.linkedin.com/in/parsiya><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><h1>Collections</h1><li><a href=https://parsiya.net/categories/thick-client-proxying/ title="Thick Client Proxying">Thick Client Proxying</a></li><li><a href=https://parsiya.net/categories/writeup/ title=CTFs/Writeups>CTFs/Writeups</a></li><li><a href=https://parsiya.net/categories/attack-surface-analysis/ title="Attack Surface Analysis">Attack Surface Analysis</a></li><li><a href=https://parsiya.net/categories/static-analysis/ title="Static Analysis">Static Analysis</a></li><li><a href=https://parsiya.net/categories/bug-bounty/ title="Bug Bounty">Bug Bounty</a></li><li><a href=https://parsiya.net/categories/blockchain/ title="Blockchain (lol)">Blockchain (lol)</a></li><li><a href=https://parsiya.net/categories/crypto/ title=Crypto(graphy)>Crypto(graphy)</a></li><li><a href=https://parsiya.net/categories/burp-extension/ title="Burp Extension Development">Burp Extension Development</a></li><li><a href=https://parsiya.net/categories/automation/ title=Automation>Automation</a></li><li><a href=https://parsiya.net/categories/reverse-engineering/ title="Reverse Engineering">Reverse Engineering</a></li><li><a href=https://parsiya.net/categories/winappdbg/ title="WinAppDbg (use Frida instead)">WinAppDbg (use Frida instead)</a></li><li><a href=https://awsome.pw title='AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability'>AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability</a></li></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2024 Parsia - <a href=https://parsiya.net/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>