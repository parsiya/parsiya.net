<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>Windows Netsh Interface Portproxy</title><link rel=stylesheet href=/css/hugo-octopress.css>
<link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://parsiya.net/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Parsia Hakimian Parsiya infosec information security]"><meta name=author content="Parsia"><meta name=generator content="Hugo 0.147.2"><meta name=twitter:card content="summary"><meta name=twitter:title content="Windows Netsh Interface Portproxy"><meta name=twitter:description content="I thought I had found the Windows iptables with Portproxy
but I was wrong. But I learned something neat in the process and I am
documenting it.
Portproxy allows you to listen on a certain port on one of your network
interfaces (or all interfaces) and redirect all traffic
destined to that interface to another port/IP.
The to that interface is the limitation that unfortunately kills it. This will
be a short post."><meta name=twitter:domain content="parsiya.net"><meta name=twitter:creator content="@CryptoGangsta"></head><body><header role=banner><hgroup><h1><a href=https://parsiya.net/>Hackerman's Hacking Tutorials</a></h1><h2>The knowledge of anything, since all things have causes, is not acquired or
complete unless it is known by its causes. - Avicenna</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://parsiya.net/about/>» About Me!</option><option value=https://parsiya.net/cheatsheet/>» Cheat Sheet</option><option value=https://parsiya.io/>» My Clone</option><option value=https://github.com/parsiya/parsiya.net>» Source Repo</option><option value="https://queue.acm.org/detail.cfm?id=3197520">» Manual Work is a Bug</option><option value="https://www.google.com/search?q=andrew+ridgeley">» The Other Guy from Wham!</option></select></fieldset><ul class=main-navigation><li><a href=https://parsiya.net/about/ title="About Me!" target=_blank rel="noopener noreferrer">About Me!</a></li><li><a href=https://parsiya.net/cheatsheet/ title="Cheat Sheet" target=_blank rel="noopener noreferrer">Cheat Sheet</a></li><li><a href=https://parsiya.io/ title="My Clone" target=_blank rel="noopener noreferrer">My Clone</a></li><li><a href=https://github.com/parsiya/parsiya.net title="Source Repo" target=_blank rel="noopener noreferrer">Source Repo</a></li><li><a href="https://queue.acm.org/detail.cfm?id=3197520" title="Manual Work is a Bug" target=_blank rel="noopener noreferrer">Manual Work is a Bug</a></li><li><a href="https://www.google.com/search?q=andrew+ridgeley" title="The Other Guy from Wham!" target=_blank rel="noopener noreferrer">The Other Guy from Wham!</a></li></ul><ul class=subscription><a href=https://parsiya.net/index.xml target=_blank type=application/rss+xml title=RSS rel="noopener noreferrer"><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://parsiya.net/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>Jun 7, 2016
- 3 minute read
- <a href=https://parsiya.net/blog/2016-06-07-windows-netsh-interface-portproxy/#disqus_thread>Comments</a>
- <a class=label href=https://parsiya.net/categories/thick-client-proxying/>Thick Client Proxying </a><a class=label href=https://parsiya.net/categories/portproxy/>Portproxy</a></p><h1 class=entry-title>Windows Netsh Interface Portproxy</h1></header><div class=entry-content><p>I thought I had found the Windows <code>iptables</code> with <a href="https://technet.microsoft.com/de-de/library/cc731068%28v=ws.10%29.aspx" target=_blank rel="noreferrer noopener">Portproxy</a>
but I was wrong. But I learned something neat in the process and I am
documenting it.</p><p>Portproxy allows you to listen on a certain port on one of your network
interfaces (or all interfaces) and redirect all traffic
<strong>destined to that interface</strong> to another port/IP.</p><p>The <code>to that interface</code> is the limitation that unfortunately kills it. This will
be a short post.</p><p>A typical Portproxy command is like this:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>netsh interface portproxy add v4tov4 <span style=color:#268bd2>listenport</span><span style=color:#719e07>=</span><span style=color:#2aa198>9090</span> <span style=color:#268bd2>listenaddress</span><span style=color:#719e07>=</span>192.168.0.100
</span></span><span style=display:flex><span>    <span style=color:#268bd2>connectaddress</span><span style=color:#719e07>=</span>192.168.1.200 <span style=color:#268bd2>connectport</span><span style=color:#719e07>=</span><span style=color:#2aa198>9095</span>
</span></span></code></pre></div><p>I thought I could change <code>listenaddress:listenport</code> and redirect all outgoing
traffic to that <code>IP:port</code> to wherever I wanted (e.g. localhost). But I was
wrong, the command creates a listener on the interface with the
<code>listeneraddress</code> IP and redirects all TCP traffic. In other words, the
<code>listeneraddress</code> needs to be the IP of an interface of your machine and <strong>the
traffic needs to be destined for your machine to be able to be redirected with
this command</strong>. Boo!</p><h2 id=install-ipv6-support>Install IPv6 Support
<a class=header-link href=#install-ipv6-support><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p><strong>Update 2021-06-08:</strong> This is not needed anymore.</p><p><del>Before we start, install IPv6 support in your OS. According to
<a href=https://mskb.pkisolutions.com/kb/555744 target=_blank rel="noreferrer noopener">KB555744</a> Portproxy may not work if IPv6 support is not
installed.</del></p><p>Why? I don't know. I think because Portproxy supports both IPv4 and IPv6
addresses which is a good thing. If you look at the <a href="https://technet.microsoft.com/de-de/library/cc731068%28v=ws.10%29.aspx" target=_blank rel="noreferrer noopener">MSDN</a> link
you can see the four variations that mix v4 and v6 addresses.</p><h2 id=portproxy-in-action>Portproxy in Action
<a class=header-link href=#portproxy-in-action><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Let's start with something simple. We want to redirect anything that goes to
<code>127.0.0.1:9090</code> to <code>google.com:443</code>.</p><p>Open an <strong>admin</strong> command prompt and run this command (<code>protocol=tcp</code> is
optional because Portproxy only supports TCP):</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>netsh interface portproxy add v4tov4 <span style=color:#268bd2>listenport</span><span style=color:#719e07>=</span><span style=color:#2aa198>9090</span> <span style=color:#268bd2>listenaddress</span><span style=color:#719e07>=</span>127.0.0.1
</span></span><span style=display:flex><span>    <span style=color:#268bd2>connectaddress</span><span style=color:#719e07>=</span>216.58.217.78 <span style=color:#268bd2>connectport</span><span style=color:#719e07>=</span><span style=color:#2aa198>443</span> <span style=color:#268bd2>protocol</span><span style=color:#719e07>=</span>tcp
</span></span></code></pre></div><p>Remember to remove the new line (I have split the command into two lines for
better readability).</p><p>This command creates a listener on <code>localhost:9090</code> and forwards all traffic to
<code>216.58.217.78:443</code> (which is Google for me - you might get a different IP
address if you ping it).</p><p>We can display all current Portproxy listeners:</p><ul><li><code>netsh interface portproxy show all</code>.</li></ul><p>In the same admin command prompt run this command to see the listener:</p><ul><li><code>netstat -anb | findstr 9090</code>.</li></ul><span class=caption-wrapper><img class=caption src=/images/2016/portproxy/01.PNG title="Portproxy to Google" alt="Portproxy to Google">
<span class=caption-text>Portproxy to Google</span></span><p>Open a browser and go to <code>https://localhost:9090</code>.</p><span class=caption-wrapper><img class=caption src=/images/2016/portproxy/02.PNG title="Obviously bad certificate" alt="Obviously bad certificate">
<span class=caption-text>Obviously bad certificate</span></span><p>Accept the security exception and we will see:</p><span class=caption-wrapper><img class=caption src=/images/2016/portproxy/03.PNG title="Somewhere in Google land" alt="Somewhere in Google land">
<span class=caption-text>Somewhere in Google land</span></span><p>Not exactly <code>google.com</code> but you know what we accomplished.</p><h2 id=other-uses>Other Uses
<a class=header-link href=#other-uses><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Apart from doing failed tricks we can do other things with this. We can redirect
local resources to remote ones.</p><p>We can also switch ports. Using the <code>hosts</code> file, we can redirect traffic to
domains, but not the port. E.g., we can redirect <code>google.com</code> to <code>localhost</code>,
but we cannot change the port. With Portproxy, we can add a new listener on
<code>localhost:443</code> and redirect all traffic to a different IP:port (e.g. a VM
running our proxy). This might replace the <a href=http://blog.portswigger.net/2012/12/sample-burp-suite-extension-traffic.html target=_blank rel="noreferrer noopener">Traffic
Redirector</a> Burp extension.</p></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>Parsia</span></span><time>Jun 7, 2016</time>
<span class=categories>Tags:<a class=category href=https://parsiya.net/tags/proxying>Proxying</a> <a class=category href=https://parsiya.net/tags/portproxy>Portproxy</a> <a class=category href=https://parsiya.net/tags/windows>Windows</a></span></p><p class=meta><a class="basic-alignment left" href=https://parsiya.net/blog/2016-06-01-learning-go/ title="Learning Go">Learning Go</a>
<a class="basic-alignment right" href=https://parsiya.net/blog/2016-07-14-gynvael-coldwind-garage4hackers-notes-from-march-2014/ title="Gynvael Coldwind - Garage4Hackers - Notes from March 2014">Gynvael Coldwind - Garage4Hackers - Notes from March 2014</a></p><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//parsiya.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h1>Who am I?</h1><p><p>I am Parsia, a security engineer at Microsoft.</p><p>I write about application security, cryptography, static analysis, and
(of course) videogames.</p><p>Click on <a href=/about/>About Me!</a> to know more.</p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank rel="me noopener noreferrer" href=https://infosec.exchange/@parsiya title=https://infosec.exchange/@parsiya><i class="fa fa-mastodon fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://github.com/parsiya/ title=https://github.com/parsiya/><i class="fa fa-github fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://twitter.com/cryptogangsta/ title=https://twitter.com/cryptogangsta/><i class="fa fa-twitter fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/in/parsiya title=https://www.linkedin.com/in/parsiya><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><h1>Collections</h1><li><a href=https://parsiya.net/categories/thick-client-proxying/ title="Thick Client Proxying">Thick Client Proxying</a></li><li><a href=https://parsiya.net/categories/writeup/ title=CTFs/Writeups>CTFs/Writeups</a></li><li><a href=https://parsiya.net/categories/attack-surface-analysis/ title="Attack Surface Analysis">Attack Surface Analysis</a></li><li><a href=https://parsiya.net/categories/static-analysis/ title="Static Analysis">Static Analysis</a></li><li><a href=https://parsiya.net/categories/bug-bounty/ title="Bug Bounty">Bug Bounty</a></li><li><a href=https://parsiya.net/categories/blockchain/ title="Blockchain (lol)">Blockchain (lol)</a></li><li><a href=https://parsiya.net/categories/crypto/ title=Crypto(graphy)>Crypto(graphy)</a></li><li><a href=https://parsiya.net/categories/burp-extension/ title="Burp Extension Development">Burp Extension Development</a></li><li><a href=https://parsiya.net/categories/automation/ title=Automation>Automation</a></li><li><a href=https://parsiya.net/categories/reverse-engineering/ title="Reverse Engineering">Reverse Engineering</a></li><li><a href=https://parsiya.net/categories/winappdbg/ title="WinAppDbg (use Frida instead)">WinAppDbg (use Frida instead)</a></li><li><a href=https://awsome.pw title='AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability'>AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability</a></li></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2025 Parsia - <a href=https://parsiya.net/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>