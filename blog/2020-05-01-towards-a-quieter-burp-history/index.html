<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>Towards a Quieter Burp History</title><link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://parsiya.net/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Parsia Hakimian Parsiya infosec information security]"><meta name=author content="Parsia"><meta name=generator content="Hugo 0.103.1"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image:src content="https://parsiya.net/blog/2020-05-01-towards-a-quieter-burp-history/04-domains-added.png"><meta name=twitter:title content="Towards a Quieter Burp History"><meta name=twitter:description content="This is how I reduce the noise in Burp's HTTP history when testing thick
clients. You can use the methods here to create your own Burp configuration file
or build upon the one I have created. I am going to identify common noisy
requests that appear in Windows and then ignore them in Burp."><meta name=twitter:domain content="parsiya.net"><meta name=twitter:creator content="@CryptoGangsta"></head><body><header role=banner><hgroup><h1><a href=https://parsiya.net/>Hackerman's Hacking Tutorials</a></h1><h2>The knowledge of anything, since all things have causes, is not acquired or
complete unless it is known by its causes. - Avicenna</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://parsiya.net/about/>» About Me!</option><option value=https://parsiya.net/cheatsheet/>» Cheat Sheet</option><option value=https://parsiya.io/>» My Clone</option><option value=https://github.com/parsiya/parsiya.net>» Source Repo</option><option value="https://queue.acm.org/detail.cfm?id=3197520">» Manual Work is a Bug</option><option value="https://www.google.com/search?q=andrew+ridgeley">» The Other Guy from Wham!</option></select></fieldset><ul class=main-navigation><li><a href=https://parsiya.net/about/ title="About Me!" target=_blank rel="noopener noreferrer">About Me!</a></li><li><a href=https://parsiya.net/cheatsheet/ title="Cheat Sheet" target=_blank rel="noopener noreferrer">Cheat Sheet</a></li><li><a href=https://parsiya.io/ title="My Clone" target=_blank rel="noopener noreferrer">My Clone</a></li><li><a href=https://github.com/parsiya/parsiya.net title="Source Repo" target=_blank rel="noopener noreferrer">Source Repo</a></li><li><a href="https://queue.acm.org/detail.cfm?id=3197520" title="Manual Work is a Bug" target=_blank rel="noopener noreferrer">Manual Work is a Bug</a></li><li><a href="https://www.google.com/search?q=andrew+ridgeley" title="The Other Guy from Wham!" target=_blank rel="noopener noreferrer">The Other Guy from Wham!</a></li></ul><ul class=subscription><a href=https://parsiya.net/index.xml target=_blank type=application/rss+xml title=RSS rel="noopener noreferrer"><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://parsiya.net/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>May 1, 2020
- 10 minute read
- <a href=https://parsiya.net/blog/2020-05-01-towards-a-quieter-burp-history/#disqus_thread>Comments</a>
- <a class=label href=https://parsiya.net/categories/burp/>Burp</a></p><h1 class=entry-title>Towards a Quieter Burp History</h1></header><div class=entry-content><nav id=TableOfContents><ul><li><a href=#tldr>TL;DR</a></li><li><a href=#motivation>Motivation</a><ul><li><a href=#noise-in-burps-history>Noise in Burp's History</a></li><li><a href=#other-applications-stop-working>Other Applications Stop Working</a></li><li><a href=#secretscredentials-in-saved-in-the-burp-project>Secrets/Credentials in Saved in the Burp Project</a></li></ul></li><li><a href=#previous-work>Previous Work</a></li><li><a href=#reduce-incoming-requests>Reduce Incoming Requests</a><ul><li><a href=#proxy-the-application-directly>Proxy The Application Directly</a><ul><li><a href=#techstack-proxy-settings>Techstack Proxy Settings</a></li><li><a href=#browsers>Browsers</a></li></ul></li><li><a href=#use-a-virtual-machine>Use a Virtual Machine</a></li><li><a href=#use-burps-scope>Use Burp's Scope</a></li></ul></li><li><a href=#use-burps-tls-pass-through>Use Burp's TLS Pass Through</a><ul><li><a href=#harvesting-noisy-domains>Harvesting Noisy Domains</a></li><li><a href=#adding-domains-to-burps-tls-pass-through>Adding Domains to Burp's TLS Pass Through</a><ul><li><a href=#adding-more-domains>Adding More Domains</a></li></ul></li><li><a href=#adding-authentication-domains>Adding Authentication Domains</a></li><li><a href=#what-about-http>What About HTTP?</a></li></ul></li><li><a href=#burps-http-history-filter>Burp's HTTP History Filter</a><ul><li><a href=#options>OPTIONS</a></li></ul></li><li><a href=#the-nuclear-option>The Nuclear Option</a></li><li><a href=#the-resulting-project-config>The Resulting Project Config</a><ul><li><a href=#combining-user-and-project-options>Combining User and Project Options</a></li></ul></li><li><a href=#what-did-we-learn-here-today>What Did We Learn Here Today?</a></li></ul></nav><p>This is how I reduce the noise in Burp's HTTP history when testing thick
clients. You can use the methods here to create your own Burp configuration file
or build upon the one I have created. I am going to identify common noisy
requests that appear in Windows and then ignore them in Burp.</p><h1 id=tldr>TL;DR
<a class=header-link href=#tldr><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><ol><li>Proxy the applications directly.<ol><li>Application and tech stack specific proxy settings.</li><li>Browsers: Use Firefox or pass <code>--proxy-server="http://localhost:8080"</code> to Chrome and Edge.</li></ol></li><li>Use a Virtual Machine.</li><li>Use Burp's scope and filter to hide requests in <code>HTTP History</code>.</li><li>Add domains to Burp's <code>TLS Pass Through</code>.<ol><li>Noisy domains. E.g., Windows update.</li><li>Authentication/MFA domains. You do not want your credentials in Burp.</li></ol></li><li>Hide <code>OPTIONS</code> requests in Burp's history with extensions.</li><li>Use this Burp config file as base and add your domains.<ol><li><a href=https://github.com/parsiya/Parsia-Clone/blob/master/configs/burp-default-config.json target=_blank rel="noreferrer noopener">https://github.com/parsiya/Parsia-Clone/blob/master/configs/burp-default-config.json</a></li></ol></li></ol><h1 id=motivation>Motivation
<a class=header-link href=#motivation><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>Noisy history == missing important requests.</p><h2 id=noise-in-burps-history>Noise in Burp's History
<a class=header-link href=#noise-in-burps-history><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Often times when proxying thick clients I have to use the WinINET proxy settings
(also known as IE proxy settings). Burp's history will be full of noise.</p><h2 id=other-applications-stop-working>Other Applications Stop Working
<a class=header-link href=#other-applications-stop-working><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>A lot of miscellaneous applications are also proxied when you enable the Windows
proxy settings. They might stop working due to certificate pinning.</p><h2 id=secretscredentials-in-saved-in-the-burp-project>Secrets/Credentials in Saved in the Burp Project
<a class=header-link href=#secretscredentials-in-saved-in-the-burp-project><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Other proxied applications might contain secrets and other sensitive
information. I keep my Burp projects forever so the secrets are now stored on
the machine and I do not want that to happen.</p><h1 id=previous-work>Previous Work
<a class=header-link href=#previous-work><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>Brian King talks about disabling some options in Firefox to reduce noise in Burp in
<a href=https://www.blackhillsinfosec.com/towards-quieter-firefox/ target=_blank rel="noreferrer noopener">Towards a Quieter Firefox - Blackhills Infosec</a>. He provides a
Firefox <code>user.js</code> file to add those options. It does not block all Firefox
requests and does not work for other browsers.</p><p>I have also written about adding certain domains to Burp's
<a href=https://portswigger.net/burp/documentation/desktop/tools/proxy/options#tls-pass-through target=_blank rel="noreferrer noopener">TLS Pass through</a> in another blog post named
<a href=/blog/2019-10-13-quality-of-life-tips-and-tricks-burp-suite/ title="Quality of Life Tips and Tricks - Burp Suite" rel=nofollow target=_blank>Quality of Life Tips and Tricks - Burp Suite</a>
Domains in the pass through section are not proxied and do not appear in history.</p><h1 id=reduce-incoming-requests>Reduce Incoming Requests
<a class=header-link href=#reduce-incoming-requests><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>If we can prevent some requests from reaching Burp we have won.</p><h2 id=proxy-the-application-directly>Proxy The Application Directly
<a class=header-link href=#proxy-the-application-directly><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Proxy the application directly. If we proxy the application we ignore traffic
for the rest of the system. Sometimes the app has proxy settings. These proxy
settings are not always visible in the application. They might be in a config
file. Search the internet and read the documentation/manual to see how it can be
done.</p><h3 id=techstack-proxy-settings>Techstack Proxy Settings
<a class=header-link href=#techstack-proxy-settings><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>The tech stack helps with proxying. Here are some quick tips:</p><ul><li>.NET: You can proxy these by using a config file. See
<a href=/blog/2017-10-07-thick-client-proxying-part-7-proxying-.net-applications-via-config-file/ title="Thick Client Proxying - Part 7 - Proxying .NET Applications via Config File" rel=nofollow target=_blank>Thick Client Proxying - Part 7 - Proxying .NET Applications via Config File</a></li><li>Java: You can <a href=https://docs.oracle.com/javase/8/docs/technotes/guides/net/proxies.html target=_blank rel="noreferrer noopener">pass parameters</a> that set a proxy. E.g.,
<code>-Dhttps.proxyHost=127.0.0.1</code> and <code>-Dhttps.proxyPort=8080</code>.</li></ul><h3 id=browsers>Browsers
<a class=header-link href=#browsers><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Browsers are special thick clients. We can directly proxy them.</p><ul><li>Firefox: I usually use Firefox or its clones because it has its own
<a href=https://support.mozilla.org/en-US/kb/connection-settings-firefox target=_blank rel="noreferrer noopener">proxy settings</a>. Also <a href=https://addons.mozilla.org/en-US/firefox/addon/foxyproxy-standard/ target=_blank rel="noreferrer noopener">FoxyProxy</a> helps.</li><li>Chromium based browsers such as Chrome and Edge use the Windows proxy settings
but it is possible to point to a proxy using command line parameters.<ul><li>E.g., Edge: <code>msedge.exe --proxy-server="http://localhost:8080"</code></li><li>Create a shortcut that runs the browser with a specific proxy, this way
you can run different instances of the browser for normal web browsing or
proxying.</li></ul></li><li><a href=https://www.electronjs.org/ target=_blank rel="noreferrer noopener">Electron</a>: Usually honor Windows proxy settings. Chromium based
but ignore <code>--proxy-server</code>.<ul><li>Try these tips by <a href=https://twitter.com/Void_Sec target=_blank rel="noreferrer noopener">Paolo Stagno</a> on <a href=https://blog.doyensec.com/ target=_blank rel="noreferrer noopener">blog.doyensec.com</a>.
<a href=https://blog.doyensec.com/2018/07/19/instrumenting-electron-app.html#intercepting-https-traffic target=_blank rel="noreferrer noopener">Instrumenting Electron Apps for Security Testing - Intercepting HTTP(s) traffic</a>.</li></ul></li></ul><h2 id=use-a-virtual-machine>Use a Virtual Machine
<a class=header-link href=#use-a-virtual-machine><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>For obvious reasons, VMs are a must for testing thick clients. They are
controlled environments. Your other applications do not break, the noise from
their traffic does not show up in Burp, and you do not have to change the proxy
settings because you need to attend a videoconference meeting.</p><h2 id=use-burps-scope>Use Burp's Scope
<a class=header-link href=#use-burps-scope><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>It's possible add endpoints used by the application to
<a href=/blog/2016-03-29-thick-client-proxying-part-2-burp-history-intruder-scanner-and-more/#1-scope title="the Burp's scope" rel=nofollow target=_blank>the Burp's scope</a>
and hide everything not in scope. But this is not feasible in the early stages
of recon because we do not know all the endpoints and we do not want to
miss anything when the app contacts a new one. I usually do not use this setting
at all.</p><h1 id=use-burps-tls-pass-through>Use Burp's TLS Pass Through
<a class=header-link href=#use-burps-tls-pass-through><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>If it's not possible to reduce the incoming requests we can also tell Burp not
to MitM some requests.</p><h2 id=harvesting-noisy-domains>Harvesting Noisy Domains
<a class=header-link href=#harvesting-noisy-domains><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>First, we must make a list of any traffic that should not be proxied. Some
examples are Windows specific traffic (e.g., telemetry), browsers calling
home, and other application updates.</p><p>To create this list I did the following:</p><ol><li>Started Burp in a typical Windows 10 VM and set it in Windows proxy settings.</li><li>Added the
<a href=/blog/2016-02-21-installing-burp-certificate-authority-in-windows-certificate-store/ title="Installing Burp Certificate Authority in Windows Certificate Store" rel=nofollow target=_blank>Burp's CA to the Windows certificate store</a></li><li>Opened every application and browser that I normally use and interacted with
them a bit (e.g., checked for updates).</li><li>Left the VM idle for a few hours.</li></ol><span class=caption-wrapper><img class=caption src=01-domains-target.png title="Domains in the Target tab" alt="Domains in the Target tab">
<span class=caption-text>Domains in the Target tab</span></span><p>I switched to the <code>Target > Site map</code> tab and looked for a way to copy every
domain. Burp does not have an option to just copy the domains but there is a
trick:</p><ol><li>Go to <code>Target > Scope</code> and check <code>Use advanced scope control</code>.</li><li>Go to <code>Target > Site map</code> and click on <code>Filter</code> and click the <code>Show all</code>
button.</li><li>Use <code>ctrl+a</code> to select every target.</li><li>Right-click and select <code>Add to Scope</code>.</li><li>Switch back to the <code>Scope</code> tab.</li><li>Select one item in scope and use <code>ctrl+a</code> to select every domain scope. Then
copy them with <code>ctrl+c</code>.</li><li>Paste the results in a text file and save it.</li></ol><p>Now I had a list of regular expressions for the domains.</p><span class=caption-wrapper><img class=caption src=02-domain-regex.png title="Domain regexes" alt="Domain regexes">
<span class=caption-text>Domain regexes</span></span><h2 id=adding-domains-to-burps-tls-pass-through>Adding Domains to Burp's TLS Pass Through
<a class=header-link href=#adding-domains-to-burps-tls-pass-through><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p><code>TLS Pass Through</code> has an option to paste URLs or load a list from a file. It
does not support the format we just created. The file should have one normal URL
per line (not regex). E.g., instead of <code>^accounts\.google\.com$</code> we
should have <code>accounts.google.com</code>. <code>*.google.com</code> does not work either.</p><span class=caption-wrapper><img class=caption src=03-unrecognized-hosts.png title="Error importing URLs" alt="Error importing URLs">
<span class=caption-text>Error importing URLs</span></span><p>A series of searches and replaces converted the previous domain list to the
correct format. I went to <code>Proxy > Options</code> and scrolled down to <code>TLS Pass Through</code>
at the bottom of the tab. Clicked <code>Load ...</code> and selected the file my domains.</p><span class=caption-wrapper><img class=caption src=04-domains-added.png title="Domains added" alt="Domains added">
<span class=caption-text>Domains added</span></span><p><code>Paste URL</code> only works if there is one URL in the clipboard or you have copied a
URL from another location in Burp.</p><h3 id=adding-more-domains>Adding More Domains
<a class=header-link href=#adding-more-domains><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>To update the list we must add new domains manually in <code>TLS Pass Through</code>.</p><p>Inside Burp:</p><ol><li>Right-click on the request and select <code>Copy URL</code>.</li><li>Go to <code>TLS Pass Through</code> and click the <code>Paste URL</code> button.</li></ol><p>Edit the config file directly:</p><ol><li>Export the config file (or edit the one from below).</li><li>Add new items to <code>project_options > ssl_pass_through > rules</code>.<ol><li>Don't forget to escape backslashes in the JSON string</li></ol></li><li>Reload the config file.</li></ol><p>There were some domains that did not appear in the previous list. I added them
manually:</p><ul><li><code>.*mozilla\\.(com|net|org)</code></li><li><code>.*\.windows\.com</code></li><li><code>.*\\.live\\.com</code></li><li><code>.*\\.windowsupdate\\.com</code></li><li><code>.*\\.microsoft\\.com</code></li><li><code>.*visualstudio\\.com</code></li></ul><h2 id=adding-authentication-domains>Adding Authentication Domains
<a class=header-link href=#adding-authentication-domains><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>As I have explained in
<a href=/blog/2019-10-13-quality-of-life-tips-and-tricks-burp-suite/#burp-should-not-capture-corporate-credentials title="Burp Should Not Capture Corporate Credentials" rel=nofollow target=_blank>Burp Should Not Capture Corporate Credentials</a>,
you do not want to capture login credentials or other sensitive info in your
Burp projects.</p><p>Discover these endpoints for your organization and then add them to the pass
through section. For example, <code>auth.example.net</code> or Okta <code>example.okta.com</code>.</p><h2 id=what-about-http>What About HTTP?
<a class=header-link href=#what-about-http><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>It should have been obvious to me but I did not realize that HTTP requests still
get proxied. For example, <code>http://ocsp.digicert.com</code>.</p><p>There's not much we can do here. Fortunately, there are only a few of them
these days. A few suggestions:</p><ol><li>Redirect those domains to localhost using the <code>hosts</code> file. This will break
things down the road especially if you are not in a VM.</li><li>With <code>FoxyProxy</code> you can designate filters for passing data to the proxy.</li><li>Live with the noise.</li></ol><p>If you figure out a way to tell Burp not to capture HTTP requests (other than
the nuclear option) please let me know.</p><h1 id=burps-http-history-filter>Burp's HTTP History Filter
<a class=header-link href=#burps-http-history-filter><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>The filter for HTTP History is another good ally in our war against noise. I
usually remove CSS and some file extensions like woff/woff2 (fonts). You can add
these to the <code>Filter by file extension > Hide</code> section and then turn it on/off
as needed. Bonus points for adding them to your default Burp config file. The
possibilities here are endless.</p><h2 id=options>OPTIONS
<a class=header-link href=#options><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Burp's history filter does not have a way to hide HTTP verbs like OPTIONS. The
preflight requests will pollute your history. I described how I wrote an
extension to hide them in
<a href=/blog/2019-04-06-hiding-options-an-adventure-in-dealing-with-burp-proxy-in-an-extension/ title="Hiding OPTIONS - An Adventure in Dealing with Burp Proxy in an Extension" rel=nofollow target=_blank>Hiding OPTIONS - An Adventure in Dealing with Burp Proxy in an Extension</a>.
You can use this methodology to hide any HTTP verb from history.</p><p>Note: <a href=https://twitter.com/CaptMeelo target=_blank rel="noreferrer noopener">Capt. Meelo</a> wrote an extension based on my blog post (seems
like mine has stopped working), you can see their blog post at
<a href=https://captmeelo.com/pentest/2020/01/06/filter-options-method.html target=_blank rel="noreferrer noopener">Filtering the OPTIONS Method in Burp</a>.</p><h1 id=the-nuclear-option>The Nuclear Option
<a class=header-link href=#the-nuclear-option><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>You can drop any request that is not in scope.</p><ol><li>Add all target domains to scope.</li><li>Go to <code>Project Options > Out-of-Scope Requests (at the bottom)</code> and select
<code>Drop all out-of-scope requests</code>.</li></ol><p>I really do not suggest this even after you feel you have everything in scope.
Thick client applications usually surprise me with new requests.</p><h1 id=the-resulting-project-config>The Resulting Project Config
<a class=header-link href=#the-resulting-project-config><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>After doing this for a while, you will have a good list of noisy domains. Save
the project config at <code>Project (menu) > Project options > Save project options</code>.
The domains will be in the config file (it's a JSON file) under
<code>ssl_pass_through</code>.</p><span class=caption-wrapper><img class=caption src=05-domains-in-config.png title="Domains in the config file" alt="Domains in the config file">
<span class=caption-text>Domains in the config file</span></span><p>Add them to your default config file with the rest of the things you like:</p><ol><li>Disable intercept at startup.<ol><li><code>User options > Misc > Proxy Interception</code></li></ol></li><li>Disable pretty-print by default (added in v2020.4).<ol><li><code>User options > HTTP Message Display > Pretty print by default</code></li></ol></li><li>Remove the default Burp Collaborator<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.<ol><li><code>Project options > Misc > Burp Collaborator Server > Don't use Burp Collaborator</code></li></ol></li><li>Remove <code>If-Modified-Since</code> and <code>If-None-Match</code> headers to always avoid 304s.<ol><li><code>Proxy > Options > Match and Replace > Enable built-in rules</code>.</li><li>Why?
<a href=/blog/2019-10-13-quality-of-life-tips-and-tricks-burp-suite/#disable-cached-responses title="Disable Cached Responses" rel=nofollow target=_blank>Disable Cached Responses</a></li></ol></li></ol><p>Some of these are <code>User options</code> and do not appear in the JSON file that we
created above. User options can be exported at <code>Burp (menu) > User options > Save user options</code>. This creates a second JSON file. Everything will be under a
key named <code>user_options</code>.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;user_options&#34;</span>:{
</span></span><span style=display:flex><span>        <span style=color:#586e75>// removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The project options file has a similar structure. Everything is under <code>project_options</code>.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;project_options&#34;</span>:{
</span></span><span style=display:flex><span>        <span style=color:#586e75>// removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=combining-user-and-project-options>Combining User and Project Options
<a class=header-link href=#combining-user-and-project-options><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>You can combine these two files. Add <code>user_options</code> and everything under it to
the other file. Note that <code>project_options</code> and <code>user_options</code> should be the two
top-level keys along with <code>proxy</code> and a few move. The final config file will
look like:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;project_options&#34;</span>:{
</span></span><span style=display:flex><span>        <span style=color:#586e75>// removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    },
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;user_options&#34;</span>:{
</span></span><span style=display:flex><span>        <span style=color:#586e75>// removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    },
</span></span><span style=display:flex><span>    <span style=color:#268bd2>&#34;proxy&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#586e75>// removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>    },
</span></span><span style=display:flex><span>    <span style=color:#586e75>// removed
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>}
</span></span></code></pre></div><p>Now we can use this project file every time we create a new project. Save it
somewhere (e.g., git repo) and update it regularly.
<a href=/blog/2019-10-13-quality-of-life-tips-and-tricks-burp-suite/#use-a-default-burp-config title="Use a Default Burp Config" rel=nofollow target=_blank>It will save you a lot of time</a></p><p><strong>Update June 2020</strong>: I reviewed the rules and decided that using wildcards to
ban entire domains is better. For example, to ban pretty much every request to
<code>mozilla</code> we can use this regex <code>^.*mozilla\\.(com|net|org)$</code>. I updated the
burp config. It should be cleaner now.</p><p><strong>Update June 2021</strong>: I have reduced the file size significantly. I compared the
final config file with the default values and removed the JSON keys that were
not modified. This does not have any performance effects.</p><p>See mine at:</p><ul><li><a href=https://github.com/parsiya/Parsia-Clone/blob/master/configs/burp-default-config.json target=_blank rel="noreferrer noopener">https://github.com/parsiya/Parsia-Clone/blob/master/configs/burp-default-config.json</a></li><li>Raw download: <a href=https://raw.githubusercontent.com/parsiya/Parsia-Clone/master/configs/burp-default-config.json target=_blank rel="noreferrer noopener">https://raw.githubusercontent.com/parsiya/Parsia-Clone/master/configs/burp-default-config.json</a></li></ul><h1 id=what-did-we-learn-here-today>What Did We Learn Here Today?
<a class=header-link href=#what-did-we-learn-here-today><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><ol><li>How to reduce noise in Burp history using several techniques.</li><li>How to combine project and user config files.</li></ol><p>Thanks for reading and hit me up if you have any suggestions.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>We honestly do not know what Portswigger collects from the collaborator. This is a must if you are doing consulting for 3rd parties. You don't want to leak your clients' internal info. You do not want your fancy payload to be harvested either.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>Parsia</span></span>
<time>May 1, 2020</time></span></p><p class=meta><a class="basic-alignment left" href=https://parsiya.net/blog/2020-04-17-the-encrypted-logz-some-simple-reverse-engineering/ title="The Encrypted Logz - Some Simple Reverse Engineering">The Encrypted Logz - Some Simple Reverse Engineering</a>
<a class="basic-alignment right" href=https://parsiya.net/blog/2020-05-09-thick-client-proxying-part-10-the-hosts-file/ title="Thick Client Proxying - Part 10 - The hosts File">Thick Client Proxying - Part 10 - The hosts File</a></p><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//parsiya.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h1>Who am I?</h1><p><p>I am Parsia, an application security engineer.</p><p>I write about application security, reverse engineering,
Go, cryptography, and (obviously) videogames.</p><p>Click on <a href=/about/>About Me!</a> to know more.</p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank rel="noopener noreferrer" href=https://github.com/parsiya/ title=https://github.com/parsiya/><i class="fa fa-github fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://twitter.com/cryptogangsta/ title=https://twitter.com/cryptogangsta/><i class="fa fa-twitter fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://keybase.io/parsiya/ title=https://keybase.io/parsiya/><i class="fa fa-keybase fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/in/parsiya title=https://www.linkedin.com/in/parsiya><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><h1>Collections</h1><li><a href=https://parsiya.net/categories/thick-client-proxying/ title="Thick Client Proxying">Thick Client Proxying</a></li><li><a href=https://parsiya.net/categories/writeup/ title=CTFs/Writeups>CTFs/Writeups</a></li><li><a href=https://parsiya.net/categories/attack-surface-analysis/ title="Attack Surface Analysis">Attack Surface Analysis</a></li><li><a href=https://parsiya.net/categories/bug-bounty/ title="Bug Bounty">Bug Bounty</a></li><li><a href=https://parsiya.net/categories/go/ title=Go/Golang>Go/Golang</a></li><li><a href=https://parsiya.net/categories/blockchain/ title=Blockchain>Blockchain</a></li><li><a href=https://parsiya.net/categories/burp-extension/ title="Burp Extension Development">Burp Extension Development</a></li><li><a href=https://parsiya.net/categories/automation/ title=Automation>Automation</a></li><li><a href=https://parsiya.net/categories/reverse-engineering/ title="Reverse Engineering">Reverse Engineering</a></li><li><a href=https://parsiya.net/categories/crypto/ title=Crypto(graphy)>Crypto(graphy)</a></li><li><a href=https://parsiya.net/categories/winappdbg/ title=WinAppDbg>WinAppDbg</a></li><li><a href=https://awsome.pw title="AWSome.pw - S3 bucket squatting - my very legit branded vulnerability">AWSome.pw - S3 bucket squatting - my very legit branded vulnerability</a></li></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2022 Parsia - <a href=https://parsiya.net/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>