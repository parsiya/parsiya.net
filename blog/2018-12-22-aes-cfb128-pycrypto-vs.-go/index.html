<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>AES-CFB128: PyCrypto vs. Go</title>
<link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://parsiya.net/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Parsia Hakimian Parsiya infosec information security]"><meta name=author content="Parsia"><meta name=generator content="Hugo 0.134.1"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image:src content="https://parsiya.net/blog/2018-12-22-aes-cfb128-pycrypto-vs.-go/06-picard.jpg"><meta name=twitter:title content="AES-CFB128: PyCrypto vs. Go"><meta name=twitter:description content="We have encrypted something with AES-CFB128 in Go. How can we decrypt it with PyCrypto?
This was originally part of the next blog post (about creating Python Burp extensions) but it grew large enough to be a separate post.
Disclaimer: I am not knowledgeable enough to explain cryptography to people. Read actual papers/books/articles to figure things out. If you find mistakes here, please let me know.
Code is at: https://github.com/parsiya/Go-Security/tree/master/aes-cfb128"><meta name=twitter:domain content="parsiya.net"><meta name=twitter:creator content="@CryptoGangsta"></head><body><header role=banner><hgroup><h1><a href=https://parsiya.net/>Hackerman's Hacking Tutorials</a></h1><h2>The knowledge of anything, since all things have causes, is not acquired or
complete unless it is known by its causes. - Avicenna</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://parsiya.net/about/>» About Me!</option><option value=https://parsiya.net/cheatsheet/>» Cheat Sheet</option><option value=https://parsiya.io/>» My Clone</option><option value=https://github.com/parsiya/parsiya.net>» Source Repo</option><option value="https://queue.acm.org/detail.cfm?id=3197520">» Manual Work is a Bug</option><option value="https://www.google.com/search?q=andrew+ridgeley">» The Other Guy from Wham!</option></select></fieldset><ul class=main-navigation><li><a href=https://parsiya.net/about/ title="About Me!" target=_blank rel="noopener noreferrer">About Me!</a></li><li><a href=https://parsiya.net/cheatsheet/ title="Cheat Sheet" target=_blank rel="noopener noreferrer">Cheat Sheet</a></li><li><a href=https://parsiya.io/ title="My Clone" target=_blank rel="noopener noreferrer">My Clone</a></li><li><a href=https://github.com/parsiya/parsiya.net title="Source Repo" target=_blank rel="noopener noreferrer">Source Repo</a></li><li><a href="https://queue.acm.org/detail.cfm?id=3197520" title="Manual Work is a Bug" target=_blank rel="noopener noreferrer">Manual Work is a Bug</a></li><li><a href="https://www.google.com/search?q=andrew+ridgeley" title="The Other Guy from Wham!" target=_blank rel="noopener noreferrer">The Other Guy from Wham!</a></li></ul><ul class=subscription><a href=https://parsiya.net/index.xml target=_blank type=application/rss+xml title=RSS rel="noopener noreferrer"><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://parsiya.net/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>Dec 22, 2018
- 5 minute read
- <a href=https://parsiya.net/blog/2018-12-22-aes-cfb128-pycrypto-vs.-go/#disqus_thread>Comments</a>
- <a class=label href=https://parsiya.net/categories/crypto/>Crypto </a><a class=label href=https://parsiya.net/categories/go/>Go </a><a class=label href=https://parsiya.net/categories/python/>Python</a></p><h1 class=entry-title>AES-CFB128: PyCrypto vs. Go</h1></header><div class=entry-content><nav id=TableOfContents><ul><li><a href=#what-is-pycrypto>What is PyCrypto?</a></li><li><a href=#what-is-aes-cfb>What is AES-CFB?</a><ul><li><a href=#segment-size>Segment Size</a></li><li><a href=#go>Go</a></li><li><a href=#pycrypto>PyCrypto</a></li><li><a href=#go-compatible-implementation-of-pycrypto-aes-cfb128>Go Compatible Implementation of PyCrypto AES-CFB128</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav><p>We have encrypted something with AES-CFB128 in Go. How can we decrypt it with PyCrypto?</p><p>This was originally part of the next blog post (about creating Python Burp extensions) but it grew large enough to be a separate post.</p><p>Disclaimer: I am not knowledgeable enough to explain cryptography to people. Read actual papers/books/articles to figure things out. If you find mistakes here, please let me know.</p><p>Code is at: <a href=https://github.com/parsiya/Go-Security/tree/master/aes-cfb128 target=_blank rel="noreferrer noopener">https://github.com/parsiya/Go-Security/tree/master/aes-cfb128</a></p><h1 id=what-is-pycrypto>What is PyCrypto?
<a class=header-link href=#what-is-pycrypto><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>Python's standard library does not have an AES implementation. 3rd party libraries are the answer. I am using <a href=https://github.com/dlitz/pycrypto target=_blank rel="noreferrer noopener">PyCrypto</a>. There's also <a href=https://gitlab.com/m2crypto/m2crypto target=_blank rel="noreferrer noopener">M2Crypto</a> and a bunch of other stuff.</p><p>If you developing on Windows like me (I am in a Windows 10 64-bit VM), save yourself a headache, skip pypi and just download the binary (I used <code>PyCrypto 2.6 for Python 2.7 64bit</code>):</p><ul><li><a href=http://www.voidspace.org.uk/python/modules.shtml#pycrypto target=_blank rel="noreferrer noopener">http://www.voidspace.org.uk/python/modules.shtml#pycrypto</a></li></ul><h1 id=what-is-aes-cfb>What is AES-CFB?
<a class=header-link href=#what-is-aes-cfb><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p>It turns AES into a stream cipher.</p><span class=caption-wrapper><img class=caption src=01-cfb-wikiepdia.svg title="AES-CFB Decryption - source: https://en.wikipedia.org/wiki/File:CFB_encryption.svg" alt="AES-CFB Decryption - source: https://en.wikipedia.org/wiki/File:CFB_encryption.svg">
<span class=caption-text>AES-CFB Decryption - source: https://en.wikipedia.org/wiki/File:CFB_encryption.svg</span></span><p>Instead of encrypting the plaintext and XOR-ing with the IV (think CBC), it encrypts the IV and XOR-s it with the plaintext. The ciphertext is then encrypted and XOR-ed with the next block just like CBC.</p><h2 id=segment-size>Segment Size
<a class=header-link href=#segment-size><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>It's the number of bits of ciphertext and plaintext that are XOR-ed together. However, this changes the way the rest of the cipher works. Allow me to explain using an example.</p><p>The picture above is running in <code>AES-CFB128</code> mode. A complete block (16 bytes) is encrypted and then XOR-ed with a block of plaintext. Let's assume the last block is smaller than 16 bytes, we do not need the rest of the bytes and we will discard them.</p><p>In <code>CFB8</code> (a.k.a. <code>CFB1</code> because 8 bits == 1 byte), things get more complicated. We have a 16 byte register called <code>shift register</code>. Initially, it's populated by IV. Then we encrypt it with <code>AES(key)</code>. See initial register in big-endian.</p><pre tabindex=0><code>IV0 IV1 IV2 ... IV14 IV15
</code></pre><p><em>Segment size</em> of 8 means we will XOR the first byte of plaintext with the first byte of encrypted register to get <code>CI0</code>. This byte is pushed to the register from right, so the first byte of the register (which was <code>IV0</code>) is discarded.</p><pre tabindex=0><code>IV1 IV2 ... IV14 IV15 CI0
</code></pre><p>The register is encrypted with the key again. The first byte of the result is XOR-ed with the second byte of plaintext to produce <code>CI1</code>. This is pushed to the register and so on.</p><pre tabindex=0><code>IV2 ... IV14 IV15 CI0 CI1
</code></pre><p>Life was much easier in CFB128, neh?</p><p>Not only things were simpler, but it was also considerably faster. In <code>CFB8</code>, we have to call AES encryption 16 times for each block vs. 1 in <code>CFB128</code>.</p><h2 id=go>Go
<a class=header-link href=#go><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Unlike Python, Go supports AES out of the box. The following Go program, encrypts a text in AES-CFB and then base64 encodes it. Run it on Go playground at <a href=https://play.golang.org/p/hNKOFqJ72Fi target=_blank rel="noreferrer noopener">https://play.golang.org/p/hNKOFqJ72Fi</a> or locally by running <code>cfb.go</code>. <strong>Go only support <code>CFB128</code></strong>.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#719e07>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#2aa198>&#34;crypto/aes&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#2aa198>&#34;crypto/cipher&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#2aa198>&#34;encoding/base64&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#2aa198>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>func</span> <span style=color:#268bd2>main</span>() {
</span></span><span style=display:flex><span>	key <span style=color:#719e07>:=</span> []<span style=color:#b58900>byte</span>(<span style=color:#2aa198>&#34;0123456789012345&#34;</span>)
</span></span><span style=display:flex><span>	iv <span style=color:#719e07>:=</span> []<span style=color:#b58900>byte</span>(<span style=color:#2aa198>&#34;9876543210987654&#34;</span>)
</span></span><span style=display:flex><span>	msg <span style=color:#719e07>:=</span> []<span style=color:#b58900>byte</span>(<span style=color:#2aa198>&#34;Hello AES, my old friend&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	enc, err <span style=color:#719e07>:=</span> <span style=color:#268bd2>Encrypt</span>(msg, key, iv)
</span></span><span style=display:flex><span>	<span style=color:#719e07>if</span> err <span style=color:#719e07>!=</span> <span style=color:#cb4b16>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#b58900>panic</span>(err)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fmt.<span style=color:#268bd2>Printf</span>(<span style=color:#2aa198>&#34;%s&#34;</span>, enc)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75>// Encrypt encrypts the plaintext with key and iv using AES-CFB and returns it in base64.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span><span style=color:#268bd2>func</span> <span style=color:#268bd2>Encrypt</span>(plaintext, key, iv []<span style=color:#dc322f>byte</span>) ([]<span style=color:#dc322f>byte</span>, <span style=color:#dc322f>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#586e75>// Create ciphertext.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>	ciphertext <span style=color:#719e07>:=</span> <span style=color:#b58900>make</span>([]<span style=color:#dc322f>byte</span>, <span style=color:#b58900>len</span>(plaintext))
</span></span><span style=display:flex><span>	<span style=color:#586e75>// Create AES cipher.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>	aesBlock, err <span style=color:#719e07>:=</span> aes.<span style=color:#268bd2>NewCipher</span>(key)
</span></span><span style=display:flex><span>	<span style=color:#719e07>if</span> err <span style=color:#719e07>!=</span> <span style=color:#cb4b16>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#719e07>return</span> <span style=color:#cb4b16>nil</span>, err
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#586e75>// Get AES-CFB stream encrypted.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>	stream <span style=color:#719e07>:=</span> cipher.<span style=color:#268bd2>NewCFBEncrypter</span>(aesBlock, iv)
</span></span><span style=display:flex><span>	<span style=color:#586e75>// Encrypt the msg and store the results in ciphertext.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>	stream.<span style=color:#268bd2>XORKeyStream</span>(ciphertext, plaintext)
</span></span><span style=display:flex><span>	<span style=color:#586e75>// Base64 encode it.
</span></span></span><span style=display:flex><span><span style=color:#586e75></span>	encodedCiphertext <span style=color:#719e07>:=</span> <span style=color:#b58900>make</span>([]<span style=color:#dc322f>byte</span>, base64.StdEncoding.<span style=color:#268bd2>EncodedLen</span>(<span style=color:#b58900>len</span>(ciphertext)))
</span></span><span style=display:flex><span>	base64.StdEncoding.<span style=color:#268bd2>Encode</span>(encodedCiphertext, ciphertext)
</span></span><span style=display:flex><span>	<span style=color:#719e07>return</span> encodedCiphertext, <span style=color:#cb4b16>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The output of the program is <code>jaJW8QJbKqHEg5zyFURe2o565/wDVca9</code>.</p><h2 id=pycrypto>PyCrypto
<a class=header-link href=#pycrypto><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Now we can decrypt it in Python.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#586e75># pycrypto1</span>
</span></span><span style=display:flex><span><span style=color:#719e07>from</span> Crypto.Cipher <span style=color:#719e07>import</span> AES
</span></span><span style=display:flex><span><span style=color:#719e07>from</span> base64 <span style=color:#719e07>import</span> b64decode
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>key <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;0123456789012345&#34;</span>
</span></span><span style=display:flex><span>iv <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;9876543210987654&#34;</span>
</span></span><span style=display:flex><span>ciphertext <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;jaJW8QJbKqHEg5zyFURe2o565/wDVca9&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># decode from base64</span>
</span></span><span style=display:flex><span>decoded <span style=color:#719e07>=</span> b64decode(ciphertext)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># encrypt with AES-CFB</span>
</span></span><span style=display:flex><span>aes <span style=color:#719e07>=</span> AES<span style=color:#719e07>.</span>new(key, AES<span style=color:#719e07>.</span>MODE_CFB, iv)
</span></span><span style=display:flex><span>decrypted <span style=color:#719e07>=</span> aes<span style=color:#719e07>.</span>decrypt(decoded)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b58900>print</span> decrypted
</span></span></code></pre></div><p>Oh wait, it didn't work!</p><span class=caption-wrapper><img class=caption src=02-pycrypto1.png title="What is this garbage?" alt="What is this garbage?">
<span class=caption-text>What is this garbage?</span></span><p>Maybe our Go program is wrong. We can check it with JavaScript using <a href="https://gchq.github.io/CyberChef/#recipe=From_Base64%28%27A-Za-z0-9%2B/%3D%27,true%29AES_Decrypt%28%7B%27option%27:%27UTF8%27,%27string%27:%270123456789012345%27%7D,%7B%27option%27:%27UTF8%27,%27string%27:%279876543210987654%27%7D,%27CFB%27,%27Raw%27,%27Raw%27,%7B%27option%27:%27Hex%27,%27string%27:%27%27%7D%29&amp;input=amFKVzhRSmJLcUhFZzV6eUZVUmUybzU2NS93RFZjYTk" target=_blank rel="noreferrer noopener">CyberChef</a> (clicking on the link will open CyberChef with input and recipe).</p><span class=caption-wrapper><img class=caption src=03-cyberchef.png title="Decrypted in CyberChef" alt="Decrypted in CyberChef">
<span class=caption-text>Decrypted in CyberChef</span></span><p>Let me save you the 15-minute search and give you the answer. PyCrypto's default mode is <code>CFB8</code>. We can change the mode by passing <code>segment_size</code> to <code>AES.new</code>. See here <a href=https://www.dlitz.net/software/pycrypto/api/current/Crypto.Cipher.AES-module.html target=_blank rel="noreferrer noopener">https://www.dlitz.net/software/pycrypto/api/current/Crypto.Cipher.AES-module.html</a>.</p><p>Source (no, that's not me): <a href=https://stackoverflow.com/questions/23897809/different-results-in-go-and-pycrypto-when-using-aes-cfb target=_blank rel="noreferrer noopener">https://stackoverflow.com/questions/23897809/different-results-in-go-and-pycrypto-when-using-aes-cfb</a></p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#586e75># pycrypto2</span>
</span></span><span style=display:flex><span><span style=color:#719e07>from</span> Crypto.Cipher <span style=color:#719e07>import</span> AES
</span></span><span style=display:flex><span><span style=color:#719e07>from</span> base64 <span style=color:#719e07>import</span> b64decode
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>key <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;0123456789012345&#34;</span>
</span></span><span style=display:flex><span>iv <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;9876543210987654&#34;</span>
</span></span><span style=display:flex><span>ciphertext <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;jaJW8QJbKqHEg5zyFURe2o565/wDVca9&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># decode from base64</span>
</span></span><span style=display:flex><span>decoded <span style=color:#719e07>=</span> b64decode(ciphertext)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># encrypt with AES-CFB</span>
</span></span><span style=display:flex><span>aes <span style=color:#719e07>=</span> AES<span style=color:#719e07>.</span>new(key, AES<span style=color:#719e07>.</span>MODE_CFB, iv, segment_size<span style=color:#719e07>=</span><span style=color:#2aa198>128</span>)
</span></span><span style=display:flex><span>decrypted <span style=color:#719e07>=</span> aes<span style=color:#719e07>.</span>decrypt(decoded)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b58900>print</span> decrypted
</span></span></code></pre></div><span class=caption-wrapper><img class=caption src=04-pycrypto2.png title="Input must be a multiple of segment size" alt="Input must be a multiple of segment size">
<span class=caption-text>Input must be a multiple of segment size</span></span><p>The input must be padded for PyCrypto's AES-CFB. How can we make it work with Go?</p><h2 id=go-compatible-implementation-of-pycrypto-aes-cfb128>Go Compatible Implementation of PyCrypto AES-CFB128
<a class=header-link href=#go-compatible-implementation-of-pycrypto-aes-cfb128><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>It's simpler than I thought.</p><p>Decryption:</p><ol><li>Pad ciphertext with <code>0x00</code> to segment size (16 bytes). Remember padding length.</li><li>Decrypt with <code>AES-CFB128</code>.</li><li>Discard the last n bytes of cleartext where n is padding length.</li></ol><p>Encryption:</p><ol><li>Pad input with <code>0x00</code> to segment size (16 bytes). Remember padding length.</li><li>Encrypt with <code>AES-CFB128</code>.</li><li>Remove the last n bytes of ciphertext where n is padding length.</li></ol><p>See the code in <code>pycrypto-aescfb128.py</code>. And it works!</p><span class=caption-wrapper><img class=caption src=05-pycrypto3.png title="AES-CFB128 with PyCrypto" alt="AES-CFB128 with PyCrypto">
<span class=caption-text>AES-CFB128 with PyCrypto</span></span><h1 id=conclusion>Conclusion
<a class=header-link href=#conclusion><svg class="fill-current o-60 hover-accent-color-light" height="22" viewBox="0 0 24 24" width="22"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h1><p><del>Go is faster Python with types</del> Go is awesome. Python is a <a href=https://mail.python.org/pipermail/python-committers/2018-July/005664.html target=_blank rel="noreferrer noopener">dead language abandoned by its creator</a> and it doesn't even have AES support in its standard library. Generics? What?! I cannot hear you.</p><span class=caption-wrapper><img class=caption src=06-picard.jpg title="It's almost 2019, why are you still using stale memes?" alt="It's almost 2019, why are you still using stale memes?">
<span class=caption-text>It's almost 2019, why are you still using stale memes?</span></span><p>Python BTFO with FACTS and LOGIC. #VictoryRoyale #Owned</p><p>It's a joke. Calm down, you people.</p></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>Parsia</span></span>
<time>Dec 22, 2018</time>
<span class=categories>Tags:
<a class=category href=https://parsiya.net/tags/aes>AES</a></span></p><p class=meta><a class="basic-alignment left" href=https://parsiya.net/blog/2018-12-19-python-utility-modules-for-burp-extensions/ title="Python Utility Modules for Burp Extensions">Python Utility Modules for Burp Extensions</a>
<a class="basic-alignment right" href=https://parsiya.net/blog/2018-12-24-cryptography-in-python-burp-extensions/ title="Cryptography in Python Burp Extensions">Cryptography in Python Burp Extensions</a></p><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//parsiya.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h1>Who am I?</h1><p><p>I am Parsia, an application security engineer.</p><p>I write about application security, cryptography, static analysis, and
(of course) videogames.</p><p>Click on <a href=/about/>About Me!</a> to know more.</p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank rel="me noopener noreferrer" href=https://infosec.exchange/@parsiya title=https://infosec.exchange/@parsiya><i class="fa fa-mastodon fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://github.com/parsiya/ title=https://github.com/parsiya/><i class="fa fa-github fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://twitter.com/cryptogangsta/ title=https://twitter.com/cryptogangsta/><i class="fa fa-twitter fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/in/parsiya title=https://www.linkedin.com/in/parsiya><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><h1>Collections</h1><li><a href=https://parsiya.net/categories/thick-client-proxying/ title="Thick Client Proxying">Thick Client Proxying</a></li><li><a href=https://parsiya.net/categories/writeup/ title=CTFs/Writeups>CTFs/Writeups</a></li><li><a href=https://parsiya.net/categories/attack-surface-analysis/ title="Attack Surface Analysis">Attack Surface Analysis</a></li><li><a href=https://parsiya.net/categories/static-analysis/ title="Static Analysis">Static Analysis</a></li><li><a href=https://parsiya.net/categories/bug-bounty/ title="Bug Bounty">Bug Bounty</a></li><li><a href=https://parsiya.net/categories/blockchain/ title="Blockchain (lol)">Blockchain (lol)</a></li><li><a href=https://parsiya.net/categories/crypto/ title=Crypto(graphy)>Crypto(graphy)</a></li><li><a href=https://parsiya.net/categories/burp-extension/ title="Burp Extension Development">Burp Extension Development</a></li><li><a href=https://parsiya.net/categories/automation/ title=Automation>Automation</a></li><li><a href=https://parsiya.net/categories/reverse-engineering/ title="Reverse Engineering">Reverse Engineering</a></li><li><a href=https://parsiya.net/categories/winappdbg/ title="WinAppDbg (use Frida instead)">WinAppDbg (use Frida instead)</a></li><li><a href=https://awsome.pw title='AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability'>AWSome.pw - S3 bucket squatting - my very "legit" branded vulnerability</a></li></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2024 Parsia - <a href=https://parsiya.net/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>